(self.webpackChunk=self.webpackChunk||[]).push([[4382],{14979:(e,t,i)=>{i.d(t,{d:()=>o,s:()=>l});var n=i(42082),r=i(90189),s=i(39963),a=i(16249);async function o(e,t,i=n._N,o="always_on_notch",l=!1){let c="clicked";try{const n={assistantSessionId:e,selectedText:t,agentId:i,openAgentProfile:l};await(0,r.OB)().browserApi.sessionStorage.set({alwaysOnAssistantOnOpenData:n}),await(0,r.OB)().bgRpc.api.openSidePanel(),c="success"}catch(e){c="failure"}return(0,s.Tb)().alwaysAvailableAssistant.openSidePanel(o,c),a.J.alwaysOnAssistantSidePanelOpen(e,o),"success"===c}function l(e){(0,r.OB)().browserApi.sessionStorage.set({alwaysOnAssistant:{notchPosition:e}})}},55916:(e,t,i)=>{i.d(t,{L:()=>r});var n=i(92379);const r=()=>n.createElement("input",{"aria-hidden":"true",tabIndex:-1,style:{position:"absolute",inset:0,opacity:0,cursor:"inherit"}})},19532:(e,t,i)=>{i.d(t,{E:()=>r});var n=i(39963);const r=e=>t=>(0,n.Tb)().sendFemetricsRate("unexpectedMethodCall",{methodName:t,serviceName:e})},60435:(e,t,i)=>{function n(e,t){return Object.fromEntries(Object.entries(e).map((([i,n])=>[i,(i,r,...s)=>{if(r===t())return n.apply(e,s)}])))}i.d(t,{W:()=>n})},11294:(e,t,i)=>{var n;i.d(t,{O:()=>n}),function(e){e.toClient="cs-to-side-panel-for-legacy-assistant-to-client",e.toServer="cs-to-side-panel-for-legacy-assistant-to-server"}(n||(n={}))},22712:(e,t,i)=>{var n;i.d(t,{W:()=>n}),function(e){e.toClient="side-panel-to-cs-rpc-for-legacy-assistant-to-client",e.toServer="side-panel-to-cs-rpc-for-legacy-assistant-to-server"}(n||(n={}))},52815:(e,t,i)=>{i.d(t,{I:()=>o,Y:()=>l});var n=i(66861),r=i(28898),s=i(60026),a=i(27982);function o(e){return e.view((0,n.H6)("alwaysAvailableAssistantSettings","cheetah","isDesktopIntegrationEnabled")).view(l)}function l(e){var t,i,n,o;if(!(null===(t=(0,r.O)().experimentClient)||void 0===t?void 0:t.isGateEnabled(a.K.AssistantInSidePanel)))return!1;const l=()=>{var t,i;const n=null===(t=null==e?void 0:e.alwaysAvailableAssistantSettings)||void 0===t?void 0:t.enabled;return void 0!==n?!!n:!!e&&!0!==e.isDesktopIntegrationEnabled&&"test"===(null===(i=(0,r.O)().experimentClient)||void 0===i?void 0:i.getTreatment(s.p.AAADefaultOnV3))};return((null===(i=(0,r.O)().experimentClient)||void 0===i?void 0:i.isGateEnabled(a.K.SuperhumanGoBranding))||!1!==(null===(o=null===(n=null==e?void 0:e.cheetah)||void 0===n?void 0:n.status)||void 0===o?void 0:o.cheetahEnabled))&&l()}},48403:(e,t,i)=>{i.r(t),i.d(t,{CheetahFeatureImpl:()=>gi,isAssistantOpened:()=>di,isGenAIAssistantOpened:()=>ui});var n=i(18117),r=i(92135),s=i(67177),a=i(90023),o=i(92379),l=i(92054),c=i(24993),h=i(24516),d=i(37937),u=i(58573),g=i(23817),p=i(29793),f=i(75532),m=i(85837),v=i(13391),b=i(39104),_=i(32073),S=i(74822),y=i(99887),w=i(20161),A=i(64271),I=i(90572),x=i(84178),C=i(36344),k=i(2187),R=i(84308),E=i(59179),P=i(63532),T=i(84714),O=i(24666),U=i(954),B=i(78129),M=i(18827),F=i(29416),H=i(29479),D=i(58303),j=i(2084),z=i(20932),G=i(30084),L=i(14979),N=i(42082),$=i(90189),q=i(84195),W=i(19532),V=i(58777),Y=i(46649),K=i(11294);class X extends Y.X{constructor(e,t){super(new V.d(t,K.O.toClient,K.O.toServer)),this._textFieldId=e}_handleCall(e,t){return super._handleCall(e,[this._textFieldId,...t])}}var Q=i(7621),J=i(30498),Z=i(60435),ee=i(22712);class te{constructor(e,t,i,n,r,a){this._textFieldId=e,this._alertService=t,this._capiService=i,this._trackingService=n,this._uphookService=r,this._deepLinkService=a,this.publicApi={...(0,Z.W)({applyAlerts:this._alertService.applyAlerts.bind(this._alertService),removeAlerts:this._alertService.removeAlerts.bind(this._alertService),setAlertsVisibility:this._alertService.setAlertsVisibility.bind(this._alertService),updateAlertsVisibility:this._alertService.updateAlertsVisibility.bind(this._alertService),scrollAlertIntoView:this._alertService.scrollAlertIntoView.bind(this._alertService),feedLensShown:this._trackingService.feedLensShown.bind(this._trackingService),plagiarismCitationsStyleDropdownOpened:this._trackingService.plagiarismCitationsStyleDropdownOpened.bind(this._trackingService),plagiarismCitationsStyleChanged:this._trackingService.plagiarismCitationsStyleChanged.bind(this._trackingService),feedSuccessStateShown:this._trackingService.feedSuccessStateShown.bind(this._trackingService),feedLensButtonClicked:this._trackingService.feedLensButtonClicked.bind(this._trackingService),sendCAPIMessage:e=>("user_action"===e.action?this._capiService.user_action(e.data)():"toggle_checks"===e.action?this._capiService.toggle_checks(e.data)():(0,W.E)("sendCAPIMessage")(e.action),s.of(1)),getUphookConfiguration:this._uphookService.getUphookConfiguration.bind(this._uphookService),trackUphookShown:this._uphookService.trackUphookShown.bind(this._uphookService),trackUphookClicked:this._uphookService.trackUphookClicked.bind(this._uphookService),executeUphook:this._uphookService.executeUphook.bind(this._uphookService),openDeepLink:this._deepLinkService.openDeepLink.bind(this._deepLinkService),notifyStatusChanged:this._deepLinkService.notifyStatusChanged.bind(this._deepLinkService)},(()=>this._textFieldId))}}}function ie(e,t){const{alertService:i,sduiService:n,capiService:r,trackingService:a,deepLinkService:o,uphookService:l}=e,c=new q.n((0,$.OB)().browserApi.message),h=o,d=function(e,t,i,n,r,s,a){const o=new te(e,i,n,r,s,a);return new J.S((0,Q.NH)(new V.d(t,ee.W.toServer,ee.W.toClient)),o.publicApi)}(t,c,i,r,a,l,h),u=new X(t,c),g=i.alertCollectionChanges.subscribe({next:e=>{u.api.setAlertCollectionChanges(e)}}),p=i.selectedAlertId.subscribe({next:e=>{u.api.setSelectedAlertId(e)}}),f=n.sduiItemCollectionChanges.subscribe({next:e=>{u.api.setSduiItemCollectionChanges(e)}}),m=r.relevantInboundCAPIMessages.subscribe({next:e=>{u.api.setInboundCAPIMessages(e)}}),v=l,b=v.isEligibleForInProductDiscount.subscribe((e=>{u.api.setIsEligibleForInProductDiscount(e)})),_=v.isEligibleForFreeTrial.subscribe((e=>{u.api.setIsEligibleForFreeTrial(e)})),S=h.deepLinkRequests.subscribe({next:e=>{u.api.setDeepLinkRequest(e)}});(0,$.OB)().browserApi.sessionStorage.get("isSidePanelOpen").then((e=>{e.isSidePanelOpen&&e.isSidePanelOpen.selectedAgentId===N.t6&&h.openDeepLink("plagiarismView")}));const y=r,w=new Proxy(r,{get:(e,t)=>"user_action"===t?e=>("focus"!==e.userAction&&(0,W.E)("CAPI.Message.UserAction")(e.userAction),s.of(1)):e[t]});return Object.assign(e,{capiService:w}),{dispose:()=>{Object.assign(e,{capiService:y}),g.unsubscribe(),p.unsubscribe(),f.unsubscribe(),m.unsubscribe(),b.unsubscribe(),_.unsubscribe(),S.unsubscribe(),u.dispose(),d.dispose()}}}var ne=i(52815);var re=i(43389),se=i(67385),ae=i(15100),oe=i(18122),le=i(90595),ce=i(40594),he=i(13848),de=i(72614);class ue{constructor(e){this._params=e}scrollAlertIntoView({alertId:e}){var t;const i=null===(t=this._params.getAlertById(e))||void 0===t?void 0:t.highlightRanges[0];i&&this._params.integration.scrollHighlightIntoView(i)}}var ge=i(66738),pe=i(81933),fe=i(21147),me=i(30842),ve=i(26155);class be{constructor(e){this._params=e,this._subs=new _.w0,this._visibleAlerts=v.h.create(new Set),this._emphasizedAlerts=v.h.create(new Set),this.hasHighlights=this._visibleAlerts.pipe(E.U((e=>e.size>0)),U.O(!1),O.x(),pe.shareReplay({bufferSize:1,refCount:!0})),this.alertsFilter=this._visibleAlerts.pipe(pe.skipBy(ge.Eh(fe.yv)),F.b(0),E.U((e=>t=>e.has(t.id))),pe.shareReplay({bufferSize:1,refCount:!0})),this.selectedAlerts=this._emphasizedAlerts.view(),this._subs.add(this._visibleAlerts.subscribe((e=>{var t;return null===(t=this._params.logger)||void 0===t?void 0:t.debug("visible highlights",e)}))),this._subs.add(this._emphasizedAlerts.subscribe((e=>{var t;return null===(t=this._params.logger)||void 0===t?void 0:t.debug("emphasized highlights",e)})))}setAlertsVisibility(e){this.clearAll();const t=new Set(this._visibleAlerts.get()),i=new Set(this._emphasizedAlerts.get());e.filter((e=>"hidden"!==e.visibility)).forEach((({alertId:e,visibility:n})=>{this._params.getAlertById(e)&&(t.add(e),"emphasized"===n&&i.add(e))})),this._visibleAlerts.set(t),this._emphasizedAlerts.set(i)}updateAlertsVisibility(e){const t=new Set(this._visibleAlerts.get()),i=new Set(this._emphasizedAlerts.get());e.forEach((({alertId:e,visibility:n})=>{this._params.getAlertById(e)&&"hidden"!==n?(t.add(e),"emphasized"===n?i.add(e):i.delete(e)):(t.delete(e),i.delete(e))})),this._visibleAlerts.set(t),this._emphasizedAlerts.set(i)}clearAll(){this._visibleAlerts.set(new Set),this._emphasizedAlerts.set(new Set)}getHighlightVisualState(e){const t=this._params.alertStateService.getHighlightedAlert().pipe(E.U((t=>{var i;return void 0!==(null===(i=null==t?void 0:t.highlightIds)||void 0===i?void 0:i.find((t=>(0,me.OK)(t,e))))})),U.O(!1),O.x()),i=this._params.alertStateService.getActiveAlertByClick().pipe(E.U((t=>{var i;return void 0!==(null===(i=null==t?void 0:t.highlightIds)||void 0===i?void 0:i.find((t=>(0,me.OK)(t,e))))})),U.O(!1),O.x()),n=this._emphasizedAlerts.pipe(E.U((t=>Array.from(t).some((t=>this._params.aquaAlertsWiring.getHighlightsForAlert(t).includes(e))))),O.x());return R.a([t,i,n]).pipe(E.U((([e,t,i])=>({hovered:e,selectedByClick:t,emphasized:i}))),U.O({hovered:!1,selectedByClick:!1,emphasized:!1}),B.G(),E.U((([e,t])=>t.hovered||t.selectedByClick?ve.pc.hovered:t.emphasized?e.hovered||e.selectedByClick?ve.pc.hovered:ve.pc.hoveredNeedsAttention:ve.pc.none)),U.O(ve.pc.none),O.x(),P.b((t=>{var i;return null===(i=this._params.logger)||void 0===i?void 0:i.debug(`[${e}] visual state:`,t)})))}dispose(){this.clearAll(),this._subs.unsubscribe()}}var _e=i(28338);function Se(e){var t,i;return null!==(i=null===(t=D.WG(e.get()))||void 0===t?void 0:t.sessionUuid)&&void 0!==i?i:void 0}var ye=i(62649);const we="extension-assistant-visually-ready",Ae="extension-assistant-interaction-ready",Ie=`${ye.V.assistantOpenAttempt}-to-extension-assistant-visually-ready`;class xe{constructor(e){this._params=e,this.sizeBehavior=this._params.sizeBehavior,this.dragBehavior=this._params.dragBehavior,this.hostInfo=this._params.hostInfo}static markOpenAttempt(){performance.mark(ye.V.assistantOpenAttempt)}static markVisuallyReady(){performance.mark(we)}static markInteractionReady(){performance.mark(Ae)}static measureOpenAttemptToVisuallyReady(){try{return performance.measure(Ie,ye.V.assistantOpenAttempt).duration}catch(e){return}}static measureVisuallyReadyToInteractionReady(){try{return performance.measure("extension-assistant-visually-ready-to-extension-assistant-interaction-ready",we).duration}catch(e){return}}starting(){return Promise.resolve()}visuallyReady(){xe.markVisuallyReady();const e=xe.measureOpenAttemptToVisuallyReady();return this._params.gnarTracking.trackVisuallyReady(e),this._params.onVisuallyReady(),Promise.resolve()}interactionReady(e){xe.markInteractionReady();const t=xe.measureVisuallyReadyToInteractionReady();return this._params.gnarTracking.trackInteractionReady(e,t),Promise.resolve()}focusStateChanged(e){return this._params.onFocusStateChanged(e),Promise.resolve()}readyToDrag(e){return this._params.onReadyToDrag(e)}close(){return this._params.gnarTracking.trackClose(),this._params.onClose(),Promise.resolve()}openUrl(e){return self.open(e,"_blank","noreferrer"),Promise.resolve()}dispose(){this._params.gnarTracking.dispose()}}var Ce=i(39953),ke=i(55599);function Re(e){return"revision"===e.assistantMode||"genAIAndRevision"===e.assistantMode}function Ee(e,t){return e instanceof ke.P&&Re(t)}var Pe=i(48758),Te=i(68418);class Oe{constructor(e){var t,i;this._params=e,this._subs=new _.w0,this._source=function(e){switch(e.kind){case"gButtonSource":return"gbutton";case"emojiButtonSource":return"tone";case"inlineCardSource":return"inline-card";case"inlinePushRewriteSource":return"inline-push-rewrite";case"inlineQuickReplySource":return"inline-quick-reply";case"inlineQuickRewriteSource":return"inline-quick-rewrite";case"inlineRewriteSource":return"inline-rewrite";case"onboardingSource":return"onboarding";case"inlineTranslateSource":return"inline-translate";case"alwaysOnAssistantSource":return"always-on-assistant";default:(0,_e.L0)(e)}}(this._params.openAssistantParams.source),this._uiType=(t=this._params.openAssistantParams,i=this._params.supportedForms,Re(t)?void 0!==i&&i.length>0&&"longForm"===i[0]?"long-form":"short-form":"cheetah"),this._startTrackingDrag()}trackVisuallyReady(e){const t=this._params.statisticsService.alertCounts.get(),i=this._params.statisticsService.wordsCount.get(),n=t.filter((e=>Pe.S.isCapiAlert(e)&&e.outcome===se.TC.clarity)).visibleCapiAlerts;if(Ee(this._params.integration,this._params.openAssistantParams))this._params.gnar.gdocsSidebarGdocsSidebarShow(this._params.integration.isDocOwnedByCurrentUser(),"user",t.unmutedCapiAlerts,i,t.visibleInlineCapiAlerts,n,t.visibleNotInlineCapiAlerts,void 0,e,this._source,this._uiType);else{const r=this._params.position.get();this._params.gnar.assistantPopupShow("default",this._params.height.get(),r.left,r.top,t.unmutedCapiAlerts,n,t.visibleInlineCapiAlerts,t.filter((e=>Pe.S.isCapiAlert(e)&&"priority"===e.assistantView)).unmutedCapiAlerts,i,"sticky",this._getSessionUuid(),void 0,e,this._params.statisticsService.generalScore.get(),this._source,this._uiType)}}trackInteractionReady(e,t){Ee(this._params.integration,this._params.openAssistantParams)?this._params.gnar.gdocsSidebarGdocsSidebarReady(this._getSessionUuid(),e.success,"gen-ai"===e.kind?"genai":"revision",t,this._source,this._uiType):this._params.gnar.assistantPopupReady(this._getSessionUuid(),e.success,"gen-ai"===e.kind?"genai":"revision",t,this._source,this._uiType)}trackClose(){const e=this._params.statisticsService.alertCounts.get(),t=e.filter((e=>Pe.S.isCapiAlert(e)&&e.outcome===se.TC.clarity)).visibleCapiAlerts;Ee(this._params.integration,this._params.openAssistantParams)?this._params.gnar.gdocsSidebarGdocsSidebarClose(this._params.integration.isDocOwnedByCurrentUser(),"user",e.unmutedCapiAlerts,this._params.statisticsService.wordsCount.get(),e.visibleInlineCapiAlerts,t,e.visibleNotInlineCapiAlerts):this._params.gnar.assistantPopupCloseButtonClick("default",e.unmutedCapiAlerts,t,e.visibleInlineCapiAlerts,e.filter((e=>Pe.S.isCapiAlert(e)&&"priority"===e.assistantView)).unmutedCapiAlerts,void 0)}_startTrackingDrag(){const e=this._params.position.get();let t=e;this._subs.add(this._params.isDragging.pipe(B.G(),I.h((([e,t])=>e&&!t))).subscribe((()=>{const i=this._params.position.get();Te.E9.l1Distance(i,t)<Oe.MINIMAL_RECOGNIZABLE_DRAG_DISTANCE||(this._params.gnar.assistantPopupDrag(i.left,i.top,this._params.height.get(),e.left,e.top),t=i)})))}_getSessionUuid(){return(0,Ce.zG)(this._params.checkingService.get(),D.tS((e=>D.ij(e.sessionUuid))),D.g_((()=>""),(e=>e)))}dispose(){this._subs.unsubscribe()}}Oe.MINIMAL_RECOGNIZABLE_DRAG_DISTANCE=10;var Ue=i(86399),Be=i(57022),Me=i(67800),Fe=i(79707);function He(e){var t;return"genAI"!==e.assistantMode&&"genAIAndWritingExpert"!==e.assistantMode&&"inlineCardSource"===e.source.kind&&null!==(t=e.source.alertId)&&void 0!==t?t:null}function De(e,t,i,n){switch(e.genAISessionMode){case"ideation":return{mode:e.genAISessionMode,metadata:t,documentUrl:n};case"rewrite":case"quickRewrite":case"translate":case"compliance":return{mode:e.genAISessionMode,metadata:t};case"quickReply":return{mode:e.genAISessionMode,quickReplyContext:(0,a.zG)(i,D.g_((()=>Be.H.empty),je)),metadata:t};case"pushRewrite":return{mode:e.genAISessionMode,writingExpertContext:e.writingExpertContext};case"appActionDeeplink":return{mode:e.genAISessionMode,appActionDeeplinkContext:e.appActionDeeplinkContext};default:(0,_e.L0)(e)}}function je(e){var t,i,n,r,s,o,l,c,h,d,u,g,p,f,m,v,b;const _=e=>{var t;return null!==(t=null==e?void 0:e.reduce(((e,t)=>{var i;return t.email&&!e.has(t.email)&&e.set(t.email,{name:null!==(i=t.name)&&void 0!==i?i:"",email:t.email}),e}),new Map))&&void 0!==t?t:new Map},S=_(null===(n=null===(i=null===(t=e.parents)||void 0===t?void 0:t[0])||void 0===i?void 0:i.audience)||void 0===n?void 0:n.indirectRecipients),y=_(null===(o=null===(s=null===(r=e.parents)||void 0===r?void 0:r[0])||void 0===s?void 0:s.audience)||void 0===o?void 0:o.undisclosedRecipients),w=_(null===(d=null===(h=null===(c=null===(l=e.parents)||void 0===l?void 0:l[0])||void 0===c?void 0:c.audience)||void 0===h?void 0:h.recipients)||void 0===d?void 0:d.filter((({email:e})=>(0,Fe.HD)(e)&&!S.has(e)&&!y.has(e)))),A=_(null===(u=e.audience)||void 0===u?void 0:u.indirectRecipients),I=_(null===(g=e.audience)||void 0===g?void 0:g.undisclosedRecipients),x=_(null===(f=null===(p=e.audience)||void 0===p?void 0:p.recipients)||void 0===f?void 0:f.filter((({email:e})=>(0,Fe.HD)(e)&&!A.has(e)&&!I.has(e))));return{previousMessageInfo:(0,a.zG)(Ue.YM(null!==(m=e.parents)&&void 0!==m?m:[]),D.g_((()=>Be.H.PreviousMessageInfo.empty),(e=>{var t;return{author:(0,a.zG)(Ue.YM(null!==(t=e.authors)&&void 0!==t?t:[]),D.g_((()=>Be.H.Person.empty),(e=>{var t,i;return{name:null!==(t=e.name)&&void 0!==t?t:"",email:null!==(i=e.email)&&void 0!==i?i:""}}))),directRecipients:Array.from(w.values()),text:e.delta?(0,Me.l)(e.delta,""):""}}))),title:null!==(v=e.title)&&void 0!==v?v:"",author:(0,a.zG)(Ue.YM(null!==(b=e.authors)&&void 0!==b?b:[]),D.g_((()=>Be.H.Person.empty),(e=>{var t,i;return{name:null!==(t=e.name)&&void 0!==t?t:"",email:null!==(i=e.email)&&void 0!==i?i:""}}))),directRecipients:Array.from(x.values()),indirectRecipients:Array.from(A.values()),undisclosedRecipients:Array.from(I.values())}}var ze=i(1712),Ge=i(2210),Le=i(85617),Ne=i(98494),$e=i(32663),qe=i(71095),We=i(68315),Ve=i(37108),Ye=i(49601),Ke=i(3199),Xe=i(8867),Qe=i(18595),Je=i(12518),Ze=i(56863),et=i(6266),tt=i(62067),it=i(95404),nt=i(70843),rt=i(35248),st=i(87410),at=i(57923),ot=i(59833),lt=i(46108);const ct={"Style/ToneImprovement/ConfidentRewrite/ToneAI":"1f91d","Style/ToneImprovement/PersonableRewrite/ToneAI":"1f917","Style/ToneImprovement/PositiveFraming/ToneAI":"1f64c"};function ht(e){var t,i,n;const r=null!==(t=e.extraProperties.emoji_id)&&void 0!==t?t:e.extraProperties.emojiId,s=e.minicardTitle.match(lt.V),a=s&&s[0]&&(null===(i=s[0].codePointAt(0))||void 0===i?void 0:i.toString(16)),o=ct[e.patternName];return D.ij(null!==(n=null!=r?r:a)&&void 0!==n?n:o)}class dt{constructor(e){this._alertProcessor=e}getToneAlertsSummary(){const e=Array.from(function*(e){for(const t of e)Pe.S.isCapiAlert(t)&&t.patternName.startsWith("Style/ToneImprovement")&&(yield t)}(this._alertProcessor.alerts.getAll())).map((e=>({title:e.minicardTitle.replace(lt.V,"").trim(),emojiId:ht(e)}))),t=new Set(e.map((({title:e})=>e)));return Promise.resolve((0,a.zG)(ot.YM(e),D.UI((({title:e,emojiId:i})=>({title:t.size>1?"Strike the right tone":e,emojiId:i})))))}}var ut=i(19724);function gt(e,t,i){const n="business"===i.previousUserType||"edu"===i.previousUserType||"ngo"===i.previousUserType;let r="free";return n?r="institution":"premium"===i.previousUserType&&(r="premium"),e.anonymous?{kind:"signed-out",institutionType:n?i.previousUserType:void 0,type:r}:{kind:"signed-in",id:e.id,isPremium:ut.n.isPremium(e),dialect:t,email:e.email,institution:(0,a.zG)(D.ij(e.institutionInfo),D.UI((({id:e,name:t,voxInfo:i})=>({id:e,name:t,logoUrl:null==i?void 0:i.logoUrl,styleGuideEnabled:null==i?void 0:i.styleGuideEnabled}))))}}var pt=i(20680),ft=i(79256),mt=i(50750);function vt(e,t,i){return pt.z(ft.P((()=>mt.D(t()))).pipe(I.h(i)),e)}function bt(e,t,i,n,r,o,l,c,u,g,p,f,m,b,y,A,C,k,B,M,F,H,z,G,L,N,q,W,V,Y){const K=new S.x,X=new ze.t({inboundCAPIMessages:vt(t,i,Ge.J4),sendCAPIMessage:({action:t,data:i,shouldInjectRev:n,shouldInjectSessionId:r})=>(0,a.zG)(s.Uo((0,a.zG)(e.get(),Je.Yo((()=>new Error("checking service not initialized"))))),s.tS((e=>e.sendMessage(t,i,r,n?{kind:"default"}:void 0))))}),Q={user:v.h.combine(n,o,r,gt),setDialect:l,signIn:()=>{const e=(0,et.no)(r.get()),t={source:"authHook",slot:tt.G0.Toolbar,name:tt.Vi.SignedOutUI,lastKnownUserType:(0,et.qf)(e),experience:tt.VP.SignIn},i={utmCampaign:"toolbarMenu",utmSource:"signedOutUI"};(0,rt.B)((0,$.OB)().experimentClient)?(0,$.OB)().bgRpc.api.launchAuthFlow(!1,{...(0,Ze.xW)(t),...(0,it.OC)((0,it.g7)(i))}):self.open((0,it.s7)(t,i),"_blank","noreferrer")}},J=new Le.L(X,v.h.combine(q.view((e=>{var t;return!1===(null===(t=null==e?void 0:e.status)||void 0===t?void 0:t.cheetahEnabled)})),g.view(D.tS((e=>D.ij(e.cheetahState)))),((e,t)=>(0,a.zG)(t,D.hX((()=>!e)),D.g_((()=>({enabled:!1})),(e=>({enabled:!0,userState:e}))))))),Z=p.pipe(Ve.Q(Ye.E),Ke.R(((e,t)=>{const i=e.filter(_t);return t&&_t(t)?[...i,t]:i}),[]),E.U(Ue.Z$),pe.shareReplay({bufferSize:1,refCount:!0})),ee=R.a([Z,f,m]).pipe(E.U((([e,t,i])=>(0,a.zG)(e,D.hX((()=>t)),D.g_((()=>({})),(e=>({[Ne.n.initialPopupAnchor]:i?{reference:e,placement:"top",offset:8,boundaryAreaPadding:10}:void 0,[Ne.n.initialBTSPopupAnchor]:i?{reference:e,placement:"top",offset:8,boundaryAreaPadding:10}:void 0}))))))),te=e=>{null==Y||Y.debug(`Completing step [${e}]`);y.get()[e].extension.completed||A({[e]:{completed:!0,lastSeen:Date.now()}})},ie={flush:()=>s.fF((()=>new Xe.y((t=>{const i=new _.w0;return k.empty.get()?t.next(void 0):(k.flush(),(0,a.zG)(e.get(),D.g_((()=>t.next(void 0)),(e=>{i.add(e.messages.pipe(I.h((e=>e._tag===se.J8.Type.submitOtAck)),Qe.L(500,T.of(null)),P.b((()=>t.next(void 0)))).subscribe())})))),()=>i.unsubscribe()})).pipe(x.q(1)).toPromise())),getText:e=>s.tD((()=>B(e))),insertText:e=>s.tD((()=>M(e))),copyText:e=>(0,st.v)(e),setContextHighlight:(e,t)=>{z.set(D.G({range:e,visibility:t}))},selectedRange:F,textUpdated:H,trimmedTextLength:H.pipe(U.O(null),E.U((()=>B({start:0,end:Number.MAX_SAFE_INTEGER}).trim().length)),O.x(),pe.shareReplay({refCount:!0,bufferSize:1}))},ne={domain:T.of(L),submitFeedback:e=>s.Y3((()=>(0,a.zG)(e.source,(e=>e===qe.x.Source.resultCard?"cheetah-card":e===qe.x.Source.quickReplyInitialActions||e===qe.x.Source.intentCard?"cheetah-quick-reply":void(0,_e.L0)(e)),(t=>G.feedbackFormSubmit(e.mood,t,e.domain,e.message)))),(e=>new Error(String(e))))},re=new We.j(v.h.create({contextUpdatesClient:N.isGateEnabled(le.K.CheetahSelectionContextUpdates)&&"test"===N.getTreatment(nt.p.CheetahSelectionContextUpdates),contextUpdatesServer:N.isGateEnabled(le.K.CheetahSelectionContextUpdatesServer)&&"test"===N.getTreatment(nt.p.CheetahSelectionContextUpdates)})),ae=new dt(W),oe=new at.m(N);return{capiService:X,userService:Q,genAIAvailabilityService:J,textEditorService:ie,feedbackService:ne,selectionContextAvailabilityService:re,toneDetectorService:ae,experimentService:oe,skillService:j.Fc(V),createOnboardingViewModels:()=>{const e=new Set;C.get().compose||e.add(d.T.StepName.initial),C.get().onboarding||(e.add(d.T.StepName.initial),e.add(d.T.StepName.initialBTS),e.add(d.T.StepName.prompts),e.add(d.T.StepName.review),e.add(d.T.StepName.knowledgeHub),e.add(d.T.StepName.references));const t=(0,a.zG)(g.get(),D.UI((e=>"ASSIGNMENT_WRITING"===e.defaultDocumentContext.writingIntent)),D.fS(a.jv));return C.get().onboardingBTS&&t||e.add(d.T.StepName.initialBTS),C.get().knowledgeHubIntegration||e.add(d.T.StepName.knowledgeHub),(0,$e.Q)({capiService:X,upstreamOnboardingState:y,session:c.pipe(w.w(D.g_((()=>T.of(D.YP)),(e=>e.genAISession)))),textStats:u,forceDisabledOnboardingSteps:e,assistantUIActions:K,externalElements:ee,hideAssistantOnboardingTooltips:c.pipe(w.w(D.g_((()=>v.h.create(!1)),(e=>e.dragBehavior.pipe(E.U((e=>"draggable"===e.kind&&e.isDragging))))))),promptsAllocated:J.availability.view(h._.getPromptsAllocated),client:"extension",disposed:b,completeOnboardingStep:te})},notifyAssistantUIAction:e=>K.next(e),dispose:()=>{J.dispose(),re.dispose()}}}function _t(e){return e.isConnected&&null!==e.offsetParent}function St(e,t){return{assistantMode:"genAI",source:t,genAIParams:{genAISessionMode:e}}}var yt=i(8065),wt=i(23650),At=i(5388),It=i(44675),xt=i(14527),Ct=i(55341),kt=i(39214),Rt=i(53680);class Et extends Error{constructor(e,t){var i;super(`Failed to apply alert. Reason: ${null!==(i=null==t?void 0:t.toString())&&void 0!==i?i:"unknown"}. Alert ID: ${e.alertId}. Alternative index: ${e.alternativeIndex}. Feed form: ${e.feedForm}.`),this.name="ApplyAlertError"}}async function Pt(e,t,i,n,r,s){var o,l,c,h,d,u;const g=t(e.alertId);if(D.Wi(g))throw new Et(e,"alert-not-found");if(!Pe.S.isCapiAlert(g.value))throw new Et(e,"alert-not-supported");const p=function(e,t){if(re.$.isWithTransformJson(e)){const i=(0,a.zG)(e.transformJSON.alternatives,D.tS((e=>D.ij(e.alternatives[t.alternativeIndex]))),D.UI((e=>e.delta)),D.pF((()=>null)));if(null===i)throw new Et(t,"alternative-not-found");return i}if(re.$.isWithSubAlerts(e)){const i=(0,a.zG)(e.subalerts.alternatives,D.tS((e=>D.ij(e.alternatives[t.alternativeIndex]))),D.UI((e=>e.delta)),D.pF((()=>null)));if(null===i)throw new Et(t,"alternative-not-found");return i}if(re.$.isWithPosition(e))return(new xt.i).retain(e.transformRange.start).delete(e.transformRange.end-e.transformRange.start).insert(e.transformText);(0,_e.L0)(e)}(g.value,e),f=(0,kt.g)(p),m=(0,kt.B)(p);if(f.length||!(0,$.OB)().experimentClient.isGateEnabled(le.K.CheetahExecReplacementOnlyWhenItsExists)){let t;const n=new Ct.t(1),a=r.contentChanges.immediate.pipe(F.b(0)).subscribe(n);try{t=await Promise.race([i.performBatchReplacements(f,{alert:g.value}),(0,It.gw)(null!==(c=null===(l=null===(o=s.get().oggy)||void 0===o?void 0:o.alertService)||void 0===l?void 0:l.applyAlertsPerformBatchReplacementsTimeoutMs)&&void 0!==c?c:1e3,new Et(e,"perform-batch-replacements-timeout")).then((()=>[]))])}catch(t){throw t instanceof Et?t:new Et(e,"perform-batch-replacements-critical-error")}const p=t.find(Rt.j.isFail);if(p&&Rt.j.isFail(p))throw new Et(e,p.reason);await Promise.race([n.pipe(x.q(1)).toPromise(),(0,It.gw)(null!==(u=null===(d=null===(h=s.get().oggy)||void 0===h?void 0:h.alertService)||void 0===d?void 0:d.applyAlertsWaitForTextMapContentChangesTimeoutMs)&&void 0!==u?u:1e3,new Et(e,"wait-for-text-map-content-changes-timeout"))]),a.unsubscribe()}const v=n();if(D.pC(v)&&m.length>0)for(const t of m)try{await v.value.apply(t.range,t.formatting)}catch(t){throw new Et(e,"apply-formatting-critical-error")}}var Tt=i(80315);class Ot{constructor(e){var t;this._params=e,this._subs=new _.w0,this._logger=ce.Y.create("AlertServiceImpl"),this._replacementService=this._params.replacementServiceInjector.create(At.P.oggyRevisionSequential),this._selectedAlertId=v.h.create(this._params.initialAlertId),this._applyAlertsSequentiallyRequests=new S.x,this.selectedAlertId=this._selectedAlertId.view(),this.alertCollectionChanges=(t=this._params.alertProcessor.alerts,ft.P((()=>t.changes.pipe(E.U((e=>{const t=new Set(e.addedAlerts.filter(Pe.S.isCapiAlert).map((e=>e.id))),i=new Set(e.removedAlerts.filter((e=>Pe.S.isCapiAlert(e.alert))).map((e=>e.id)));return[...e.addedAlerts.filter(Pe.S.isCapiAlert).filter((e=>!i.has(e.id))).map((e=>(0,Tt.Tm)(e.id))),...e.removedAlerts.filter((e=>Pe.S.isCapiAlert(e.alert))).filter((e=>!t.has(e.id))).map((e=>(0,Tt.qQ)(e.id,"textChange"===e.reason._tag?"textChange":"other")))]})),U.O(Array.from(t.getAll()).filter(Pe.S.isCapiAlert).map((e=>(0,Tt.Tm)(e.id)))),I.h((e=>e.length>0)))))),this._subs.add(this._params.alertStateService.getActiveAlertByClick().pipe(E.U((e=>{var t;return null!==(t=null==e?void 0:e.alertId)&&void 0!==t?t:null}))).subscribe(k.wW(this._selectedAlertId))),this._subs.add(this._applyAlertsSequentiallyRequests.pipe(yt.b((({applyAlertsInfo:e,deferredPromise:t})=>mt.D(this._applyAlertsSequentially(e).then(t.resolve).catch(t.reject))))).subscribe())}async _applyAlertsSequentially(e){try{this._logger.debug("Applying alerts sequentially.",{applyAlertsInfo:e});const t=async function(e,t,i,n,r,s){for(const a of e)await Pt(a,t,i,n,r,s)}(e,(e=>D.ij(this._params.alertProcessor.alerts.getAlertById(e))),this._replacementService,this._params.getFormattingService,this._params.textObserver,this._params.dynamicConfig);this._params.experimentClient.isGateEnabled(le.K.SendChangesToCAPIAfterSequentialApply)&&this._params.requestAwaitService.addRequest(t),await t}catch(t){throw this._logger.warn("Error applying alerts sequentially.",{applyAlertsInfo:e,error:t}),t}}applyAlerts(e){this._logger.debug("Received apply alerts request.",{applyAlertsInfo:e});const t=(0,It.II)();return this._applyAlertsSequentiallyRequests.next({applyAlertsInfo:e,deferredPromise:t}),t.promise}removeAlerts(e){try{return e.forEach((({alertId:e,removalReason:t})=>{this._params.alertProcessor.removeAlert(e,{_tag:"alertApplied"===t?wt.i.alertAccepted:wt.i.ignore})})),Promise.resolve()}catch(t){return this._logger.warn("Error removing alerts.",{removeAlertsInfo:e,error:t}),Promise.reject(t)}}scrollAlertIntoView(e){try{return this._params.highlightsScroller.scrollAlertIntoView(e),Promise.resolve()}catch(t){return this._logger.warn("Error scrolling alert into view.",{scrollAlertIntoViewInfo:e,error:t}),Promise.reject(t)}}setAlertsVisibility(e){try{return this._params.highlightsUpdater.setAlertsVisibility(e),Promise.resolve()}catch(t){return this._logger.warn("Error setting alerts visibility.",{alertsVisibilityInfo:e,error:t}),Promise.reject(t)}}updateAlertsVisibility(e){try{return this._params.highlightsUpdater.updateAlertsVisibility(e),Promise.resolve()}catch(t){return this._logger.warn("Error updating alerts visibility.",{alertsVisibilityInfo:e,error:t}),Promise.reject(t)}}dispose(){this._subs.unsubscribe()}}var Ut=i(44987),Bt=i(72847);function Mt(e){const t={lifecycleService:e.lifecycleService,capiService:e.capiService,uphookService:e.uphookService,feedbackService:e.feedbackService,experimentService:e.experimentService,textEditorService:e.textEditorService,userService:e.userService,notifyAssistantUIAction:e.notifyAssistantUIAction,trackingService:e.trackingService,humanWritingReportService:e.hwrService,theme:void 0,deepLinkService:e.deepLinkService},i=()=>function(e){const t=v.h.create(e.initialAlertId),i=e.alertStateService.getActiveAlertByClick().pipe(E.U((e=>{var t;return null!==(t=null==e?void 0:e.alertId)&&void 0!==t?t:null}))).subscribe(k.wW(t));return{sduiService:{supportedForms:e.supportedForms,sduiItemCollectionChanges:(n=e.getSDUIBuffer,r=e.inboundCAPIEvents,pt.z(ft.P((()=>T.of(n()))),r.pipe(I.h((0,b.Kg)(Bt.hX.is("sdui_add"),Bt.hX.is("sdui_update"),Bt.hX.is("sdui_remove"),(0,b.W9)(Bt.hX.is("session_started"),(e=>e.isNewSession)))),E.U((e=>[e])))).pipe(E.U(Ue.UI((e=>{switch(e.kind){case"sdui_add":return(0,Ut.K5)(e.sduiRootId,e.sdui);case"sdui_update":return(0,Ut.FE)(e.sduiRootId,e.sdui);case"sdui_remove":return(0,Ut.Ul)(e.sduiRootId);case"session_started":return(0,Ut.Sq)();default:return(0,_e.L0)(e)}}))),I.h((e=>e.length>0)),E.U((e=>({changes:e,pendingChangesCount:0})))))},alertService:new Ot({initialAlertId:e.initialAlertId,alertProcessor:e.alertProcessor,alertStateService:e.alertStateService,replacementServiceInjector:e.replacementServiceInjector,requestAwaitService:e.requestAwaitService,highlightsScroller:e.highlightsScroller,highlightsUpdater:e.highlightsUpdater,getFormattingService:e.getFormattingService,experimentClient:e.experimentClient,dynamicConfig:e.dynamicConfig,textObserver:e.textObserver}),dispose:()=>{e.highlightsUpdater.clearAll(),i.unsubscribe()}};var n,r}({getSDUIBuffer:e.getSDUIBuffer,inboundCAPIEvents:e.inboundCAPIEvents,alertProcessor:e.alertProcessor,initialAlertId:He(e.openParams),highlightsUpdater:e.highlightsUpdater,highlightsScroller:e.highlightsScroller,replacementServiceInjector:e.replacementServiceInjector,getFormattingService:e.getFormattingService,requestAwaitService:e.requestAwaitService,alertStateService:e.alertStateService,supportedForms:e.supportedForms,experimentClient:e.experimentClient,dynamicConfig:e.dynamicConfig,textObserver:e.textObserver}),n=i=>({...t,kind:"genAI",genAIAvailabilityService:e.genAIAvailabilityService,genAIStartSessionOptions:De(i,{disableKnowledgeEngine:!!e.disableKnowledgeEngine||void 0},e.getQuickReplyContext(),e.url),selectionContextAvailabilityService:e.selectionContextAvailabilityService,skillService:(0,D.FS)(e.skillService),notifyGenAISessionStateChanged:t=>e.genAISession.set(t),isTranslationAvailable:e.isTranslationAvailable});return{getGenAIDeps:n,getRevisionDeps:()=>(0,a.zG)(i(),(({alertService:i,sduiService:n,dispose:r})=>({...t,initialView:"genAI"!==e.openParams.assistantMode&&"genAIAndWritingExpert"!==e.openParams.assistantMode&&"emojiButtonSource"===e.openParams.source.kind?"toneReport":void 0,kind:"revision",alertService:i,sduiService:n,toneDetectorService:e.toneDetectorService,settingsOptions:{kind:"withView",getView:()=>e.settingsService.getView()},isPlagiarismEnabled:e.isPlagiarismEnabled,isWritingExpertEnabled:e.isWritingExpertEnabled,performanceScoreOptions:e.experimentClient.isGateEnabled(le.K.PerformanceScoreOggy)?{showEntryPoint:!0}:void 0,isAiDetectorEnabled:(0,a.zG)(e.capiStartAckMessage.view(D.UI((({allowedFeatures:e})=>e.includes("AI_DETECTOR"))))),isAiStudioEnabled:(0,a.zG)(e.capiStartAckMessage.view(D.UI((({allowedFeatures:e})=>e.includes("AI_STUDIO"))))),dispose:r}))),getGenAIAndWritingExpertDeps:e=>{const{alertService:t,sduiService:r}=i();return{...n(e),kind:"genAIAndWritingExpert",alertService:t,sduiService:r}}}}var Ft=i(4809),Ht=i(63349),Dt=i(71783),jt=i(11478),zt=i(2852),Gt=i(27327),Lt=i(40466);const Nt=Ht.ux.style({fontStyle:"normal",fontWeight:"normal",fontFamily:"Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif, Arial",$nest:{"button, input, textarea":{fontFamily:"inherit"}}}),$t=({children:e})=>o.createElement(Gt.o,null,o.createElement(Dt.G.DefaultProvider,null,o.createElement("div",{className:Nt},e,o.createElement(jt.X,null)))),qt=({children:e})=>{const{onMount:t,ref:i}=zt.P.useElWatcher();return o.createElement(Gt.o,null,o.createElement(Dt.G.DefaultProvider,null,o.createElement("div",{className:Nt,ref:t,"data-role":"onboarding-tooltips",style:{position:"absolute",zIndex:Lt.dl+1}},o.createElement(Ft.l.Provider,{value:{portalContainer:i}},e),o.createElement(jt.X,null))))};var Wt=i(67528);const Vt=({width:e,height:t,top:i,left:n,visibility:r})=>o.createElement("div",{"data-grammarly-part":"cheetah-highlight-rect",...(0,m.Sh)(Wt.highlightRect,"hidden"===r?Wt.hidden:null,"attention"===r?Wt.attention:null),style:{width:e,height:t,top:i,left:n}});var Yt=i(58041),Kt=i(52654),Xt=i(69652),Qt=i(85670);const Jt=({referenceElement:e,placement:t,offset:i,disabled:n,onMagicRewriteClick:r,onOpenRewriteClick:s,onOpenTranslateClick:a})=>{const[l,c]=o.useState(null),{styles:h,attributes:d}=(0,Kt.D)(e,l,{placement:t,modifiers:i?[{name:"offset",options:{offset:i}}]:[]});return r||s?o.createElement("div",{ref:c,style:h.popper,...d.popper,onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},"data-grammarly-part":"cheetah-entry-button",className:Qt.entryButton,"data-disabled":n},r?o.createElement(Xt.u,{message:"Improve it"},o.createElement("button",{onClick:r,onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},className:Qt.entryButtonItem,"data-disabled":n},o.createElement("i",{className:Qt.rewriteIcon}))):null,a?o.createElement(Xt.u,{message:"Translate with Grammarly"},o.createElement("button",{onClick:a,onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},className:Qt.entryButtonItem,"data-disabled":n},o.createElement("i",{className:Qt.translateIcon}))):null,s?o.createElement(Xt.u,{message:"Rewrite with Grammarly"},o.createElement("button",{onClick:s,onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},className:Qt.entryButtonItem,"data-disabled":n},o.createElement("i",{className:Qt.openIcon}))):null):null};var Zt=i(19437);const ei=({referenceElement:e,placement:t,offset:i,disabled:n,onClick:r})=>{const[s,a]=o.useState(null),{styles:l,attributes:c}=(0,Kt.D)(e,s,{placement:t,modifiers:i?[{name:"offset",options:{offset:i}}]:[]});return o.createElement("button",{ref:a,style:l.popper,...c.popper,onClick:r,onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},"data-grammarly-part":"cheetah-reply-button",className:Zt.replyButton,"data-disabled":n},o.createElement("div",{className:Zt.icon}),o.createElement("span",null,"Reply quickly"))};var ti=i(33885),ii=i(44071),ni=i(57402);const ri=()=>o.createElement("svg",{className:ni.icon,viewBox:"0 0 16 16",fillRule:"evenodd",clipRule:"evenodd",strokeLinecap:"round"},o.createElement("path",{d:"M8,16C12.418,16 16,12.418 16,8C16,3.582 12.418,0 8,0C3.582,0 0,3.582 0,8C0,12.418 3.582,16 8,16Z",fill:"#0A9A78"}),o.createElement("path",{d:"M4,8L12,8M8,4L8,12",fill:"none",fillRule:"nonzero",stroke:"white",strokeWidth:"1.5px"})),si=({overflow:e,...t})=>e?o.createElement(oi,{...t}):o.createElement(ai,{...t}),ai=({left:e,top:t,height:i})=>o.createElement(o.Fragment,null,o.createElement("div",{"data-grammarly-part":"cheetah-quasi-caret",className:ni.quasiCaret,style:{left:e,top:t+i,height:i+8}},o.createElement(ri,null))),oi=({left:e,top:t,height:i})=>{const{ref:r,onMount:s}=zt.P.useElWatcher(),l=o.useMemo((()=>v.h.create(D.YP)),[]),{rect:c,onMount:h}=zt.P.useRectWatcher(),d=o.useCallback((e=>{e.style.pointerEvents="all",l.set((0,a.zG)(n.Yt(D.Kw)({rect:D.G(e.getBoundingClientRect()),goodParent:(0,a.zG)(e.getBoundingClientRect(),(e=>({x:e.x+e.width/2,y:e.y+e.height/2})),(({x:e,y:t})=>{var i,n;return D.ij(null===(n=null===(i=document.elementFromPoint(e,t))||void 0===i?void 0:i.shadowRoot)||void 0===n?void 0:n.elementFromPoint(e,t))}),D.hX((t=>t===e||e.contains(t||null))))}),D.g_((()=>D.YP),(({rect:e})=>D.G({x:e.x,y:e.y}))))),e.style.pointerEvents="none"}),[]),u=o.useMemo((()=>ii.R(document,"scroll",{capture:!0}).pipe(U.O(null))),[]);return zt.P.useSubscriptionTo(R.a([r.pipe(y.oA),u,c]).pipe(P.b((([e])=>d(e))))),o.createElement(o.Fragment,null,o.createElement("div",{"data-grammarly-part":"cheetah-quasi-caret",className:ni.quasiCaret,style:{left:e,top:t+i,height:i+8},ref:e=>{s(e),h(e)}},o.createElement(ti.F.div,{style:l.pipe(E.U((e=>(0,a.zG)(e,D.g_((()=>({opacity:1})),(()=>({opacity:0})))))))},o.createElement(ri,null))),o.createElement(ti.F.Fragment,null,l.pipe(E.U((e=>(0,a.zG)(e,D.g_(a.gn,(e=>o.createElement("div",{"data-grammarly-part":"cheetah-quasi-caret-fixed-bro",className:ni.quasiCaret,style:{transform:"none",position:"fixed",left:e.x,top:e.y,height:i+8}},o.createElement(ri,null))))))))))},li=(0,m.xb)(Yt.G),ci=new Set(["loginSSO","accountMigration","standWithUkraineGrammarlySuspended","claimedUser","dataControl","noPaymentMethodSubscription","grammarlyBusinessSigninPopup","gdocsFeedbackUI"]),hi=new Set(["loginSSO","accountMigration","standWithUkraineGrammarlySuspended","claimedUser","dataControl","grammarlyBusinessSigninPopup"]);function di(e){return"opened"===e.kind}function ui(e){return di(e)&&"revision"!==e.assistantMode}class gi{constructor(e){this._params=e,this._subs=new _.w0,this._log=ce.Y.create("CheetahFeatureImpl"),this._inlineButtonUI=v.h.create(null),this._ideateButtonUI=v.h.create(null),this._expandedIdeateButtonUI=v.h.create(null),this._assistantUI=v.h.create(null),this._highlightUI=v.h.create(null),this._quasiCaretUI=v.h.create(null),this._onboardingUI=v.h.create(null),this._nativeCursorHider=v.h.create(D.YP),this._contextHighlight=v.h.create(D.YP),this._highlightsUpdater=new be({getAlertById:e=>this._params.alertProcessor.alerts.getAlertById(e),aquaAlertsWiring:this._params.aquaAlertsWiring,alertStateService:this._params.alertStateService,logger:ce.Y.create("cheetah.revision.highlights")}),this._highlightsScroller=new ue({integration:this._params.integration,getAlertById:e=>this._params.alertProcessor.alerts.getAlertById(e)}),this._codaInlineToolbarHidden=v.h.create(!0),this._ideateButtonTooltipNotificationState=v.h.create(D.YP),this._assistantFocused=v.h.create(!1),this._inlineButtonRecentlyPressed=v.h.create(!1),this._ideateButtonRecentlyHovered=v.h.create(!1),this._selectionRange=v.h.create(D.YP),this._isTranslationAvailable=v.h.create(!1),this._highlights=v.h.create([]),this._quasiCaretRect=v.h.create(D.YP),this._assistantUIState=v.h.create(D.YP),this._onboardingViewModels=v.h.create(D.YP),this._ideateButtonRefChange=new S.x,this._disposed=new S.x,this._initialOnboardingBlockedForSession=v.h.create(!1),this._inboundCAPIEvents=new S.x,this._assistantServices=bt(this._params.checkingService,this._params.checkingService.pipe(y.oA,w.w((e=>e.capiMessages))),(()=>Object.values(this._params.latestCAPIMessages.get())),this._params.user,this._params.csPageState,this._params.dapiSettings.view((e=>{var t,i;return null!==(i=null!==(t=e.dialectStrong)&&void 0!==t?t:e.dialectWeak)&&void 0!==i?i:"american"})),(e=>s.fF((()=>this._params.dapiActions.changeStrongDialect(e)))),this._assistantUIState,this._params.textStats,this._params.capiStartAckMessage,this._ideateButtonRefChange,v.h.combine(this._params.integration.canShowIdeateButtonPopups,this._params.gButtonPopupState.view("type").view((e=>!ci.has(e))),b.xD),v.h.combine(this._params.csPageState.view("cheetah").view((e=>(null==e?void 0:e.canShowInitialOnboarding)||(null==e?void 0:e.canShowInitialBTSOnboarding)||!1)),this._initialOnboardingBlockedForSession,((e,t)=>e&&!t)),A.T(this._params.csPageState.view("isActiveTab").pipe(I.h((e=>!e))),this._disposed).pipe(x.q(1)),this._params.dapiSettings.view((e=>{const t=function(e){const t=c.Z.State.toClientState(c.Z.decode(e.extension||""),"extension"),i=c.Z.State.toClientState(c.Z.decode(e.editor||""),"editor"),n=c.Z.State.toClientState(c.Z.decode(e.llamaMac||""),"llamaMac"),r=c.Z.State.toClientState(c.Z.decode(e.llamaWin||""),"llamaWin");return(0,a.zG)(c.Z.State.empty,c.Z.State.patch(t,"extension"),c.Z.State.patch(i,"editor"),c.Z.State.patch(n,"llamaMac"),c.Z.State.patch(r,"llamaWin"))}({extension:e["cheetah:onboardingState"],editor:e["cheetah:onboardingState:editor"],llamaMac:e["cheetah:onboardingState:llamaMac"],llamaWin:e["cheetah:onboardingState:llamaWin"]});return this._log.debug("DAPI onboarding state",t),t})),(e=>{this._params.dapiActions.modifyCheetahOnboardingState((0,a.ls)(c.Z.decode,(t=>(0,a.zG)(c.Z.State.toClientState(t,"extension"),(t=>({...t,...e})),(e=>c.Z.State.patch(e,"extension")(t)))),c.Z.encode))}),this._params.featureFlags,this._params.textChangeBuffer,(e=>this._params.integration.getText(e)),(e=>this._insertText(e)),this._selectionRange,this._params.integration.textUpdated,this._contextHighlight,this._params.gnar,this._params.domain,this._params.experimentClient,this._params.csPageState.view("cheetah"),this._params.alertProcessor,this._params.skillService,this._log),this._isOnboardingPopupVisible=v.h.create(!1),this._openAssistantSubject=new S.x,this._assistantApplet=v.h.create(null),this._latestOpenAssistantParams=null,this.preloadUI=this._assistantApplet.view((e=>null==e?void 0:e.preloadUI)),this.inlineButtonUI=this._inlineButtonUI.view(),this.ideateButtonUI=this._ideateButtonUI.view(),this.expandedIdeateButtonUI=this._expandedIdeateButtonUI.view(),this.assistantUI=this._assistantUI.view(),this.highlightUI=this._highlightUI.view(),this.quasiCaretUI=this._quasiCaretUI.view(),this.onboardingUI=this._onboardingUI.view(),this.assistantState=this._assistantUI.view((0,a.ls)(D.ij,D.tS((()=>{var e;return D.ij(null===(e=this._latestOpenAssistantParams)||void 0===e?void 0:e.assistantMode)})),D.g_((()=>({kind:"closed"})),(e=>({kind:"opened",assistantMode:e}))))),this.isOnboardingPopupVisible=this._isOnboardingPopupVisible.view(),this.isTranslationAvailable=this._isTranslationAvailable.view(),this.isAvailable=v.h.combine(this._assistantServices.genAIAvailabilityService.availability.view((0,b.ff)(h._.isUnavailable)),this._params.csPageState.view("cheetah"),((e,t)=>{var i;return e&&!0===(null===(i=null==t?void 0:t.status)||void 0===i?void 0:i.cheetahEnabled)})),this.userSettings=this._assistantServices.genAIAvailabilityService.availability.view((e=>e.kind===h._.Kind.disabled||e.kind===h._.Kind.unavailable?{inlineQuickReplyEnabled:!1,inlineRewriteEnabled:!1}:e.userSettings)),this.assistantInjectionMode=this._params.integration.assistantInjectionMode,this.selectedAlerts=this._highlightsUpdater.selectedAlerts,this.onCodaToolbarClick=e=>{e.target instanceof HTMLElement&&e.target.closest('[data-coda-ui-id="inline-toolbar"]')&&this._codaInlineToolbarHidden.set(!1)},this._params.dapiActions.reloadPropsRateLimited(),this._subs.add(this._params.checkingService.pipe(y.oA,w.w((e=>e.capiEvents))).subscribe(this._inboundCAPIEvents)),this._subs.add(this._params.checkingService.pipe(y.oA,w.w((e=>e.readyState)),I.h((e=>e===se.kQ.ready||e===se.kQ.firstTextCheckCompleted)),x.q(1)).subscribe((()=>this._init()))),this._subs.add(this._setupIdeateTooltipStateObs());const t=this._onboardingViewModels.pipe(w.w(D.g_((()=>C.E),(e=>e.onboarding.uiActions))));this._subs.add(t.pipe(I.h(mi)).subscribe((()=>{this._params.cheetahCSActions.cheetahInitialOnboardingShown()}))),this._subs.add(t.pipe(I.h(vi)).subscribe((()=>{this._params.cheetahCSActions.cheetahInitialBTSOnboardingShown()}))),this._subs.add(this._getOnboardingVMStepActive([d.T.StepName.initial,d.T.StepName.initialBTS]).subscribe(k.wW(this._isOnboardingPopupVisible))),this._subs.add(this._params.gButtonPopupState.view("type").view((e=>hi.has(e))).subscribe((e=>{e&&this._initialOnboardingBlockedForSession.set(!0)})));const i=v.h.create(!1);this._subs.add(R.a([this._params.gButtonDisabledReason,this._params.integration.entryPointsEnabled]).pipe(E.U((([e,t])=>t&&!function(e){const t=new Set([ae.P.DATA_CONTROL_ACTIVE,ae.P.OFFLINE,ae.P.STAND_WITH_UKRAINE,ae.P.USER_CLAIMED,ae.P.USER_EDC_BLOCKED,ae.P.SIGNED_OUT_GB,ae.P.INACTIVE_INTEGRATION]);return null!==e&&t.has(e)}(e)))).subscribe(k.wW(i))),this._isAlwaysAvailableAssistantEnabled=(0,ne.I)(this._params.csPageState),this._inlineEntryPointsEnabled=v.h.combine(i,this._isAlwaysAvailableAssistantEnabled,((e,t)=>e&&!t)),this._ideationEntryPointsEnabled=this._inlineEntryPointsEnabled,this._subs.add(this._params.csPageState.view("cheetah").view((e=>{var t;return!1===(null===(t=null==e?void 0:e.status)||void 0===t?void 0:t.cheetahEnabled)})).pipe(I.h((()=>{var e;return"genAI"===(null===(e=this._latestOpenAssistantParams)||void 0===e?void 0:e.assistantMode)}))).subscribe((()=>this._closeAssistant(de.jg.disposed)))),this._registerDebugHelpers(),this._setupAssistantAppletInstance(),this._hwrService=this._params.hwrService}_setupAssistantAppletInstance(){0}closeAssistant(e){this._closeAssistant(e)}getHoveredStateBehavior(e){return this._highlightsUpdater.getHighlightVisualState(e)}getAlertsFilter(){return this._highlightsUpdater.alertsFilter}suggestStartSessionMode(){const e=this._params.featureFlags.get();return(0,a.zG)(this._params.integration.selectionRange.get(),D.hX((t=>fi(t)&&e.rewrite)),D.g_((()=>"ideation"),(()=>"rewrite")))}_init(){this._subs.add(this._assistantFocused.subscribe((e=>this._log.debug("Assistant "+(e?"focused":"blurred"))))),this._subs.add(this._openAssistantSubject.pipe(w.w((e=>(this._latestOpenAssistantParams=e,this._openAssistant(e))))).subscribe()),this._subs.add(this._params.openAssistant.subscribe(this._openAssistantSubject)),this._subs.add(this._getInlineButtonUI().subscribe(k.wW(this._inlineButtonUI))),this._subs.add(this._getIdeateButtonUI().subscribe(k.wW(this._ideateButtonUI))),this._subs.add(this._getExpandedIdeateButtonUI().subscribe(k.wW(this._expandedIdeateButtonUI))),this._subs.add(this._getHighlightUI().subscribe(k.wW(this._highlightUI))),this._subs.add(this._getQuasiCaretUI().subscribe(k.wW(this._quasiCaretUI))),this._subs.add(this._getOnboardingUI().subscribe(k.wW(this._onboardingUI))),this._subs.add(this._updateSelectionRange().subscribe(k.wW(this._selectionRange))),this._subs.add(this._updateHighlightRects().subscribe(k.wW(this._highlights))),this._subs.add(this._updateQuasiCaretRect().subscribe(k.wW(this._quasiCaretRect))),this._subs.add(this._updateNativeCursor().subscribe()),this._subs.add(this.assistantState.subscribe((e=>{di(e)&&this._params.closeLegacyAssistant()}))),this._subs.add(this._createOnboardingViewModelWhenCheetahAvailable().subscribe()),this._subs.add(this._handleTryItOut().subscribe()),this._subs.add(this._updateTranslationIsAvailable().subscribe(k.wW(this._isTranslationAvailable))),oe.LF.test(this._params.domain)&&document.addEventListener("click",this.onCodaToolbarClick)}_handleTryItOut(){return this._onboardingViewModels.pipe(w.w(D.g_((()=>C.E),(e=>e.onboarding.uiActions))),I.h(u.l.is(u.l.Kind.tryItOut)),P.b((()=>this._openAssistantSubject.next({assistantMode:"genAI",source:{kind:"onboardingSource"},genAIParams:{genAISessionMode:pi(this._params.integration.quickReplyContext.get())&&this._params.featureFlags.get().quickReply?"quickReply":"ideation"}}))))}_getOnboardingVMStepActive(e){return this._onboardingViewModels.pipe(w.w(D.g_((()=>T.of(!1)),(t=>t.onboarding.activeStep.view((0,a.ls)(D.hX((e=>e.show)),D.UI((t=>e.includes(t.name))),D.fS(a.jv)))))),O.x())}_setupIdeateTooltipStateObs(){return this._assistantServices.genAIAvailabilityService.availability.pipe(U.O(null),B.G(),E.U((([e,t])=>e&&t&&h._.isPassive(e)&&h._.isActive(t)?D.G("Youâ€™ve got prompts!"):D.YP)),w.w(D.g_((()=>T.of(D.YP)),(e=>A.T(T.of(D.G(e)),T.of(D.YP).pipe(M.g(3e3))))))).subscribe(k.wW(this._ideateButtonTooltipNotificationState))}_registerDebugHelpers(){}_createOnboardingViewModelWhenCheetahAvailable(){return v.h.combine(this._params.featureFlags,this._assistantServices.genAIAvailabilityService.availability.view(h._.isUsable),((e,t)=>e.onboarding&&t)).pipe(P.b((e=>this._onboardingViewModels.modify((t=>((0,a.zG)(t,j.bw((e=>e.onboarding.dispose()))),e?D.G(this._assistantServices.createOnboardingViewModels()):D.YP))))))}_onClickIdeateButton(e){di(this.assistantState.get())?this._closeAssistant(de.jg.closed):this._openAssistantSubject.next({assistantMode:"genAI",source:{kind:"gButtonSource"},genAIParams:{genAISessionMode:e}})}_updateTranslationIsAvailable(){const{integration:e,textObserver:t,languageDetector:i,gnar:n,featureFlags:r}=this._params;return R.a([e.selectionRange,this.assistantState.view(di),this._assistantServices.genAIAvailabilityService.availability]).pipe(E.U((([e,t,i])=>({selectionRange:e,assistantOpened:t,availability:i}))),I.h((({assistantOpened:e,availability:t})=>!e&&h._.isUsable(t)&&r.get().inlineTranslate)),E.U((({selectionRange:e})=>e)),y.oA,I.h((e=>fi(e))),E.U((({start:e,end:i})=>t.getTextSource().getPlainText().slice(e,i))),w.w((e=>i.isEnglish(e))),E.U((({result:e})=>null!==e&&!e)),P.b((e=>{e&&n.appActionsInlineTranslateButtonShow()})))}_updateSelectionRange(){return R.a([this._params.integration.selectionRange,this.assistantState.view(di)]).pipe(E.U((([e,t])=>({selectionRange:e,assistantIsFocused:this._assistantFocused.get(),inlineButtonRecentlyPressed:this._inlineButtonRecentlyPressed.get(),ideateButtonRecentlyHovered:this._ideateButtonRecentlyHovered.get(),initialPopupOnboardingStepIsActive:this.isOnboardingPopupVisible.get(),assistantOpened:t}))),P.b((({inlineButtonRecentlyPressed:e,ideateButtonRecentlyHovered:t,selectionRange:i})=>{e&&this._inlineButtonRecentlyPressed.set(!1),t&&this._ideateButtonRecentlyHovered.set(!1),!D.Wi(i)&&fi(i.value)||this._codaInlineToolbarHidden.set(!0)})),I.h((({selectionRange:e,assistantIsFocused:t,inlineButtonRecentlyPressed:i,ideateButtonRecentlyHovered:n,initialPopupOnboardingStepIsActive:r,assistantOpened:s})=>!i&&!n&&(!s||(!D.Wi(e)||!t&&!r)))),E.U((({selectionRange:e})=>e)))}_updateHighlightRects(){return e=this._selectionRange,t=this._contextHighlight,i=this._params.integration,R.a([e.pipe(w.w(D.g_((()=>T.of([])),(e=>i.getHighlightRects(e).pipe(E.U((e=>e.map((e=>({rect:e,visibility:"visible"})))))))))),t.pipe(w.w(D.g_((()=>T.of([])),(e=>i.getHighlightRects(e.range).pipe(E.U((t=>t.map((t=>({rect:t,visibility:e.visibility}))))))))))]).pipe(E.U((([e,t])=>t.find((e=>"hidden"!==e.visibility))?t:e)));var e,t,i}_updateQuasiCaretRect(){return R.a([this._selectionRange,this._highlightsUpdater.hasHighlights]).pipe(w.w((([e,t])=>(0,a.zG)(e,D.hX((()=>!t)),D.hX(re.SV.isCollapsed),D.g_((()=>T.of([])),(e=>this._params.integration.getHighlightRects(e)))))),E.U((e=>(0,a.zG)(e,r.c2,D.UI((e=>e[e.length-1]))))))}_updateNativeCursor(){return v.h.combine(this._quasiCaretRect,this._params.experimentClient.isGateEnabled(le.K.UnfixFast570)?this.assistantState.view(di):this.assistantState.view(ui),((e,t)=>(0,a.zG)(n.Yt(D.Kw)({nativeUIHider:D.ij(this._params.integration.createNativeUIHider),quasiCaretRect:e}),D.hX((()=>t)),j.ew((()=>{this._nativeCursorHider.modify((e=>((0,a.zG)(e,j.bw((e=>e.dispose()))),D.YP)))})),j.bw((({nativeUIHider:e})=>{this._nativeCursorHider.modify((t=>((0,a.zG)(t,j.bw((e=>e.dispose()))),D.G(e()))))})))))}_closeAssistant(e){var t,i,n;this._assistantUIState.set(D.YP),this._assistantUI.set(null),e!==de.jg.closed&&e!==de.jg.assistantBlurred||this._params.integration.focusTextField(),(null===(t=this._latestOpenAssistantParams)||void 0===t?void 0:t.assistantMode)&&(null===(i=this._params.assistantDidClose)||void 0===i||i.next(null===(n=this._latestOpenAssistantParams)||void 0===n?void 0:n.assistantMode))}async _openAssistant(e){xe.markOpenAttempt(),di(this.assistantState.get())&&this._closeAssistant(de.jg.disposed),this._assistantFocused.set(!0),"revision"!==e.assistantMode&&"pushRewrite"===e.genAIParams.genAISessionMode&&this._selectionRange.set(D.G(e.genAIParams.transformRange));try{const t=await this._params.getHostInfo(),i=({sizeBehavior:i,dragBehavior:n,readyToDrag:r})=>{const s=(0,he.D)(n).pipe(E.U((e=>"draggable"===e.kind&&e.isDragging))),{assistantHeight:l,assistantPosition:c,isPlagiarismEnabled:h,isWritingExpertEnabled:d}=this._params.integration,{gnar:u,checkingService:p,statisticsService:f}=this._params,m=new Oe({isDragging:s,height:l,position:c,gnar:u,checkingService:p,statisticsService:f,integration:this._params.integration,openAssistantParams:e,supportedForms:this._params.supportedForms}),b=new xe({sizeBehavior:i,dragBehavior:n,hostInfo:t,gnarTracking:m,onFocusStateChanged:e=>this._assistantFocused.set(e.isFocused),onReadyToDrag:e=>r(e),onVisuallyReady:()=>{var t;return null===(t=this._params.assistantDidOpen)||void 0===t?void 0:t.next(e.assistantMode)},onClose:()=>this._closeAssistant(de.jg.closed)}),_=v.h.create(D.YP),S=function(e,t,i=!1){return{performanceScoreReportShown:t=>{e.assistantPerformanceScoreReportShow(t)},feedSuccessStateShown:(i,n)=>{e.assistantSuccessStateShow(i,n,Se(t))},feedFormChanged:(i,n,r)=>{switch(i){case"shortForm":e.assistantSwitchToShortFormClick(n||void 0,null===r?void 0:r,Se(t));break;case"longForm":e.assistantSwitchToLongFormClick(n||void 0,null===r?void 0:r,Se(t));break;default:(0,_e.L0)(i)}},toneReportShown:({tones:i,brandTonesEnabled:n})=>{var r,s;e.emogenieReportShow(i.map((({name:e,confidence:t,prevalence:i})=>({name:e,confidence:t,prevalence:i}))),n,i.length,null!==(s=null===(r=D.WG(t.get()))||void 0===r?void 0:r.sessionUuid)&&void 0!==s?s:"")},feedLensShown:i=>{e.assistantLensShow(i,Se(t))},feedLensButtonClicked:i=>{e.assistantLensButtonClick(i,Se(t))},actionButtonClicked:(i,n,r,s,a)=>{e.assistantActionButtonClick(i,n,r,s,a,Se(t))},moreActionsButtonClicked:(i,n,r)=>{e.assistantMoreActionsButtonClick(i,n,r,Se(t))},actionButtonRendered:(n,r,s,a,o)=>{i&&e.assistantActionButtonRender(n,r,s,a,o,Se(t))},actionButtonShown:(n,r,s,a,o)=>{i&&e.assistantActionButtonImpression(n,r,s,a,o,Se(t))},plagiarismCitationsStyleChanged:i=>{e.assistantPlagiarismCitationsStyleChange(i,Se(t))},plagiarismCitationsStyleDropdownOpened:i=>{e.assistantPlagiarismCitationsStyleDropdownOpen(i,Se(t))},selectionContextHovered:()=>{e.assistantSelectionContextHover(Se(t))},selectionContextClicked:()=>{e.assistantSelectionContextClick(Se(t))},selectionContextRemoveButtonClicked:()=>{e.assistantSelectionContextRemoveButtonClick(Se(t))},partialPageModeNotificationDismissed:a.Q1,playbookClicked:i=>{e.assistantPlaybookClick(i,Se(t))}}}(u,p,this._params.experimentClient.isGateEnabled(le.K.CheetahProfuseEventsTracking)),{getGenAIDeps:y,getRevisionDeps:w,getGenAIAndWritingExpertDeps:A}=Mt({openParams:e,genAISession:_,lifecycleService:b,capiService:this._assistantServices.capiService,uphookService:this._params.uphookService,feedbackService:this._assistantServices.feedbackService,experimentService:this._assistantServices.experimentService,textEditorService:this._assistantServices.textEditorService,userService:this._assistantServices.userService,notifyAssistantUIAction:this._assistantServices.notifyAssistantUIAction,getSDUIBuffer:this._params.getSDUIBuffer,inboundCAPIEvents:this._inboundCAPIEvents,alertProcessor:this._params.alertProcessor,initialAlertId:He(e),highlightsUpdater:this._highlightsUpdater,highlightsScroller:this._highlightsScroller,replacementServiceInjector:this._params.replacementServiceInjector,getFormattingService:this._params.getFormattingService,requestAwaitService:this._params.requestAwaitService,alertStateService:this._params.alertStateService,supportedForms:this._params.supportedForms,isSharedAssistantEnabled:!0,selectionContextAvailabilityService:this._assistantServices.selectionContextAvailabilityService,toneDetectorService:this._assistantServices.toneDetectorService,settingsService:this._params.settingsService,genAIAvailabilityService:this._assistantServices.genAIAvailabilityService,url:this._params.url,disableKnowledgeEngine:"disabled"===this._params.dapiSettings.get().serengetiState,getQuickReplyContext:()=>this._params.integration.quickReplyContext.get(),experimentClient:this._params.experimentClient,dynamicConfig:this._params.dynamicConfig,skillService:this._params.skillService,isPlagiarismEnabled:h,isWritingExpertEnabled:d,trackingService:S,textObserver:this._params.textObserver,hwrService:this._hwrService,isTranslationAvailable:this._isTranslationAvailable.get(),capiStartAckMessage:this._params.capiStartAckMessage,deepLinkService:this._params.deepLinkService}),I=(0,g.S)((0,a.zG)(e,(e=>{switch(e.assistantMode){case"genAI":return{dispose:a.Q1,...y(e.genAIParams)};case"revision":{const t=w();if("alwaysOnAssistantSource"!==e.source.kind)return t;const i=ie(t,e.source.textFieldId);return{...t,dispose:()=>{var e;i.dispose(),null===(e=t.dispose)||void 0===e||e.call(t)}}}case"genAIAndRevision":return(0,a.zG)(w(),(t=>({...y(e.genAIParams),...t,kind:"genAIAndRevision",capiService:this._assistantServices.capiService})));case"genAIAndWritingExpert":return{dispose:a.Q1,...A(e.genAIParams)}}}),(e=>({...e,theme:v.h.create({useIframeTextfieldWrapper:this._params.experimentClient.isGateEnabled(le.K.OggyIframeWrappers)}),dispose:()=>{var t;null===(t=e.dispose)||void 0===t||t.call(e),b.dispose(),this._assistantFocused.set(!1)}}))));return this._assistantUIState.set(D.G({genAISession:_,dragBehavior:(0,he.D)(n)})),o.createElement(I,null)},n=await this._params.integration.renderAssistant(i,e.assistantMode,e.source);this._assistantUI.set(o.createElement($t,null,n))}catch(e){this._log.error("failed to open assistant",e),this._assistantUIState.set(D.YP),this._assistantUI.set(null)}}_getInlineButtonUI(){return(0,a.zG)(n.Yt(G.P)({inlineButtonInfo:this._params.integration.inlineButtonPlacement,selectionRange:this._selectionRange,selectionOngoing:A.T(this._params.integration.selectionRange.pipe(E.U((e=>(0,a.zG)(e,D.pC)))),this._params.integration.selectionRange.pipe(F.b(100),H.h(!1))),assistantOpened:this.assistantState.view(di),textMapIsEmpty:this._params.integration.textMapIsEmpty,quickReplyContext:this._params.integration.quickReplyContext,availability:this._assistantServices.genAIAvailabilityService.availability,entryPointsEnabled:this._inlineEntryPointsEnabled,featureFlags:this._params.featureFlags,codaInlineToolbarHidden:this._codaInlineToolbarHidden})).pipe(E.U((({inlineButtonInfo:e,selectionRange:t,selectionOngoing:i,assistantOpened:n,textMapIsEmpty:r,quickReplyContext:s,availability:l,entryPointsEnabled:c,featureFlags:d})=>(0,a.zG)(e,D.hX((()=>c)),D.hX((()=>!n)),D.hX((()=>h._.isUsable(l))),D.g_(a.gn,(e=>(0,a.zG)(t,D.g_(a.gn,(t=>{if(r&&D.pC(s)&&d.inlineQuickReply)return o.createElement(ei,{disabled:!1,referenceElement:e.referenceElement,placement:e.placement,offset:D.WG(e.offset),onClick:()=>{this._inlineButtonRecentlyPressed.set(!0),this._openAssistantSubject.next(St("quickReply",{kind:"inlineQuickReplySource"}))}});if(fi(t)&&(d.inlineRewrite||d.magicRewrite)&&this._params.integration.enableInlineRewrites){const t=d.inlineTranslate&&this._isTranslationAvailable.get(),n=d.magicRewrite&&!t;return this._codaInlineToolbarHidden.get()&&o.createElement(Jt,{disabled:i,referenceElement:e.referenceElement,placement:e.placement,offset:D.WG(e.offset),onOpenRewriteClick:d.inlineRewrite?()=>{this._inlineButtonRecentlyPressed.set(!0),this._openAssistantSubject.next(St("rewrite",{kind:"inlineRewriteSource"}))}:void 0,onMagicRewriteClick:n?()=>{this._inlineButtonRecentlyPressed.set(!0),this._openAssistantSubject.next(St("quickRewrite",{kind:"inlineQuickRewriteSource"}))}:void 0,onOpenTranslateClick:t?()=>{this._inlineButtonRecentlyPressed.set(!0),this._openAssistantSubject.next(St("translate",{kind:"inlineTranslateSource"}))}:void 0})}return null})))))))))}_getOnboardingUI(){const e=this._params.featureFlags.get().externalOnboardingContextProviderFix?qt:$t;return this._onboardingViewModels.view(D.g_(a.gn,(t=>o.createElement(e,null,z.UI.mount(p.T,(0,f.A)(t))))))}_getHighlightUI(){return v.h.combine(this._highlights,this.assistantState.view(di),this._assistantFocused,((e,t,i)=>t&&i?e.map((({rect:e,visibility:t},i)=>o.createElement(Vt,{key:`cheetah-highlight-rect-${i}`,top:e.top,left:e.left,width:e.width,height:e.height,visibility:t}))):null))}_getQuasiCaretUI(){return v.h.combine(this._quasiCaretRect,this._params.experimentClient.isGateEnabled(le.K.UnfixFast570)?this.assistantState.view(di):this.assistantState.view(ui),((e,t)=>(0,a.zG)(e,D.hX((()=>t)),D.g_((()=>null),(e=>o.createElement(si,{left:e.left,top:e.top,height:e.height,overflow:this._params.integration.allowCustomCaretOverflow}))))))}_getButtionUI(e){return v.h.combine(this._params.featureFlags,this._inlineButtonUI,this._selectionRange,this._params.integration.quickReplyContext,this._assistantServices.genAIAvailabilityService.availability,this._ideationEntryPointsEnabled,this._isAlwaysAvailableAssistantEnabled,((t,i,n,r,s,o,l)=>(0,a.zG)(i,D.DT((e=>null===e)),D.hX((()=>o&&t.ideateButton)),D.hX((()=>h._.isUsable(s))),D.g_(a.gn,(()=>e(n,r,t,l))))))}_getIdeateButtonUI(){return this._getButtionUI(this._getIdeateButtonForSelectionRange.bind(this))}_getExpandedIdeateButtonUI(){return v.h.combine(this._params.featureFlags,this._selectionRange,this._params.integration.quickReplyContext,this._assistantServices.genAIAvailabilityService.availability,this._ideationEntryPointsEnabled,this._isAlwaysAvailableAssistantEnabled,((e,t,i,n,r,s)=>(0,a.zG)(n,D.DT((e=>h._.isVisible(e))),D.hX((()=>r&&e.ideateButton)),D.g_(a.gn,(()=>this._getIdeateButtonForSelectionRange(t,i,e,s))))))}_getIdeateButtonForSelectionRange(e,t,i,n){return(0,a.zG)(e,D.hX((e=>fi(e)&&i.rewrite)),D.g_((()=>pi(t)&&i.quickReply?"quickReply":i.compose?"ideation":null),(()=>"rewrite")),D.ij,D.g_(a.gn,(e=>o.createElement(li,{onMouseEnter:()=>this._ideateButtonRecentlyHovered.set(!0),onMouseLeave:()=>this._ideateButtonRecentlyHovered.set(!1),onClick:()=>{if(n){const e=(0,l.Z)();(0,L.d)(e,"",N._N,"cheetah_ideate_button")}else this._onClickIdeateButton(e)},mount:e=>this._ideateButtonRefChange.next(e),forceTooltipMessage:this._ideateButtonTooltipNotificationState.view(D.FS),addOnePasswordExtensionBypass:n}))))}_insertText(e){""!==e?this._params.integration.insertText(e,this._selectionRange.get()):this._log.warn("insert() - attempting to insert empty response, skipping insert.")}dispose(){var e,t;this._disposed.next(null),this._highlightsUpdater.dispose(),this._closeAssistant(de.jg.disposed),null===(e=D.FS((0,a.zG)(this._onboardingViewModels.get(),D.UI((e=>e.onboarding)))))||void 0===e||e.dispose(),this._assistantServices.dispose(),null===(t=this._assistantApplet.get())||void 0===t||t.dispose(),this._subs.unsubscribe(),(0,a.zG)(this._nativeCursorHider.get(),j.bw((e=>e.dispose()))),this._params.integration.dispose(),document.removeEventListener("click",this.onCodaToolbarClick)}}function pi(e){return(0,a.zG)(e,D.Gg((e=>Object.values(e).filter((e=>void 0!==e)).length>0)))}function fi(e){const t=e.end-e.start;return t>=10&&t<5e3}function mi(e){return(0,b.W9)(u.l.is(u.l.Kind.mount),(e=>e.step===d.T.StepName.initial))(e)}function vi(e){return(0,b.W9)(u.l.is(u.l.Kind.mount),(e=>e.step===d.T.StepName.initialBTS))(e)}},57923:(e,t,i)=>{i.d(t,{m:()=>s});var n=i(67177),r=i(66811);class s{constructor(e){this._experimentClient=e,this.gates=r.C,this.experiments=r.V}getTreatment(e){return n.Y3((async()=>(await this._experimentClient.fetchTreatments(),this._experimentClient.getTreatment(e))),(e=>String(e)))}isGateEnabled(e){return n.Y3((async()=>(await this._experimentClient.fetchTreatments(),this._experimentClient.isGateEnabled(e))),(e=>String(e)))}logTreatment(e,t){return n.Y3((async()=>{await this._experimentClient.logTreatment(e,t)}),(e=>String(e)))}peekTreatment(e){return n.Y3((async()=>(await this._experimentClient.fetchTreatments(),this._experimentClient.peekTreatment(e))),(e=>String(e)))}}},57042:(e,t,i)=>{var n;i.d(t,{M:()=>n}),function(e){e.overlay="overlay",e.inherit="inherit"}(n||(n={}))},9307:(e,t,i)=>{i.d(t,{B:()=>O});var n=i(86399),r=i(90023),s=i(13391),a=i(88012),o=i(74822),l=i(29479),c=i(2187),h=i(84308),d=i(59179),u=i(99887),g=i(84178),p=i(44045),f=i(64271),m=i(954),v=i(20161),b=i(84714),_=i(58303),S=i(2084),y=i(92379);var w=i(90189),A=i(38037),I=i(57495),x=i(43389),C=i(5388),k=i(90595),R=i(40594),E=i(57042),P=i(89921),T=i(40466);class O{constructor(e){var t;this._params=e,this._subs=new a.w.Keeper,this._activeSelectionRange=s.h.create(_.YP),this._activeSelectionBoundingClientRects=s.h.create(_.YP),this._gButtonRef=s.h.create(_.YP),this._textMapEmpty=s.h.create(!0),this._docContext=s.h.create(_.YP),this._canShowIdeateButtonPopups=s.h.create(!1),this._entryPointsEnabled=s.h.create(!1),this._disposed=new o.x,this._positionModel=(0,I.j)(this._params.textField,this._params.csState,this._params.fieldSettings,this._params.csActions),this._assistantHeight=s.h.create(0),this._replacementService=this._params.replacementServiceInjector.create(C.P.oggyGenAI),this._textFieldLayout=this._params.textFieldLayout,this._logger=null!==(t=this._params.logger)&&void 0!==t?t:R.Y.create("CheetahIntegrationBase"),this._enableKeyboardShortcut=(0,w.OB)().experimentClient.isGateEnabled(k.K.KeyboardShortcut),this.assistantInjectionMode=s.h.create(E.M.overlay),this.selectionRange=this._activeSelectionRange.view(),this.textMapIsEmpty=this._textMapEmpty.view(),this.allowCustomCaretOverflow=this._params.allowCustomCaretOverflow,this.enableInlineRewrites=this._params.featureFlags.inlineRewrites,this.canShowIdeateButtonPopups=this._canShowIdeateButtonPopups.view(),this.entryPointsEnabled=this._entryPointsEnabled.view(),this.textUpdated=this._params.textObserver.contentChanges.async.pipe(l.h(void 0)),this.appActionsConfig=this._params.csState.view((e=>_.ij(e.dynamicConfig.appActions))),this.gOSCustomizationConfig=this._params.csState.view((e=>_.ij(e.dynamicConfig.gOSCustomization))),this.assistantHeight=this._assistantHeight.view(),this.assistantPosition=this._positionModel.initialPositionOffset,this._subs.push(this._params.selectionOrCaretPosition.subscribe(c.wW(this._activeSelectionRange)),this._getActiveSelectionBoundingClientRects().subscribe(c.wW(this._activeSelectionBoundingClientRects)),this._getTextMapEmpty().subscribe(c.wW(this._textMapEmpty)),this._getGButtonReference().subscribe(c.wW(this._gButtonRef)),h.a([this._params.entryPointsEnabled,this._params.isActiveTextField]).pipe(d.U((([e,t])=>e&&t))).subscribe(c.wW(this._canShowIdeateButtonPopups)),this._params.entryPointsEnabled.subscribe(c.wW(this._entryPointsEnabled)),this._activeSelectionRange.subscribe((e=>this._logger.debug("Selection updated:",_.WG(e))))),(0,r.zG)(this._params.docContextUpdatedEvents,_.UI((e=>e.pipe(d.U((e=>e.docContextInfo))))),S.bw((e=>this._subs.push(e.subscribe((e=>this._docContext.modify((t=>_.pC(t)?(0,r.zG)(t,_.UI((t=>({...t,...e})))):_.G(e)))))))))}insertText(e,t){(0,r.zG)(t,_.g_((()=>{this._replacementService.insertAtCurrentSelection(e).catch((()=>{this._logger.debug("Could not insert text at current selection, will try to append at end of text"),this._replacementService.performReplacement({pos:x.SV.create(this._params.textObserver.getCurrentTextMap().getPlainText().length),value:e})}))}),(t=>this._replacementService.performReplacement({pos:t,value:e}))))}focusTextField(){this._params.focusTextField()}getText(e){return this._params.textObserver.getCurrentTextMap().getPlainText().slice(e.start,e.end)}scrollHighlightIntoView(e){this.getHighlightRects(e).pipe(d.U(n.YM),u.oA,g.q(1),p.R(this._disposed)).subscribe((e=>(0,P.sK)(e,this._textFieldLayout)))}get inlineButtonPlacement(){return this._activeSelectionBoundingClientRects.view((e=>this._textRangeClientRectsToVisibleVirtualElement(e))).view((e=>(0,r.zG)(e,_.UI((e=>({referenceElement:e,placement:"bottom-start",offset:_.G([0,5])}))))))}get quickReplyContext(){return this._docContext.view((e=>(0,r.zG)(e,_.hX((e=>{var t;return(0,r.zG)(null!==(t=e.parents)&&void 0!==t?t:[],n.YM,_.hX((({delta:e})=>Boolean(e&&e.ops.length>0))),_.tS((e=>{var t;return(0,r.zG)(null!==(t=e.authors)&&void 0!==t?t:[],n.YM)})),_.hX((e=>!e.currentSessionUser)),_.pC)})))))}get isPlagiarismEnabled(){return!1}get isWritingExpertEnabled(){return!1}get isAiStudioEnabled(){return s.h.create(_.G(!1))}renderAssistant(e,t,i){return"alwaysOnAssistantSource"===i.kind?Promise.resolve(function(e){const t=e({sizeBehavior:s.h.create({heightBehavior:{kind:"fitContainer"},widthBehavior:{kind:"fitContainer"}}),dragBehavior:new o.x,readyToDrag:()=>b.of(void 0)});return y.createElement("div",{style:{display:"none"},"data-testid":"always-on-assistant-invisible-ui"},t)}(e)):Promise.resolve((0,T.Hn)(e,this._params.gButtonLayout,this._positionModel,this._enableKeyboardShortcut,this._params.csState.view("page").view("keyboardShortcuts"),this._params.closeAssistant,this.focusTextField.bind(this)))}canResizeAssistant(e){return!0}getHighlightRects(e){return f.T(this._params.textObserver.contentChanges.async,this._textFieldLayout.rect.changes,(0,A.O)(this._params.textObserver,this._textFieldLayout)).pipe(m.O(null),d.U((()=>(0,P.FN)((()=>this._params.textObserver.getCurrentTextMap()),this._params.geometryProvider,this._params.geometryLayout,r.yR)(e))))}dispose(){this._subs.dispose(),this._disposed.next(void 0)}_getGButtonReference(){return h.a([this._params.gButtonLayout.positionBehavior,this._params.gButtonLayout.sizeBehavior]).pipe(d.U((([e])=>_.G({getBoundingClientRect:()=>new DOMRect(e.client.left,e.client.top-0,0,0)}))))}_getActiveSelectionBoundingClientRects(){return this._activeSelectionRange.pipe(v.w(_.g_((()=>b.of(_.YP)),(0,P.or)(this._params.textObserver,this._params.geometryProvider,this._params.geometryLayout,this._textFieldLayout))))}_getTextMapEmpty(){return this._params.textObserver.contentChanges.async.pipe(m.O(null),d.U((()=>this._params.textObserver.getCurrentTextMap().isEmpty())))}_textRangeClientRectsToVisibleVirtualElement(e){return(0,r.zG)(e,_.UI((0,P.d6)(this._params.textField)),_.hX((e=>(0,P.HZ)(e.getBoundingClientRect(),(0,r.zG)(this._textFieldLayout.rect.getCurrent(),(({client:e,size:t})=>({...e,...t})))))),_.UI((0,P.MF)(this._textFieldLayout)))}}},55599:(e,t,i)=>{if(i.d(t,{P:()=>U,l:()=>B}),3075==i.j)var n=i(90023);var r=i(20161),s=i(84178),a=i(59179),o=i(90572),l=i(44045);if(3075==i.j)var c=i(954);if(3075==i.j)var h=i(84714);if(3075==i.j)var d=i(81933);if(3075==i.j)var u=i(53976);var g=i(58303);if(3075==i.j)var p=i(43389);var f=i(49629),m=i(63310);if(3075==i.j)var v=i(93865);var b=i(7833);class _{constructor(e,t=[b.$x]){this._doc=e,this._styleEl=this._doc.createElement("STYLE"),this._styleEl.innerHTML=t.map((e=>`${e}{opacity:0 !important;}`)).join("\n"),this._doc.head.appendChild(this._styleEl)}dispose(){this._styleEl.remove()}}var S=i(53785);if(3075==i.j)var y=i(67325);var w=i(41806),A=i(90595),I=i(40594),x=i(57042),C=i(9307),k=i(92379),R=i(33885),E=i(66461),P=i(21887),T=i.n(P);const O=({position:e,beforeElement:t,children:i,enableKeyboardShortcut:n,keyboardShortcutsSetting:r,closeAssistant:s,focusTextField:a})=>{const o=(0,E.$)({enableKeyboardShortcut:n,keyboardShortcutsSetting:r,closeAssistant:s,focusTextField:a});return k.createElement("div",{"data-grammarly-part":"assistant-static-wrapper",className:T().staticAssistant,style:{display:"flex",flexDirection:"column",position:"fixed",top:e.top,bottom:e.bottom,left:e.left,right:e.right,width:e.width,height:e.height,zIndex:e.zIndex},ref:o},t?k.createElement(t,null):void 0,k.createElement("div",{style:{flexGrow:1,minHeight:0}},i({sizeBehavior:h.of({heightBehavior:{kind:"fitContainer"},widthBehavior:{kind:"fitContainer"}}),dragBehavior:h.of({kind:"notDraggable"}),readyToDrag:()=>Promise.resolve(void 0)})))};class U extends C.B{constructor(e){super({...e,docContextUpdatedEvents:g.YP,allowCustomCaretOverflow:!1,focusTextField:()=>e.textField.click(),logger:I.Y.create("CheetahIntegrationGDocsCanvas")}),this._sidebarPosition=e.sidebarPosition;const t=e.experimentClient.isGateEnabled(A.K.GDocsAllowToDetectAssistantInjectionMode);this.assistantInjectionMode=this._sidebarPosition.view((({sidebarType:e})=>t&&e===S.X.modern?x.M.inherit:x.M.overlay)),this._scroller=(0,w.z)(e.textObserver,e.textFieldLayout,e.userInputShutOff),this._isDocOwnedByCurrentUser=e.isDocOwnedByCurrentUser}_scrollToRenderedRect(e){const t=m.Pf.create(e),i=this._textFieldLayout.visibleRect.getApproximate().client.top-this._textFieldLayout.rect.getApproximate().client.top;this._scroller.scrollToRect(t,i)}_scrollToUnrenderedHighlight(e){this._scroller.scrollToRange(e.start).pipe(r.w((t=>f.S.hz30.pipe(s.q(9),r.w((()=>this.getHighlightRects(e))),a.U((e=>null==e?void 0:e[0])),o.h((e=>!!e)),s.q(1)))),l.R(this._disposed)).subscribe((e=>{this._scrollToRenderedRect(e)}))}isDocOwnedByCurrentUser(){return this._isDocOwnedByCurrentUser}scrollHighlightIntoView(e){this.getHighlightRects(e).pipe(a.U((e=>null==e?void 0:e[0])),s.q(1),l.R(this._disposed)).subscribe((t=>{t?this._scrollToRenderedRect(t):this._scrollToUnrenderedHighlight(e)}))}createNativeUIHider(){return new _(document)}renderAssistant(e,t,i){return"genAI"===t||"genAIAndWritingExpert"===t||"alwaysOnAssistantSource"===i.kind?super.renderAssistant(e,t,i):Promise.resolve(((e,t,i,n,r,s,o)=>k.createElement(R.F.Fragment,null,t.pipe(a.U((t=>k.createElement(O,{key:"assistant-container",position:t,beforeElement:o,enableKeyboardShortcut:i,keyboardShortcutsSetting:n,closeAssistant:r,focusTextField:s},e))))))(e,this._sidebarPosition,this._enableKeyboardShortcut,this._params.csState.view("page").view("keyboardShortcuts"),this._params.closeAssistant,this.focusTextField.bind(this)))}canResizeAssistant(e){return"genAI"===e||"genAIAndWritingExpert"===e}get isPlagiarismEnabled(){return!0}get isWritingExpertEnabled(){return!0}dispose(){this._scroller.dispose(),super.dispose()}}function B(e,t,i,s){return s.data.behavior.pipe(c.O(null),r.w((()=>(0,n.zG)(i.getCurrentSelection(!0),v.Ls,g.ij,g.hX((0,n.ff)(p.SV.isCollapsed)),g.g_((()=>function(e,t){return e.contentChanges.async.pipe(c.O(null),u.c(t.offsetPosition.pipe(a.U((0,n.ls)(g.ij,g.tS((t=>{const i=e.getCurrentTextMap();if(i.isEmpty())return g.G(0);const r=2,s=1;return(0,n.zG)(g.ij(i.getPageContainingOffsetPoint(t)),g.tS((e=>g.ij((0,n.zG)((0,y.WR)({top:t.top-s/2-e.getPageRect().top,left:t.left-r/2-e.getPageRect().left,width:r,height:s},e.getPageInnerSize(),e.getPageRect()),(t=>{var i,n;return null===(n=null===(i=e.getTextRangeInInnerRect)||void 0===i?void 0:i.call(e,t))||void 0===n?void 0:n.startOffset}))))))})))))))}(e,t).pipe(a.U(g.UI(p.SV.create)))),(e=>h.of(g.G(e))))))),d.skipBy(g.Eh(p.SV.eq)))}},89921:(e,t,i)=>{i.d(t,{FN:()=>x,HZ:()=>E,MF:()=>R,Ti:()=>P,d6:()=>k,or:()=>C,sK:()=>T});var n=i(86399),r=i(92135),s=i(90023),a=i(64271),o=i(954),l=i(59179);if(6168!=i.j)var c=i(44071);if(6168!=i.j)var h=i(90572);if(6168!=i.j)var d=i(81933);if(6168!=i.j)var u=i(29416);if(6168!=i.j)var g=i(20161);if(6168!=i.j)var p=i(26156);if(6168!=i.j)var f=i(2613);if(6168!=i.j)var m=i(84178);var v=i(58303);if(6168!=i.j)var b=i(43389);var _=i(79625),S=i(63310),y=i(68418),w=i(7960);if(6168!=i.j)var A=i(93865);var I=i(14128);function x(e,t,i,a){return o=>(0,s.zG)(v.ij(t.create(o,e(),!0)),v.tS((e=>v.ij(t.getClientRects(e,!0)))),v.tS(r.nI),v.UI(a),v.g_((()=>[]),n.UI((e=>S.UL.setPosition(i.getApproximateConversionContext().clientToRelative(e),e)))))}function C(e,t,i,r){return c=>a.T(r.scroll.changes,r.rect.changes).pipe(o.O(null),l.U((()=>(0,s.zG)(c,x((()=>e.getCurrentTextMap()),t,i,(0,s.ls)((e=>(0,_.es)(e).map(S.Pf.create)),n.nI)),n.Z$,v.UI((e=>()=>(0,w.Z)(e,r.rect.getCurrent().client,r.scroll.getCurrent())))))))}function k(e){return t=>({contextElement:e,getBoundingClientRect:()=>(0,s.zG)(t(),(e=>new DOMRect(e.left,e.top,e.width,e.height)))})}function R(e){return t=>({...t,getBoundingClientRect:()=>{const i=t.getBoundingClientRect(),n=(0,s.zG)(e.rect.getCurrent(),(({client:e,size:t})=>({...e,...t}))),r=n.top+n.height,a=Math.max(n.top,Math.min(i.top,r)),o=Math.min(r,Math.max(i.bottom,n.top));return new DOMRect(i.left,a,i.width,o-a)}})}function E(e,t){return!(e.top+e.height<t.top||e.top>t.top+t.height)}function P(e,t){return function(e,t,i,n){return a.T(e.pipe(u.b(200)),t.pipe(g.w((()=>p.S(i.pipe(f.e(200)),n).pipe(m.q(1))))))}(c.R(t,"keyup").pipe(h.h((e=>"Backspace"===e.key))),c.R(t.ownerDocument,"selectionchange"),c.R(t,"keyup"),c.R(t.ownerDocument,"mouseup")).pipe(o.O(null),l.U((()=>e.getCurrentSelection())),l.U((0,s.ls)(A.qq,v.ij)),d.skipBy(v.Eh(b.SV.eq)))}function T(e,t){const i=t.visibleRect.getApproximate();if(0===i.size.height)return 0;const n=t.rect.getApproximate(),r=t.scroll.getApproximate(),s=S.Pf.create({...n.client,...n.size}),a=S.Wm.create(e),o=(0,I.Wb)(S.UL.setPosition(y.Ir.fromOffsetPoint(a,s,r),e));let l=54-i.client.top;(l<=0||l>=i.size.height)&&(l=i.size.height/2);const c=o.top-l-i.client.top;return t.scroller.scrollBy({top:c}),c}},40466:(e,t,i)=>{i.d(t,{Hn:()=>O,dl:()=>E});var n=i(92379),r=i(28365),s=i(63349),a=i(44022),o=i(68148),l=i(18974),c=i(33885),h=i(90572),d=i(63532),u=i(954),g=i(24666),p=i(84178),f=i(44071),m=i(59179),v=i(84308),b=i(62552),_=i(66461),S=i(84705),y=i(10335),w=i(41166),A=i(18839),I=i(92759),x=i(2914),C=i(8536),k=i(79825),R=i(36650);const E=a.DY,P=({viewportRect:e,gButtonRect:t,postRepositioningOffset:i,enableKeyboardShortcut:r,keyboardShortcutsSetting:a,closeAssistant:c,focusTextField:h,children:d})=>{const{top:u,setTop:g,left:p,setLeft:f,width:m,height:v,positionerRef:b}=(0,w.G)(),{x:S,y:A,setDragState:I}=(0,y.f)(u,g,p,f),k=n.useCallback((e=>!(e.target instanceof Element&&e.target.closest("button"))),[]),{bottom:R,right:P}=function(e,t,i,n,r){const s=r.height-n,a=r.width-i;return{bottom:Math.max(0,Math.min(s,s-e)),right:Math.max(0,Math.min(a,a-t))}}(u,p,m,v,e),T=(0,_.$)({enableKeyboardShortcut:r,keyboardShortcutsSetting:a,closeAssistant:c,focusTextField:h});return n.createElement(x._,{hasDragHandle:!0,bounds:e,onChangeDragState:I,dragEventFilter:k},n.createElement(C.sX,{anchorOrigin:{horizontal:"right",vertical:"top"},elementOrigin:{horizontal:"right",vertical:"bottom"},anchorMargin:{top:4,bottom:4,left:0,right:0},repositioning:[{horizontal:"translate",vertical:"flip"}],anchorRect:t,viewportRect:e,stickToTarget:!1,viewportMargin:0,postRepositioningOffset:i,onChangePosition:e=>requestAnimationFrame((()=>b.current.next(e)))},n.createElement("div",{"data-grammarly-part":"assistant-draggable-wrapper",style:{position:"fixed",transform:`translate(${S}px, ${A}px)`,zIndex:E,bottom:R,right:P,boxShadow:o.q_.boxShadow,border:o.q_.border,borderRadius:s.ux.rem(l.ze)},ref:T},d)))},T=({dragHandle:e,onDragEnd:t,onIsDraggingChange:i,children:r})=>{const s=(0,A.IQ)(),a=(0,A.e8)(),o=n.useContext(A.Dg),l=n.useMemo((()=>o.state.pipe(h.h((e=>!e.dragging)),d.b((e=>t(e))),u.O(I.h.create()))),[t,o]),c=n.useMemo((()=>s.pipe(g.x(),d.b((e=>i(e))))),[i,s]),f=n.useMemo((()=>e.pipe(h.h((e=>null!==e)),p.q(1),d.b((e=>a(e))))),[a,e]);return(0,k.A)(l),(0,k.A)(c),(0,k.A)(f),n.createElement(n.Fragment,null,r)},O=(e,t,i,s,a,o,l)=>{const h=f.R(self,"resize").pipe(m.U((()=>(0,R.C7)())),u.O((0,R.C7)())),d=v.a([t.positionBehavior,t.sizeBehavior]).pipe(m.U((([e,t])=>{const i=t.heightAndWidth,n=t.heightAndWidth;return{top:e.client.top-n,left:e.client.left-i,width:i,height:n}}))),g=new b.X(!1),p=new b.X(null),_=e({sizeBehavior:h.pipe(m.U((e=>({heightBehavior:{kind:"fitContent",maxHeight:Math.min(e.height,r.Z3)},widthBehavior:{kind:"fitContent",minWidth:null,maxWidth:null}})))),dragBehavior:g.asObservable().pipe(m.U((e=>({kind:"draggable",isDragging:e})))),readyToDrag:({dragHandle:e})=>(p.next(e),Promise.resolve(void 0))});return n.createElement(c.F.Fragment,null,v.a([h,d]).pipe(m.U((([e,t])=>{const r=(0,S.W)(i);return n.createElement(P,{viewportRect:e,gButtonRect:t,postRepositioningOffset:{horizontal:r.initialPositionOffset.left,vertical:r.initialPositionOffset.top},enableKeyboardShortcut:s,keyboardShortcutsSetting:a,closeAssistant:o,focusTextField:l},n.createElement(T,{onDragEnd:e=>r.onDrag(e),onIsDraggingChange:e=>g.next(e),dragHandle:p.asObservable()},_))}))))}},72008:(e,t,i)=>{i.d(t,{t:()=>n});const n=e=>(e=>"Cheetah/_System/Push/SimplifyRewrite"===e)(e)||(e=>"Cheetah/_System/Push/ImproveParagraph"===e)(e)},66461:(e,t,i)=>{i.d(t,{$:()=>s});var n=i(92379),r=i(64910);function s({enableKeyboardShortcut:e,keyboardShortcutsSetting:t,closeAssistant:i,focusTextField:s}){const a=(0,n.useRef)(null);return(0,n.useEffect)((()=>{let n,o;return e&&a.current&&(n=new r.J({textField:a.current,kind:"closeAssistant",settings:t,handler:i}),o=new r.J({textField:a.current,kind:"openAssistant",settings:t,handler:s})),()=>{null==n||n.dispose(),null==o||o.dispose()}}),[]),a}},58041:(e,t,i)=>{i.d(t,{G:()=>l,m:()=>o});var n=i(92379),r=i(55916),s=i(69652),a=i(25640);const o=26,l=n.forwardRef((function({forceTooltipMessage:e,onClick:t,onMouseEnter:i,onMouseLeave:o,addOnePasswordExtensionBypass:l},c){return n.createElement(s.u,{message:"Rewrite with Grammarly",forcedMessage:e},n.createElement("button",{onClick:t,"data-grammarly-part":"cheetah-ideate-button","aria-label":"Rewrite with Grammarly",className:a.ideateButton,ref:c,onMouseEnter:i,onMouseLeave:o,style:l?{position:"relative"}:{}},n.createElement("div",{className:a.ideateButtonIcon}),l&&n.createElement(r.L,null)))}))},74211:(e,t,i)=>{i.d(t,{M:()=>o});var n=i(90023);if(6168!=i.j)var r=i(3038);const s=15;const a={beginning:{single:e=>({...e,left:e.left,width:e.width+s}),first:n.yR,middle:n.yR,last:e=>({...e,left:e.left,width:e.width+s})},middle:{single:e=>({...e,left:e.left-s,width:e.width+30}),first:e=>({...e,left:e.left-s,width:e.width+s}),middle:n.yR,last:e=>({...e,left:e.left,width:e.width+s})},ending:{single:e=>({...e,left:e.left-s,width:e.width+s}),first:e=>({...e,left:e.left-s,width:e.width+s}),middle:n.yR,last:n.yR}};function o({rect:e,rectIndex:t,rects:i,highlightDisplayFormat:n,superUnderlineStyle:s,superUnderlineShouldDrawEllipsisOutside:o}){if(n!==r.jk.superUnderline||!s||!o||i[t]!==e)return e;const l=function(e,t){return 1===t.length?"single":0===e?"first":e===t.length-1?"last":"middle"}(t,i);return(0,a[s][l])(e)}},2918:(e,t,i)=>{i.d(t,{m:()=>h});var n=i(11633),r=i(12518),s=i(94686);const a=n.dt({s:n.pk,e:n.pk,type:n.G0([n.Z_,n.S1])}),o=n.dt({highlights:n.IX(a)}),l=n.dt({super_underlines:s.Q}),c=n.dt({transformJSON:o,extraProperties:l});var h;!function(e){const t=new WeakMap;e.fromBaseAlert=function(e){var i,n;if(!(null===(i=e.extraProperties)||void 0===i?void 0:i.super_underlines))return r.t$(new TypeError('Alert does not have "super_underlines" extra property.'));const s=null!==(n=t.get(e))&&void 0!==n?n:c.decode(e);if(t.set(e,s),r.nM(s))return r.t$(new TypeError("The provided alert is not a valid SuperUnderlinesAlert."));const a=s.right;return 1!==a.transformJSON.highlights.filter((e=>"enclosing"===e.type)).length?r.t$(new Error("A super underlines alert must contain exactly one enclosing highlight range.")):r.F2(a)}}(h||(h={}))},94686:(e,t,i)=>{i.d(t,{J:()=>h,Q:()=>c});var n,r=i(11633),s=i(39104),a=i(12518);!function(e){e.isValid=function(e){return e.s>=0&&e.e>e.s},e.hasIntersections=function(e){if(e.length<2)return!1;const t=e.slice().sort(((e,t)=>e.s-t.s));for(let e=1;e<t.length;e++){const i=t[e],n=t[e-1];if(i.s<n.e)return!0}return!1}}(n||(n={}));const o=r.dt({s:r.pk,e:r.pk,style:r.G0([r.i0("beginning"),r.i0("middle"),r.i0("ending")]),shouldDrawEllipsisOutsideSpan:r.O7}),l=r.IX(o),c=new r.Dy("SuperUnderlineSpansFromJsonString",l.is,((e,t)=>{const i=h.fromJson(e);return a.tO(i)?r.Vp(i.right):r.Rn(e,t,i.left.message)}),JSON.stringify);var h;!function(e){e.fromJson=function(e){if("string"!=typeof e)return a.t$(new TypeError("The provided entity is not a string."));let t;try{t=JSON.parse(e)}catch(e){return a.t$(e)}const i=l.decode(t);if(a.nM(i))return a.t$(new TypeError("Parsed JSON is not a valid SuperUnderlineSpans."));const r=i.right;return 0===r.length?a.t$(new Error("SuperUnderlineSpans must contain at least one span.")):r.some((0,s.ff)(n.isValid))?a.t$(new Error("SuperUnderlineSpans contains invalid spans.")):n.hasIntersections(r)?a.t$(new Error("SuperUnderlineSpans contains overlapping spans.")):a.F2(r)},e.reconstructJson=function(e,t){if(!e||0===e.length)return a.t$(new Error("No spans provided for JSON reconstruction."));if(!t)return a.t$(new Error("Alert transform highlights are required for JSON reconstruction."));const i=t.filter((e=>"enclosing"===e.type));if(1!==i.length)return a.t$(new Error("A super underlines alert must contain exactly one enclosing highlight range."));const n=e.map((e=>({...e,s:e.s-i[0].s,e:e.e-i[0].s})));return a.F2(JSON.stringify(n))}}(h||(h={}))},81248:(e,t,i)=>{i.d(t,{u:()=>r,y:()=>n});var n,r,s=i(28338),a=i(48758),o=i(3038);function l({id:e,touchTypistId:t,kind:i,replacement:n,previewDelta:r,revertDelta:s,highlightRanges:o,highlightTexts:l,transformRange:c,transformText:h,title:d}){return{_tag:a.b.touchTypist,id:e,touchTypistId:t,kind:i,replacement:n,previewDelta:r,revertDelta:s,revision:"",highlightRanges:o,highlightTexts:l,transformRange:c,transformText:h,transforms:[],extraProperties:{},title:d}}!function(e){e.Preview="Preview",e.RecentRevert="RecentRevert",e.Revert="Revert"}(n||(n={})),function(e){function t(e,t){const i=e=>""===e.trim();return i(e)||i(t)?i(t)?`Removed â€œ${e}â€`:`Added â€œ${t}â€`:e}e.is=function(e){return e._tag===a.b.touchTypist},e.equals=function(e,t){return a.S.ordering.areSame(e,t)},e.createHighlightsMeta=function(e,t){return{highlightId:t,alertId:e.id,...function(e){switch(e){case n.Preview:return{highlightColor:o.hE.Preset.create(o.al.red),highlightDisplayFormat:o.jk.underlineAndPersistentBackground};case n.RecentRevert:return{highlightColor:o.hE.Preset.create(o.al.green),highlightDisplayFormat:o.jk.background};case n.Revert:return{highlightColor:o.hE.Preset.create(o.al.gray),highlightDisplayFormat:o.jk.dottedUnderlineAndBackground};default:(0,s.L0)(e)}}(e.kind),highlightDisappearOnHoverDelay:null,highlightLiveliness:null}},e.fromPreview=function(){return({id:e,touchTypistId:t,begin:i,end:r,original:s,highlight:a,replacement:o,delta:c,reverseDelta:h})=>{const d={start:a.s,end:a.e},u=a.text,g={start:i,end:r},p=s;return l({id:String(e),touchTypistId:t,kind:n.Preview,replacement:o,previewDelta:c,revertDelta:h,highlightRanges:[d],highlightTexts:[u],transformRange:g,transformText:p,title:""})}},e.fromRevert=function(){return({revertId:e,touchTypistId:i,highlightBegin:r,highlightEnd:s,highlightText:a,text:o,isRecent:c,correspondingPreview:h})=>{const d={start:r,end:s},u=d,g=a;return l({id:String(e),touchTypistId:i,kind:c?n.RecentRevert:n.Revert,replacement:o,previewDelta:h.delta,revertDelta:h.reverseDelta,highlightRanges:[d],highlightTexts:[a],transformRange:u,transformText:g,title:t(o,h.replacement)})}},e.createRevertTitle=t}(r||(r={}))},23650:(e,t,i)=>{var n;i.d(t,{i:()=>n}),function(e){e.textChange="textChange",e.reset="reset",e.alertAccepted="alertAccepted",e.alertUpdate="alertUpdate",e.capiRemove="capiRemove",e.ignore="ignore"}(n||(n={}))},30842:(e,t,i)=>{if(i.d(t,{Ms:()=>U,OK:()=>O,Z9:()=>T}),6168!=i.j)var n=i(64271);if(6168!=i.j)var r=i(67982);if(6168!=i.j)var s=i(84308);if(6168!=i.j)var a=i(44071);if(6168!=i.j)var o=i(84714);if(6168!=i.j)var l=i(90572);if(6168!=i.j)var c=i(59179);if(6168!=i.j)var h=i(32734);if(6168!=i.j)var d=i(79859);if(6168!=i.j)var u=i(24666);if(6168!=i.j)var g=i(20161);if(6168!=i.j)var p=i(63532);if(6168!=i.j)var f=i(84178);if(6168!=i.j)var m=i(10883);if(6168!=i.j)var v=i(954);if(6168!=i.j)var b=i(36344);if(6168!=i.j)var _=i(78129);if(6168!=i.j)var S=i(31603);if(6168!=i.j)var y=i(74211);if(6168!=i.j)var w=i(40594);if(6168!=i.j)var A=i(3038);if(6168!=i.j)var I=i(78767);if(6168!=i.j)var x=i(47557);if(6168!=i.j)var C=i(49629);if(6168!=i.j)var k=i(63310);if(6168!=i.j)var R=i(68418);var E,P,T;function O(e,t){return e.kind===P.extension&&e.id===t}!function(e){e.pointerEnter="pointerEnter",e.pointerLeave="pointerLeave",e.pointerClick="pointerClick"}(E||(E={})),function(e){e.extension="extension",e.external="external"}(P||(P={})),function(e){e.equals=function(e,t){return e&&t?e.alertId===t.alertId:e===t}}(T||(T={}));class U{constructor(e,t=w.Y.create("AlertStateServiceBase")){this._options=e,this._log=t,this._externalRawHighlightedAlert=this._options.externalDecorationInteractions.pipe((0,l.h)((e=>e.kind===E.pointerEnter||e.kind===E.pointerLeave)),(0,c.U)((e=>e.kind===E.pointerLeave?null:{alertId:e.alertId,activeHighlightId:{kind:P.external},highlightIds:[{kind:P.external}],activeHighlightRect:k.UL.setPosition(R.p8.fromClientPoint(R.Ir.create(e.interactedDecorationSegmentRect),this._options.textFieldLayout.rect.getApproximate().client,this._options.textFieldLayout.scroll.getApproximate()),e.interactedDecorationSegmentRect)})),(0,h.B)()),this._extensionRawHighlightedAlert=this._options.mousePosition.pipe((0,d.U)(C.S.hz30),(0,u.x)(I.fS),(0,c.U)((({client:e,offset:t})=>{if(e&&t&&(0,x._N)(e,this._options.textField,this._options.bypassHoveredElement)){const e=this._options.highlightGeometry.geometry.get();return Array.from(e.keys()).reduce(((i,n)=>{const r=e.get(n);if(r){const e=r.rects&&(null===r.meta.highlightDisplayFormat||A.jk.isInteractable(r.meta.highlightDisplayFormat))&&r.rects.find(((e,i)=>{if(!r.meta.highlightDisplayFormat)return k.UL.contains(t,e);const n=(0,y.M)({...r.meta,rect:e,rectIndex:i,rects:r.rects});return k.UL.contains(t,n)})),n=this._options.getAlertById(r.meta.alertId),s=i&&this._options.getAlertById(i.alertId);if((!s||n&&this._options.priorityOrdering.greaterThanOrEqual(n,s))&&e)return{alertId:r.meta.alertId,activeHighlightId:{kind:P.extension,id:r.meta.highlightId},activeHighlightRect:e,highlightIds:[]}}return i}),null)}return null})),(0,u.x)(((e,t)=>T.equals(e,t))),(0,c.U)((e=>{if(!e)return null;const t=this._options.highlightGeometry.geometry.get(),i=[];return t.forEach(((t,n)=>{t.meta.alertId===e.alertId&&i.push({kind:P.extension,id:n})})),{...e,highlightIds:i}})),(0,h.B)()),this._rawHighlightedAlert=(0,n.T)(this._extensionRawHighlightedAlert,this._externalRawHighlightedAlert).pipe((0,h.B)()),this._switchByDisplayedCard=()=>(0,r.z)((0,g.w)((e=>(0,s.a)([this._options.capiCardController.cardHovered,this._options.autocorrectCardController.cardHovered,this._options.autoApplyCardController.cardHovered,this._options.weTeaserCardController.cardHovered,this._options.weTeaserCardController.shouldShowFullWeCard,this._options.touchTypistPreviewCardController.cardHovered,this._options.touchTypistRevertCardController.cardHovered]).pipe(c.U((([t,i,n,r,s,a,o])=>t||i||n||r||s||a||o?this._options.getCurrentCardAlertState():e))))),(0,u.x)(T.equals)),this._offByUpdatedGeometry=e=>e.activeHighlightId.kind===P.external?b.E:this._options.highlightGeometry.geometry.pipe((0,c.U)((t=>e&&e.activeHighlightId.kind===P.extension&&t.has(e.activeHighlightId.id)?e:null)),(0,l.h)((e=>null===e)),(0,c.U)((()=>null)),(0,p.b)((e=>this._log.trace("OffByUpdatedGeometry",e)))),this._offByTextChange=()=>this._options.textObserver.contentChanges.async.pipe((0,l.h)((e=>0!==e.changes.length)),(0,c.U)((()=>null)),(0,p.b)((e=>this._log.trace("OffByTextChange",e)))),this._offByTextPositionChange=()=>(0,n.T)(this._options.textFieldLayout.rect.changes.pipe((0,p.b)((()=>this._log.trace("Text field position, size has been changed")))),this._options.textFieldLayout.scroll.changes.pipe((0,p.b)((()=>this._log.trace("Text field scroll has been changed")))),(0,a.R)(self,"scroll").pipe((0,p.b)((()=>this._log.trace("Window scroll detected"))))).pipe((0,f.q)(1),(0,c.U)((()=>null))),this.getActiveAlertByClick=()=>{var e;return(0,a.R)((null===(e=this._options.textField.ownerDocument)||void 0===e?void 0:e.defaultView)||this._options.textField,"click").pipe((0,m.M)(this._rawHighlightedAlert.pipe(this._switchByDisplayedCard())),(0,c.U)((([e,t])=>t)),(0,g.w)((e=>e?(0,n.T)(this._offByUpdatedGeometry(e),this._offByTextChange(),this._offByTextPositionChange()).pipe((0,p.b)((()=>this._log.trace("Active state was overridden by text or geometry change"))),(0,f.q)(1),(0,v.O)(e)):(0,o.of)(null))),(0,u.x)(T.equals))},this.newlyHighlightedAlerts=this._options.highlightGeometry.geometry.pipe(v.O([]),_.G(),c.U((([e,t])=>{const i=new Set(Array.from(e.values()).map((e=>e.meta.alertId)));return Array.from(t.values()).filter((e=>!i.has(e.meta.alertId))).map((e=>this._options.getAlertById(e.meta.alertId))).filter(I.fQ)})),S.J())}getActiveAlert(){throw new Error("Not implemented")}getHighlightedAlert(){throw new Error("Not implemented")}}},38037:(e,t,i)=>{i.d(t,{M:()=>B,O:()=>M});var n=i(64271),r=i(93440),s=i(59179),a=i(10883),o=i(20161),l=i(14969),c=i(44045),h=i(29479),d=i(90572),u=i(12518),g=i(2373),p=i(72008),f=i(33442);var m=i(2918),v=i(81248),b=i(23650),_=i(48758),S=i(67385),y=i(26155),w=i(3038),A=i(39963),I=i(38364),x=i(20905),C=i(40594),k=i(25714);var R=i(1407);function E(e){return e.isPremium&&e.isHidden}var P=i(84714),T=i(5588);var O=i(78767);function U(e){return(0,n.T)((t=e.textRevisionManager.revisionChanges,t.pipe((0,T.D)((e=>1===Math.abs(e.deltaChanges.length)?(0,r.H)(1e3).pipe((0,s.U)((()=>e))):(0,P.of)(e))))),M(e.textObserver,e.layout)).subscribe((t=>{!function(e,t,i,n,r){if(e){const e=(0,O.DV)((()=>t.processPendingTextRevisions()),(e=>(r.warn("alertProcessor: processing text revision failed",e),null)));try{const s=e&&e.transformedAlerts.map((e=>t.alerts.getAlertById(e.id))).filter((e=>null!==e))||[];try{const e=s.flatMap((e=>i.get(e.id)||[]));n.maintainConsistency(e,void 0,void 0,((e,t)=>s.some((e=>e.id===t.alertId))))}catch(e){r.error("error maintaining highlight consistency",e)}}catch(e){r.error("failed on update/maintain",e)}}try{n.recalculateAllHighlights()}catch(e){r.error("error recalculating highlights",e)}}(t,e.alertProcessor,e.alertIdToHighlightIds,e.highlights,e.log)}));var t}class B{constructor(e,t,i,r,a,o,l,c=C.Y.create("AquaAlertsWiring"),h,d,u,g){this._alertProcessor=e,this._highlights=t,this._alertFilter=i,this._textObserver=r,this._textRevisionManager=a,this._layout=o,this._felog=l,this._log=c,this._isAssistantOpened=h,this._showInlineLockedUIUnderlines=d,this._showColoredLockedUIUnderlines=u,this._isLockedUIExperimentTreatmentGroup=g,this._subs=[],this._alertIdToHighlightIds=new Map,this._alertIdToSyntheticHighlightIds=new Map,this._alertsToProcessOnFilterChange=this._alertFilter.pipe((0,s.U)((e=>{const t=[],i=[];for(const e of this._alertProcessor.alerts.getAll()){const n=this._alertIdToHighlightIds.get(e.id);n&&n.some((e=>this._highlights.hasHighlight(e)))?i.push(e):t.push(e)}return{addedAlerts:t,updatedAlerts:i,removedAlerts:[],transformedAlerts:[]}}))),this._subs.push(U({alertIdToHighlightIds:this._alertIdToHighlightIds,layout:this._layout,log:this._log,textRevisionManager:this._textRevisionManager,textObserver:this._textObserver,highlights:this._highlights,alertProcessor:this._alertProcessor})),this._subs.push(this._updateHighlightsOnAlertChange()),this._subs.push(function(e,t,i,r){let s=e.getTextSource().getPlainText().length;return(0,n.T)(i.revisionChanges,M(e,t)).subscribe((e=>{if(e){const t=e.deltaChanges.length;if(1===Math.abs(t)){const i=Math.min(...e.changes.map((e=>e.pos)));let n=0;n=s+t-1;const a={start:i,end:n};r.updateHighlightsForTextRange(a,t)}s+=t}}))}(this._textObserver,this._layout,this._textRevisionManager,this._highlights))}static getHighlightColor(e,t,i,n,r){const{ethical_ai_highlight_background_color:s,ethical_ai_highlight_underline_color:a,critical_mistake:o,reactivation_yellow_underlines:l}=e.extraProperties,c=R.p.shouldShowInlineYellowUnderlinesForInProductReactivation(l),h=B._shouldReplaceColorWithYellow(e,t,r,n,i,c);return c&&(0,A.Tb)().sendFemetricsRate("inProductReactivation.shown",{yellowOnClient:h}),o?B._getSimplifiedHighlightColor(e,h):B._getExtendedHighlightColor(e,h,s,a)}static _getSimplifiedHighlightColor(e,t){const{critical_mistake:i}=e.extraProperties;return t?w.hE.Preset.create(w.al.gold):"true"===i?w.hE.Preset.create(w.al.red):e.outcome===S.TC.vox?B._outcomeToHighlightColor[S.TC.vox]:w.hE.Preset.create(w.al.blue)}static _getExtendedHighlightColor(e,t,i,n){return i&&n?w.hE.Custom.create(i,n):t?w.hE.Preset.create(w.al.gold):(0,f.JD)(e.patternName)?w.hE.Preset.create(w.al.gray):(0,p.t)(e.patternName)?w.hE.Preset.create(w.al.green):(e=>e.startsWith("Plagiarism/Plagiarism/UnoriginalContent"))(e.patternName)?w.hE.Preset.create(w.al.plagiarism):e.extraProperties.underline_with_teaser?w.hE.Preset.create(w.al.weHbar):e.impact===g.wQ.Impact.Critical?w.hE.Preset.create(w.al.red):B._outcomeToHighlightColor[e.outcome]}static getHighlightDisplayFormat(e){return e.belongsToKnowledgeHubTermDetails?w.jk.background:e.belongsToKnowledgeHubSuggestedTerm?w.jk.underline:e.isEnclosing?w.jk.enclosing:e.isEnclosed?e.belongsToSuperUnderlineAlert?e.isMain?w.jk.underlineOnHoverOnly:e.isMainStart?w.jk.underlineStartOnHoverOnly:w.jk.underlineAndBackgroundOnHoverOnly:e.isMain?w.jk.underline:e.isMainStart?w.jk.underlineStart:w.jk.underlineAndBackground:e.belongsToActiveAlert&&e.belongsToSuperAlert?e.isActive?w.jk.underlineAndBackground:w.jk.background:w.jk.underlineAndBackground}static _extractHighlightInfo(e,t){const i="enclosing"===t.type,n=e.highlightRanges.some((e=>"enclosing"===e.type));return{isEnclosing:i,isEnclosed:n,isMain:"main"===t.type,isMainStart:"main_start"===t.type,belongsToKnowledgeHubTermDetails:(0,f.Ed)(e),belongsToKnowledgeHubSuggestedTerm:(0,f.kK)(e),belongsToSuperUnderlineAlert:u.tO(m.m.fromBaseAlert(e))}}static getHighlightMeta(e,t,i,n,r,s,a){if(_.S.isTouchTypistAlert(e))return v.u.createHighlightsMeta(e,t);const{hColor:o,dFormat:l}=this._getHighlightColorAndFormat(e,i,n,r,s,a);return{highlightId:t,alertId:e.id,highlightColor:o,highlightDisplayFormat:l,highlightDisappearOnHoverDelay:null,highlightLiveliness:null}}static _getHighlightColorAndFormat(e,t,i,n,r,s){let a=_.S.isCapiAlert(e)?B.getHighlightColor({...e,isPremium:!e.isFree,isHidden:e.isHidden},i,n,r,s):null,o=_.S.isCapiAlert(e)?B.getHighlightDisplayFormat(B._extractHighlightInfo(e,t)):null;return e._tag===_.b.snippetsTemplate&&(a=w.hE.Preset.create(w.al.green),o=w.jk.background),{hColor:a,dFormat:o}}_addHighlightsForSuperUnderlinesAlert(e,t){const i=m.m.fromBaseAlert(e);if(!u.tO(i))return;const n=i.right,r=n.transformJSON.highlights.find((e=>"enclosing"===e.type));r?n.extraProperties.super_underlines.forEach((i=>{const n=y.y$.Id.create(e.id,(0,I.M8)()),s=this._alertIdToSyntheticHighlightIds.get(e.id)||[];this._alertIdToSyntheticHighlightIds.set(e.id,[...s,n]);const a={start:r.s+i.s,end:r.s+i.e},o=_.S.isCapiAlert(e)?B.getHighlightColor({...e,isPremium:!e.isFree,isHidden:e.isHidden},this._isAssistantOpened.get(),this._showInlineLockedUIUnderlines.get(),this._showColoredLockedUIUnderlines.get(),this._isLockedUIExperimentTreatmentGroup.get()):null,l={highlightId:n,alertId:e.id,highlightColor:o,highlightDisplayFormat:w.jk.superUnderline,highlightDisappearOnHoverDelay:null,highlightLiveliness:w.iY.inert,superUnderlineStyle:i.style,superUnderlineShouldDrawEllipsisOutside:i.shouldDrawEllipsisOutsideSpan};this._highlights.addHighlight(n,y.NC.expandIfNeeded(a,t),l)})):this._log.error("A Super Underlines alert must contain an enclosing highlight range.")}_addHighlightsFor(e,t){this._addHighlightsForSuperUnderlinesAlert(e,t),e.highlightRanges.forEach(((i,n)=>{const r=y.y$.Id.create(e.id,n),s=this._alertIdToHighlightIds.get(e.id)||[];this._alertIdToHighlightIds.set(e.id,[...s,r]),this._highlights.addHighlight(r,y.NC.expandIfNeeded(i,t),B.getHighlightMeta(e,r,i,this._isAssistantOpened.get(),this._showInlineLockedUIUnderlines.get(),this._showColoredLockedUIUnderlines.get(),this._isLockedUIExperimentTreatmentGroup.get()))}))}_updateHighlightsFor(e,t){const i=this._alertIdToHighlightIds.get(e.id);if(i&&i.length!==e.highlightRanges.length)this._clearHighlightsFor(e.id),this._addHighlightsFor(e,t);else{const n=[];e.highlightRanges.forEach(((r,s)=>{let a;const o=null==i?void 0:i[s];o?a=o:(a=y.y$.Id.create(e.id,s),n.push(a)),this._highlights.updateHighlight(a,y.NC.expandIfNeeded(r,t),B.getHighlightMeta(e,a,r,this._isAssistantOpened.get(),this._showInlineLockedUIUnderlines.get(),this._showColoredLockedUIUnderlines.get(),this._isLockedUIExperimentTreatmentGroup.get()))}));const r=this._alertIdToHighlightIds.get(e.id)||[];this._alertIdToHighlightIds.set(e.id,[...r,...n]);const s=this._alertIdToSyntheticHighlightIds.get(e.id);s&&(this._highlights.removeHighlights(s),this._alertIdToSyntheticHighlightIds.delete(e.id)),this._addHighlightsForSuperUnderlinesAlert(e,t)}}_updateHighlightsOnAlertChange(){return(0,n.T)(this._alertProcessor.alerts.changes.pipe(k.d5.measure(this._felog.processAlerts.measure)),this._alertsToProcessOnFilterChange.pipe(k.d5.measure(this._felog.processFilterChange.measure))).pipe((0,a.M)(this._alertFilter),(0,s.U)((([{addedAlerts:e,removedAlerts:t,transformedAlerts:i,updatedAlerts:n},r])=>({addedAlerts:e.filter(r),updatedAlerts:n.filter(r),transformedAlerts:i.filter((e=>{const t=this._alertProcessor.alerts.getAlertById(e.id);return!!t&&r(t)})),removedAlerts:[...t.filter((e=>r(e.alert))),...n.filter((e=>!r(e))).map((e=>({id:e.id,alert:e,reason:{_tag:b.i.alertUpdate}})))]}))),d.h((e=>e.addedAlerts.length>0||e.updatedAlerts.length>0||e.transformedAlerts.length>0||e.removedAlerts.length>0))).subscribe((e=>{try{for(const t of e.removedAlerts)this._clearHighlightsFor(t.id)}catch(e){this._log.error("failed to remove highlights",e)}if(e.addedAlerts.length>0||e.updatedAlerts.length>0||e.transformedAlerts.length>0){const t=this._textObserver.getTextSource().getPlainText();for(const i of e.addedAlerts)try{this._addHighlightsFor(i,t)}catch(e){this._log.warn(`failed to add highlight for #${i.id}`,e)}for(const i of e.updatedAlerts)try{this._updateHighlightsFor(i,t)}catch(e){this._log.error(`failed to update highlight for #${i.id}`,e)}for(const i of e.transformedAlerts)try{const e=this._alertProcessor.alerts.getAlertById(i.id);e&&this._updateHighlightsFor(e,t)}catch(e){this._log.error(`failed to update highlight geometry for #${i.id}`,e)}}}))}_clearHighlightsFor(e){const t=this._alertIdToHighlightIds.get(e);t&&(this._highlights.removeHighlights(t),this._alertIdToHighlightIds.set(e,[]));const i=this._alertIdToSyntheticHighlightIds.get(e);i&&(this._highlights.removeHighlights(i),this._alertIdToSyntheticHighlightIds.set(e,[]))}static _shouldReplaceColorWithYellow(e,t,i,n,r,s){if(function(e){const{free_premium:t}=e.extraProperties;return e.inline===g.wQ.Inline.inline&&E(e)&&"uphook"===t}(e))return!0;if(t){const t=!i||!n;return E(e)&&t||s}return!(!function(e){const{free_premium:t}=e.extraProperties;return e.inline===g.wQ.Inline.inline&&E(e)&&"locked"===t}(e)||!r||n)||!!s}getHighlightsForAlert(e){return this._alertIdToHighlightIds.get(e)||[]}dispose(){this._subs.forEach((e=>e.unsubscribe()))}}function M(e,t){return e.contentChanges.async.pipe((0,o.w)((()=>t.scroll.changes.pipe((0,l.P)(),(0,c.R)((0,r.H)(x.E0)),(0,h.h)(null)))))}B._outcomeToHighlightColor={[S.TC.correctness]:w.hE.Preset.create(w.al.red),[S.TC.clarity]:w.hE.Preset.create(w.al.blue),[S.TC.engagement]:w.hE.Preset.create(w.al.green),[S.TC.tone]:w.hE.Preset.create(w.al.purple),[S.TC.vox]:w.hE.Preset.create(w.al.gray),[S.TC.knowledgeHub]:w.hE.Preset.create(w.al.lightGreen),[S.TC.other]:w.hE.Preset.create(w.al.gold)}},39214:(e,t,i)=>{i.d(t,{B:()=>c,g:()=>l});var n=i(14527),r=i(95869),s=i(7245),a=i(78767),o=i(79707);function l(e,t=!1){return e.reduce((({actions:e,index:i},s)=>{const o=e[0];return r.s.isInsertString(s)?(e.unshift({pos:{start:i,end:i},value:t&&s.attributes?(new n.i).insert(s.insert,s.attributes):s.insert}),{actions:e,index:i}):r.s.isInsertEmbed(s)?{actions:e,index:i+1}:r.s.isRetain(s)?(t&&s.attributes&&e.unshift({pos:{start:i,end:i+s.retain},value:(new n.i).retain(s.retain,s.attributes)}),{actions:e,index:i+s.retain}):r.s.isDelete(s)?(o&&o.pos.start===o.pos.end&&o.pos.end===i?o.pos={...o.pos,end:o.pos.end+s.delete}:e.unshift({pos:{start:i,end:i+s.delete},value:""}),{actions:e,index:i+s.delete}):void(0,a.vE)(s)}),{actions:[],index:0}).actions.reduce(((e,t)=>(e.length&&e[e.length-1].value&&e[e.length-1].pos.start===t.pos.start&&(0,o.HD)(t.value)&&(0,o.HD)(e[e.length-1].value)?e[e.length-1].value=`${String(t.value)}${String(e[e.length-1].value)}`:e.push(t),e)),[])}const c=e=>e.reduce((({formattings:e,index:t},i)=>s.m.hasFormatting(i)?r.s.isInsertString(i)?(e.push({range:{start:t,end:"\n"===i.insert?t:t+i.insert.length},formatting:i.attributes}),{formattings:e,index:t+i.insert.length}):r.s.isInsertEmbed(i)?{formattings:e,index:t+1}:r.s.isRetain(i)?(e.push({range:{start:t,end:t+i.retain},formatting:i.attributes}),{formattings:e,index:t+i.retain}):{formattings:e,index:t}:r.s.isInsertString(i)?{formattings:e,index:t+i.insert.length}:r.s.isInsertEmbed(i)?{formattings:e,index:t+1}:r.s.isRetain(i)?{formattings:e,index:t+i.retain}:r.s.isDelete(i)?{formattings:e,index:t}:void(0,a.vE)(i)),{formattings:[],index:0}).formattings},57495:(e,t,i)=>{i.d(t,{j:()=>a});var n=i(13391),r=i(68418),s=i(38456);const a=(e,t,i,n)=>{const a=t.view("page","domain").get(),o=(0,s.U)(e,a),l=i.view((({widgetOffset:e})=>null!=e?e:r.E9.zero));return{initialPositionOffset:l,updateInitialPositionOffset:e=>{r.E9.equals(e,l.get())||n.field.patchFieldSettings({fieldId:o,fieldSettings:{widgetOffset:e}})}}};n.h.create({top:0,left:0})},84705:(e,t,i)=>{i.d(t,{W:()=>r});var n=i(68418);const r=e=>{const t=e.initialPositionOffset.get();return{initialPositionOffset:t,onDrag:i=>{e.updateInitialPositionOffset(n.E9.plus(t,n.E9.fromCartesian(i.translate)))}}}},10335:(e,t,i)=>{i.d(t,{f:()=>s});var n=i(92379),r=i(92759);const s=(e,t,i,s)=>{const[a,o]=n.useState(r.h.create()),[l,c]=n.useState(null),[h,d]=n.useState(null),u=null!=h?h:a.translate;return n.useEffect((()=>{!a.dragging&&a.dragEnd&&(t(e+u.y),s(i+u.x),c(a.translate),d({x:0,y:0}))}),[a]),n.useEffect((()=>{a.dragging&&h&&l&&d({x:a.translate.x-l.x,y:a.translate.y-l.y})}),[a]),{dragState:a,setDragState:o,x:u.x,y:u.y}}},41166:(e,t,i)=>{i.d(t,{G:()=>o});var n=i(92379),r=i(62552),s=i(78129),a=i(8536);const o=()=>{const[e,t]=n.useState(a.KC.top),[i,o]=n.useState(a.KC.left),[l,c]=n.useState(a.KC.height),[h,d]=n.useState(a.KC.width),u=n.useRef(new r.X(a.KC));return n.useEffect((()=>{const n=u.current.pipe(s.G()).subscribe((([n,r])=>{const s=((e,t,i)=>{if(e===a.KC.left||t.left!==i.left)return i.left})(i,n,r),l=((e,t,i)=>e===a.KC.top?i.top:t.height!==i.height?Math.max(e-(i.height-t.height),0):void 0)(e,n,r);void 0!==l&&t(l),void 0!==s&&o(s),d(r.width),c(r.height)}));return()=>n.unsubscribe()}),[e,i]),{top:e,setTop:t,left:i,setLeft:o,height:l,width:h,positionerRef:u}}},49629:(e,t,i)=>{i.d(t,{S:()=>n});var n,r=i(84766),s=i(32734),a=i(20905);!function(e){const t=e=>(0,r.F)(e).pipe((0,s.B)());e.sec5=t(a.m9(5)),e.sec2=t(a.m9(2)),e.sec1=t(a.m9(1)),e.hz4=t(a.Xd(4)),e.hz10=t(a.Xd(10)),e.hz30=t(a.Xd(30));const i=new Map;e.create=function(e){const n=i.get(e);if(n)return n;{const n=t(e);return i.set(e,n),n}}}(n||(n={}))},46108:(e,t,i)=>{i.d(t,{V:()=>n});i(42087);const n=/(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|\u303d|\u3030|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|[\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|[\ud83c[\ude32-\ude3a]|[\ud83c[\ude50-\ude51]|\u203c|\u2049|[\u25aa-\u25ab]|\u25b6|\u25c0|[\u25fb-\u25fe]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]|\ud83c\udccf|\u2934|\u2935|[\u2190-\u21ff])/g},7245:(e,t,i)=>{i.d(t,{m:()=>n});var n,r=i(95869);!function(e){e.isInlineFormatting=function(e){return"bold"in e||"italic"in e||"underline"in e||"link"in e},e.isListFormatting=function(e){return"list"in e},e.isHeaderFormatting=function(e){return"header"in e},e.hasFormatting=function(t){return!r.s.isDelete(t)&&void 0!==t.attributes&&(e.isInlineFormatting(t.attributes)||e.isListFormatting(t.attributes)||e.isHeaderFormatting(t.attributes))}}(n||(n={}))},31394:(e,t,i)=>{i.d(t,{V:()=>n});var n,r=i(58041);!function(e){e.gbuttonInnerSize=22,e.gButtonPadding=2,e.gButtonGroupPadding=2,e.gButtonTopLeftMargin=1,e.gButtonMinimizedSize=12,e.getGButtonComponentSize=(t=e.gButtonMaxSize)=>e.gbuttonInnerSize*t/e.gButtonMaxSize,e.getEmogenieSize=e.getGButtonComponentSize,e.getTotalWidth=(t,i,n)=>{const s=[];i&&!n&&s.push(e.getEmogenieSize()+-1),n&&s.push(r.m);const a=s.reduce(((e,t)=>e+t),0);return(e.gButtonMaxSize+a)*t/e.gButtonMaxSize},e.gButtonMaxSize=e.gbuttonInnerSize+2*e.gButtonPadding+2*e.gButtonGroupPadding;e.getGButtonSize=(t,i)=>Math.max(Math.min(t,i,e.gButtonMaxSize),24)}(n||(n={}))},15100:(e,t,i)=>{var n;i.d(t,{P:()=>n}),function(e){e.OFFLINE="offline",e.POPUP_VISIBLE="popup_visible",e.POPUP_VISIBLE_ALLOW_HOVER="popup_visible_allow_hover",e.DATA_CONTROL_ACTIVE="data_control_active",e.USER_EDC_BLOCKED="user_edc_blocked",e.ASSISTANT_VISIBLE="assistant_visible",e.USER_CLAIMED="user_claimed",e.SIGNED_OUT_GB="signed_out_gb",e.STAND_WITH_UKRAINE="stand_with_ukraine",e.POPUP_VISIBLE_SDUI="popup_visible_sdui",e.INACTIVE_INTEGRATION="inactive_integration"}(n||(n={}))},26155:(e,t,i)=>{i.d(t,{NC:()=>a,WF:()=>u,pc:()=>c,qH:()=>s,y$:()=>o});var n=i(90023);if(6168!=i.j)var r=i(24666);var s,a,o,l,c,h=i(13391),d=i(78767);function u(e){return e.rect.map((e=>e.size)).behavior.pipe((0,r.x)(((e,t)=>e.height===t.height&&e.width===t.width)))}!function(e){let t;!function(e){e.invalidate="invalidate",e.preserve="preserve"}(t=e.ChangeType||(e.ChangeType={}))}(s||(s={})),function(e){e.everything=h.h.create({filter:e=>!0,type:e.ChangeType.preserve})}(s||(s={})),function(e){function t(e,t){const i=e.end-e.start==1,n="a"===t.slice(e.start,e.end);return i&&!n}e.is=function(e){const t=e;return(0,d.Nf)(t.increasedLeft)&&"number"==typeof t.increasedLeft&&(0,d.Nf)(t.increasedRight)&&"number"==typeof t.increasedRight},e.expandIfNeeded=function(e,i){if(t(e,i)){const t=e.start>0?1:0,n=e.end!==i.length?1:0;return{start:e.start-t,end:e.end+n,increasedLeft:t,increasedRight:n}}return{...e}},e.shouldExpand=t}(a||(a={})),function(e){let t;!function(e){let t=0;e.create=function(e,i){return t++,`${e}-${t}${void 0!==i?`|${i}`:""}`},e.createFromMark=function(e){return`${e}`}}(t=e.Id||(e.Id={}))}(o||(o={})),function(e){e.Mock=class{constructor(){this.addHighlight=n.W8,this.updateHighlight=n.W8,this.removeHighlights=n.Q1,this.removeAllHighlights=n.Q1,this.recalculateHighlight=n.Q1,this.recalculateAllHighlights=n.Q1,this.maintainConsistency=n.Q1,this.hasHighlight=n.W8,this.updateHighlightsForTextRange=n.Q1,this.dispose=n.Q1,this.geometry=h.h.create(new Map)}intersectingHighlightIDs(e){return[]}}}(l||(l={})),function(e){e.none="none",e.hovered="hovered",e.hoveredNeedsAttention="hovered_needs_attention"}(c||(c={}))},79625:(e,t,i)=>{function n(e,t=1.5,i=1.5){if(e.length<=0)return[];if(1===e.length)return e;{const n=[];let r=e[0];for(let s=1;s<e.length;s++){const a=e[s],o=a.top+a.height,l=o<r.top,c=o===r.top&&a.height>0&&r.height>0;if(l||c)continue;const h=Math.min(r.left,a.left),d=Math.min(r.top,a.top),u=Math.max(r.left+r.width,a.left+a.width)-h,g=Math.max(r.top+r.height,o)-d,p=u<=r.width+a.width+t,f=g<=r.height+a.height-i,m=g===r.height+a.height&&(0===a.height||0===r.height);a.width===r.width&&a.height===r.height&&a.left===r.left&&a.top===r.top||(p&&(f||m)?r={top:d,left:h,height:g,width:u}:(n.push(r),r=a))}return n.push(r),n}}function r(e,t=0,i=.5){if(e.length<=0)return[];{const n=[e[0]];for(let r=1;r<e.length;++r){const s=n[r-1],a=e[r],o=Math.min(s.top,a.top),l=Math.max(s.top+s.height,a.top+a.height)-o<s.height+a.height,c=a.top-(s.top+s.height),h=.5*(a.height+s.height);if(l||Math.abs(c)>i*h)n.push(a);else{const e=s.top+s.height+t*c;n[r-1]={top:s.top,left:s.left,width:s.width,height:e-s.top},n.push({top:e,left:a.left,width:a.width,height:a.top+a.height-e})}}return n}}function s(e){return e.reduce(((e,t)=>{if(null==e)return t;return{left:Math.min(e.left,t.left),top:Math.min(e.top,t.top),width:Math.max(e.width,t.left+t.width-e.left),height:Math.max(e.height,t.top+t.height-e.top)}}),null)}i.d(t,{es:()=>n,jr:()=>s,yX:()=>r})},1407:(e,t,i)=>{var n;i.d(t,{p:()=>n}),function(e){e.shouldShowInlineYellowUnderlinesForInProductReactivation=e=>"true"===e}(n||(n={}))},68418:(e,t,i)=>{i.d(t,{Cv:()=>a,E9:()=>n,Ir:()=>s,p8:()=>r});var n,r,s,a,o=i(83473);!function(e){e.equals=function(e,t){return(0,o.M$)(e.left,t.left)&&(0,o.M$)(e.top,t.top)},e.fromCartesian=function({x:e,y:t}){return{top:t,left:e}},e.toCartesian=function({top:e,left:t}){return{x:t,y:e}},e.zero={top:0,left:0},e.minus=function(e,t){return{top:e.top-t.top,left:e.left-t.left}},e.plus=function(e,t){return{top:e.top+t.top,left:e.left+t.left}},e.ceil=function(e){return{left:Math.ceil(e.left),top:Math.ceil(e.top)}},e.floor=function(e){return{left:Math.floor(e.left),top:Math.floor(e.top)}},e.create=function(e){return{top:e.top,left:e.left}},e.l1Distance=function(e,t){return Math.abs(e.top-t.top)+Math.abs(e.left-t.left)}}(n||(n={})),function(e){function t(e){return{top:e.top,left:e.left}}e.create=t,e.fromClientPoint=function(e,i,n){return t({top:e.top-i.top+n.top,left:e.left-i.left+n.left})},e.zero={top:0,left:0}}(r||(r={})),function(e){function t(e){return{top:e.top,left:e.left}}e.create=t,e.fromOffsetPoint=function(e,i,n){return t({top:e.top+i.top-n.top,left:e.left+i.left-n.left})},e.fromPage=function(e,i){return t({top:e.top-i.top,left:e.left-i.left})}}(s||(s={})),function(e){function t(e){return{top:e.top,left:e.left}}e.create=t,e.getHighlightsPosition=function(e,i,n,r={top:0,left:0}){return t({top:e.top+i.top+n.top+r.top,left:e.left+i.left+n.left+r.left})},e.fromClient=function(e,i){return t({top:e.top+i.top,left:e.left+i.left})},e.fromOffset=function(e,t,i){return{top:e.top+t.top-i.top,left:e.left+t.left-i.left}}}(a||(a={}))},63310:(e,t,i)=>{i.d(t,{$u:()=>n,D1:()=>o,Pf:()=>a,UL:()=>r,Wm:()=>s});var n,r,s,a,o,l=i(83473),c=i(68418);!function(e){e.create=function(e){return{width:e.width,height:e.height}}}(n||(n={})),function(e){function t(e,t){const i=e.left<=t.left?e:t,n=i===e?t:e,r=e.top<=t.top?e:t,s=r===e?t:e;return i.left+i.width>=n.left&&r.top+r.height>=s.top}e.union=function(e){return t=>t.slice(1).reduce(((t,i)=>{const n=Math.min(i.top,t.top),r=Math.min(i.left,t.left),s=Math.max(t.left+t.width,i.left+i.width)-r,a=Math.max(t.top+t.height,i.top+i.height)-n;return e({top:n,left:r,width:s,height:a})}),t[0])},e.getIntersection=function(e,i){if(!t(e,i))return null;const n=e.left+e.width,r=e.top+e.height,s=i.left+i.width,a=i.top+i.height,o=Math.max(e.left,i.left),l=Math.max(e.top,i.top);return{left:o,top:l,width:Math.min(n,s)-o,height:Math.min(r,a)-l}},e.contains=function(e,t){return e.left>=t.left&&e.left<=t.left+t.width&&e.top>=t.top&&e.top<=t.top+t.height},e.doesRectContain=function(e,t){return t.left>=e.left&&t.left+t.width<=e.left+e.width&&t.top>=e.top&&t.top+t.height<=e.top+e.height},e.intersects=t,e.intersectsStrict=function(e,t){const i=e.left<=t.left?e:t,n=i===e?t:e,r=e.top<=t.top?e:t,s=r===e?t:e;return i.left+i.width>n.left&&r.top+r.height>s.top},e.setPosition=function(e,t){const i=n.create(t);return Object.assign({},e,n.create(t),{right:e.left+i.width,bottom:e.top+i.height})},e.area=function(e){return e.width*e.height},e.isEmpty=function(e){return 0===e.width&&0===e.height},e.shift=function(e,t){const i=c.E9.plus(e,t);return{...e,...i}},e.widen=function(e,t){return{...e,left:e.left-t,width:e.width+2*t}},e.equals=function(e,t,i){return(0,l.M$)(e.left,t.left,i)&&(0,l.M$)(e.top,t.top,i)&&(0,l.M$)(e.width,t.width,i)&&(0,l.M$)(e.height,t.height,i)},e.verticalOverlap=function(e,t){const i=e.top<=t.top?e:t,n=i===e?t:e,r=i.top+i.height-n.top;return r<0?0:r>n.height?1:r/Math.min(n.height,i.height)},e.midlineHorizontal=function(e){return{...e,top:e.top+e.height/2,height:0}},e.midlineVertical=function(e){return{...e,left:e.left+e.width/2,width:0}}}(r||(r={})),function(e){e.create=function(e){return{...e,kind:"offsetPoint"}},e.topLeftPoint=function({top:e,left:t}){return{kind:"offsetPoint",top:e,left:t}}}(s||(s={})),function(e){e.create=function(e){return{kind:"clientPoint",top:e.top,left:e.left,bottom:(null==e?void 0:e.bottom)||e.top+e.height,right:(null==e?void 0:e.right)||e.left+e.width,width:e.width,height:e.height}},e.empty={top:0,left:0,bottom:0,right:0,width:0,height:0,kind:"clientPoint"}}(a||(a={})),function(e){e.create=function(e){return e}}(o||(o={}))},81743:(e,t,i)=>{i.d(t,{N:()=>n});var n,r=i(8867),s=i(62552),a=i(36344),o=i(9642),l=i(93790),c=i(24666),h=i(8794),d=i(59179),u=i(78767);class g{constructor(e,t,i){this._getImmediateValue=e,this._source=t,this._compare=i,this._subject=null,this.behavior=new r.y((e=>{const t=this._source.subscribe(e);return{unsubscribe:()=>{t.unsubscribe(),this._subject=null}}})).pipe((0,o.O)((()=>(this._subject=new s.X(this._getImmediateValue()),this._subject))),(0,l.x)(),(0,c.x)(this._compare)),this.changes=this.behavior.pipe((0,h.T)(1)),this.getCurrent=this._getImmediateValue}getApproximate(){return this._subject?this._subject.getValue():this._getImmediateValue()}map(e,t=u.fS){return new g((()=>e(this._getImmediateValue())),this.changes.pipe((0,d.U)(e)),t)}}!function(e){function t(e,t,i){return new g(e,t.pipe((0,d.U)(e)),i)}e.create=t,e.createOptimized=function(e,t,i){return new g(e,t.pipe((0,d.U)((t=>void 0!==t?t:e()))),i)},e.constant=function(e){return t((()=>e),(0,a.c)(),(()=>!0))}}(n||(n={}))},18647:(e,t,i)=>{if(i.d(t,{Bi:()=>y,E6:()=>g,Jj:()=>l,Me:()=>o,Qf:()=>S,XQ:()=>h,Yd:()=>d,a9:()=>f,bp:()=>u,f0:()=>_,is:()=>p,kW:()=>v,o:()=>c,wr:()=>m}),6168!=i.j)var n=i(36769);const r=new Set(["absolute","relative","fixed","sticky"]),s=new Set(["strict","content","layout","paint"]),a=new Set(["flex","inline-flex"]);function o(e){const t=e.ownerDocument;if(t)return t;throw new Error("target does not have ownerDocument")}function l(e){const t=o(e).defaultView;if(t)return t;throw new Error("active document is detached from a window")}function c(e){return l(e).getComputedStyle(e)}function h(e){return r.has(c(e).position)}function d(e,t){const i=r.has(t.position);return!i&&null!==t.zIndex&&"auto"!==t.zIndex&&e.parentElement?a.has(c(e.parentElement).display):i}function u(e){const t=o(e).body;if(e===t)throw new Error("target is body");let i=e;do{if(i=i.parentElement,i&&h(i))return i}while(null!==i&&i!==t);return i||t}function g(e,t){var i,r,s,a;const l=o(e).body;if(e===l)throw new Error("target is body");const c=(0,n.Cq)(l.parentElement);let h=e;do{if(h=null!==(a=null!==(r=null!==(i=h.assignedSlot)&&void 0!==i?i:h.parentElement)&&void 0!==r?r:null===(s=h.getRootNode())||void 0===s?void 0:s.host)&&void 0!==a?a:null,h&&t(h))return h}while(null!==h&&h!==c);return h||c}function p(e){return g(e,(e=>{return h(e)||(t=e,s.has(c(t).contain));var t}))}function f(e){return function(e){const t=c(e);return"auto"===t.overflow||"scroll"===t.overflow||"auto"===t.overflowY||"scroll"===t.overflowY}(e)||function(e){const t=c(e);return"auto"===t.overflow||"scroll"===t.overflow||"auto"===t.overflowX||"scroll"===t.overflowX}(e)}function m(e,t){for(let i=e;null!=i;i=i.parentElement)if(t(i))return i;return null}function v(e,t){const i=e.ownerDocument,n=i&&i.defaultView;if(!i||!n)return;const r=i.body.scrollLeft,s=i.body.scrollTop,a=n.scrollY,o=n.scrollX;t&&!i.hasFocus()?e.dispatchEvent(new FocusEvent("focus")):e.focus(),a===n.scrollY&&o===n.scrollX||n.scroll(o,a),s!==i.body.scrollTop&&(i.body.scrollTop=s),r!==i.body.scrollLeft&&(i.body.scrollLeft=r)}const b=e=>e?1/e:1,_=(e,t)=>{if(!e)return;const i=S(self.getComputedStyle(e));if(!i)return;const n=b(Number(i.x)),r=b(Number(i.y));return{transform:`translate(${t.left*(n-1)}px, ${t.top*(r-1)}px) scale(${n}, ${r})`,transformOrigin:e.style.transformOrigin}};function S(e){if(e.transform&&"none"!==e.transform){const t=/scale\(([\d.]+)(?:, ([\d.]))*\)|matrix\(([\d.]+), [\d.]+, [\d.]+, ([\d.]+), [\d.]+, [\d.]+\)/.exec(e.transform);if(t){const[e,i,n,r,s]=t;return{x:i||r,y:n||s||i}}}}function y(e){try{const t=new DOMMatrixReadOnly(e.transform);return{x:t.e,y:t.f}}catch(e){return}}},7960:(e,t,i)=>{i.d(t,{Z:()=>s});var n=i(68418),r=i(63310);function s(e,t,i){return r.UL.setPosition(n.Ir.fromOffsetPoint(e,t,i),e)}},82048:(e,t,i)=>{if(i.d(t,{By:()=>C,FJ:()=>v,RV:()=>w,Ti:()=>f,We:()=>b,Yq:()=>x,_i:()=>_,bk:()=>I,dk:()=>A,kP:()=>S,nX:()=>p,tQ:()=>m,x$:()=>y}),6168!=i.j)var n=i(44071);if(6168!=i.j)var r=i(64271);if(6168!=i.j)var s=i(59179);if(6168!=i.j)var a=i(24666);if(6168!=i.j)var o=i(31394);if(6168!=i.j)var l=i(68418);if(6168!=i.j)var c=i(45523);if(6168!=i.j)var h=i(78767);if(6168!=i.j)var d=i(47557);var u=i(49629);if(6168!=i.j)var g=i(81743);function p(e){return[(0,n.R)(e,"scroll"),(0,n.R)(e,"mousewheel"),(0,n.R)(e,"touchmove")]}function f(e){return(0,r.T)(...p(e),c.x.create(e,{attributes:!1,childList:!0,subtree:!0,characterData:!0}),(0,n.R)(e,"keydown"),(0,n.R)(e,"keyup"))}function m(e){return{left:parseFloat(e.paddingLeft)||0,top:parseFloat(e.paddingTop)||0,right:parseFloat(e.paddingRight)||0,bottom:parseFloat(e.paddingBottom)||0}}const v=u.S.hz4,b=u.S.sec2,_=u.S.hz30;function S(e,t){const i=e.height-t.bottom-t.top,n=e.width-t.left-t.right;return o.V.getGButtonSize(n,i)}function y(e,t=0,i=e.container,n={top:0,left:0}){return{zIndex:e.zIndex.map((e=>e+1),h.fS),position:e.textFieldRect.behavior.pipe(s.U((e=>{const i=Math.max(e.padding.right,t),r=Math.max(e.padding.bottom,t);return{...l.Cv.create({top:e.position.top+e.height-r+n.top,left:e.position.left+e.width-i+n.left}),effectivePadding:{right:i,bottom:r,left:e.padding.left,top:e.padding.top},textFieldHeight:e.height,textFieldWidth:e.width}})),a.x(h.fS)),container:i}}function w(e){return g.N.create((()=>((0,d.YN)(e)||0)+1),b,h.fS)}function A(e,t){return I(e,t,(e=>e))}function I(e,t,i){const n=[];let r=0,s=e;for(;s.parentElement&&r!==t;)n.push(i(s.parentElement)),s=s.parentElement,r++;return n}function x(e,t){let i=0,n=e;for(;i<t&&n.parentElement;)n=n.parentElement,i++;return i<t?null:n}function C(e,t){return(0,r.T)(...A(e,t).map((e=>(0,n.R)(e,"scroll"))))}},53680:(e,t,i)=>{var n,r;i.d(t,{V:()=>n,j:()=>r}),function(e){e.success="success",e.fail="fail",e.applied="applied"}(n||(n={})),function(e){e.success=function(e){return{result:n.success,context:e}},e.fail=function(e,t){return{result:n.fail,reason:e,context:t}},e.applied=function(e){return{result:n.applied,context:e}},e.isFail=function(e){return e.result===n.fail},e.isSuccess=function(e){return e.result===n.success},e.isApplied=function(e){return e.result===n.applied},e.fromResult=function(t,i){return n=>n?e.applied(i):e.fail(t,i)}}(r||(r={}))},5388:(e,t,i)=>{var n,r,s,a;i.d(t,{G6:()=>a,Ly:()=>s,P:()=>n,gO:()=>r}),function(e){e.assistant="assistant",e.autoapply="autoapply",e.autocorrect="autocorrect",e.iframe="iframe",e.inlineCard="inlineCard",e.inlineCardValidation="inlineCardValidation",e.proofit="proofit",e.sidebar="sidebar",e.snippets="snippets",e.synonyms="synonyms",e.gOsSkillApplet="gOsSkillApplet",e.vbar="vbar",e.hbar="hbar",e.oggyGenAI="oggyGenAI",e.oggyRevision="oggyRevision",e.oggyRevisionDelayed="oggyRevisionDelayed",e.oggyRevisionSequential="oggyRevisionSequential",e.gOSAssistantApplet="gOSAssistantApplet",e.g2="g2",e.connector="connector",e.touchTypist="touchTypist",e.inkwell="inkwell",e.alwaysOnAssistant="alwaysOnAssistant"}(n||(n={})),function(e){e.validation="validation",e.execution="execution",e.afterApply="afterApply"}(r||(r={})),function(e){e.performReplacement="performReplacement",e.canPerformReplacement="canPerformReplacement",e.performBatchReplacements="performBatchReplacements",e.insertAtCurrentSelection="insertAtCurrentSelection"}(s||(s={})),function(e){e.single="single",e.batch="batch"}(a||(a={}))},93865:(e,t,i)=>{function n(e){return e.length>0?e[0]:null}function r(e){return 1===e.length?e[0]:null}function s(e){return 1===e.length?e[0]:e.length>0?e.reduce(((e,t)=>t.start===t.end?e:e.start===e.end?t:{start:Math.min(e.start,t.start),end:Math.max(e.end,t.end)})):null}i.d(t,{Ey:()=>n,Ls:()=>s,qq:()=>r})},25009:(e,t,i)=>{if(i.d(t,{Fb:()=>p,PF:()=>g,TY:()=>c,_V:()=>u,eg:()=>d,um:()=>l,yj:()=>h}),3075==i.j)var n=i(59179);if(3075==i.j)var r=i(24666);if(3075==i.j)var s=i(28338);if(3075==i.j)var a=i(49629);if(3075==i.j)var o=i(3944);var l,c,h;function d(e){if((0,o.uz)(e))return{mode:l.view};const t=(0,o.lW)(e);return t||((0,o.e$)(e)?{mode:l.noEditAccess}:{mode:l.edit})}!function(e){e.view="view",e.noEditAccess="noEditAccess",e.history="history",e.edit="edit"}(l||(l={})),function(e){e[e.ownDoc=0]="ownDoc",e[e.sharedDoc=1]="sharedDoc",e[e.noEditAccessDoc=2]="noEditAccessDoc"}(c||(c={})),function(e){e.read="read",e.write="write"}(h||(h={}));function u(e){return a.S.hz4.pipe((0,n.U)((()=>d(e))),(0,r.x)(((e,t)=>{return n=t,(i=e).mode===l.history&&n.mode===i.mode?i.subtype===n.subtype:i.mode===n.mode;var i,n})))}function g(e,t){return e?c.ownDoc:t?c.noEditAccessDoc:c.sharedDoc}function p(e,t,i,n){if(e.mode!==l.edit)return h.read;switch(t){case c.ownDoc:return h.write;case c.noEditAccessDoc:return h.read;case c.sharedDoc:return function(e,t,i){const n=!t&&!i;if(e.mode!==l.edit||n)return h.read;return h.write}(e,i,n);default:return(0,s.L0)(t)}}},3944:(e,t,i)=>{if(i.d(t,{LJ:()=>_,Nd:()=>h,Ov:()=>b,TW:()=>x,Ur:()=>d,Xs:()=>C,e$:()=>A,eg:()=>I,fN:()=>p,k6:()=>m,kh:()=>g,lW:()=>w,lz:()=>f,qg:()=>c,uj:()=>l,uz:()=>v}),3075==i.j)var n=i(90189);if(3075==i.j)var r=i(90595);if(3075==i.j)var s=i(36769);if(3075==i.j)var a=i(25009);if(6168!=i.j)var o=i(7833);function l(e){const t=(0,s.Cq)(e.querySelector(o.XG),"text buffer iframe");return(0,s.Cq)(t.nodeType===Node.ELEMENT_NODE&&"IFRAME"===t.tagName?t.contentDocument:void 0,"text buffer iframe document")}function c(e){const t=h(e);return{width:t?t.offsetWidth-t.clientWidth:0,height:t?t.offsetHeight-t.clientHeight:0}}function h(e){return e.querySelector(o.Wp)}function d(e,t,i){return t?function(e,t){if(t&&u(t))return t;const i=e.querySelectorAll(o.Qy);for(const e of i)if(u(e))return e;return null}(e,i):e.querySelector(o.Qy)}const u=e=>e.checkVisibility?e.checkVisibility():e.parentElement&&"none"!==e.parentElement.style.display;function g(e){return e.querySelectorAll(o.gH)}function p(e){return e.querySelector(o.gH)}function f(e){return Boolean(e.querySelector(o.gH))}function m(e){let t=e.querySelector(o.os);return t||(t=document.querySelector(o.gH)),t?t.getBoundingClientRect():null}const v=e=>!!e.querySelector(o.Lq);function b(e){return e.querySelector(o.$x)}function _(e){return null==e?void 0:e.querySelector(o.y1)}var S;!function(e){e.legacy="legacy",e.modern="modern"}(S||(S={}));const y=e=>"versionHistorySidebarWizSelector"===e.id||e.getBoundingClientRect().top>0?S.modern:S.legacy;function w(e){let t=e.querySelector(o.f);const i=(0,n.OB)().experimentClient.isGateEnabled(r.K.GDocsVersionHistorySidebarSelector);!t&&i&&(t=e.querySelector(o.q6));return!!t&&t.offsetHeight>0&&t.offsetWidth>0&&t?{mode:a.um.history,subtype:y(t)}:null}function A(e){return!!e.querySelector(`${o.jW}, ${o.F8}`)}function I(){const e=document.querySelector(o.d0),t=(null==e?void 0:e.classList.contains(o.uj))?"edit":void 0,i=(null==e?void 0:e.classList.contains(o._m))?"suggesting":void 0;return t||i||"other"}function x(e){return e.querySelector(o.QR)}function C(e){return e.querySelector(o.ij)}},7833:(e,t,i)=>{i.d(t,{$:()=>D,$x:()=>a,Cw:()=>N,F8:()=>b,Fh:()=>z,G$:()=>j,Go:()=>r,Jk:()=>L,Kt:()=>I,Lq:()=>u,Q:()=>B,Q6:()=>l,QO:()=>T,QR:()=>P,Qy:()=>S,Vk:()=>x,Vo:()=>F,Wp:()=>n,XG:()=>s,_m:()=>f,d0:()=>g,f:()=>h,fD:()=>H,gH:()=>_,gL:()=>C,gv:()=>c,ij:()=>E,j5:()=>A,jW:()=>v,l$:()=>m,lO:()=>R,os:()=>w,q6:()=>d,qz:()=>O,rx:()=>k,tN:()=>M,uj:()=>p,wY:()=>G,y1:()=>o,yv:()=>U,yw:()=>y});const n=".kix-appview-editor",r=".docos-input",s=".docs-texteventtarget-iframe",a=".kix-cursor",o=".kix-cursor-caret",l="#docs-butterbar-container",c="docs-butterbar-container-compact",h="#docs-revisions-sidebar",d="#docs-wiz-sidebar-placeholder",u='#docs-toolbar-mode-switcher[aria-label="Viewing mode"]',g="#docs-toolbar-mode-switcher",p="edit-mode",f="suggest-mode",m="titlebar-mode-indicator-container",v="#titlebar-mode-indicator-container .titlebar-request-access-button",b="#titlebar-mode-indicator-container .kix-titlebar-request-access-button",_="canvas.kix-canvas-tile-content:not(.docs-ui-unprintable *)",S=".kix-rotatingtilemanager:not(.docs-ui-unprintable *)",y=".kix-page-paginated",w=".kix-page-paginated.canvas-first-page",A=".docs-horizontal-ruler",I=".docs-vertical-ruler",x="#fontSizeSelect input",C=".docs-ruler-background",k=".docs-ruler-background-inner",R=".docs-ruler-indent-first-line",E=".modal-dialog.docs-dialog .fatal-error-message",P='#docs-titlebar-share-client-button div[role="button"]',T=".kix-ai-text-generator-preview-view-insert-button",O=".kix-ai-text-generator-preview-view",U=".kix-ai-text-generator-prompt-view",B="textarea.kix-ai-text-generator-prompt-view-input",M=".kix-ai-text-generator-preview-view-generated-text",F="button.appsElementsSidekickResponseOptionsOptionsTextButton",H=".appsElementsSidekickFeedContainer",D=".appsElementsSidekickUserMessageBubbleContent",j=".appsElementsSidekickUserMessageRoot",z=".appsElementsSidekickAgentMessageBubbleContent",G=".appsElementsSidekickAgentMessageRoot",L="li.appsElementsGenerativeaiAstAnimated",N="span.appsElementsGenerativeaiAstAnimated:not(li span)"},53785:(e,t,i)=>{var n;i.d(t,{X:()=>n}),function(e){e.modern="modern",e.legacy="legacy",e.modernCollapsedTopbar="modernCollapsedTopbar"}(n||(n={}))},67325:(e,t,i)=>{i.d(t,{WR:()=>_,th:()=>v});var n=i(18117),r=i(39953),s=i(58303),a=i(2084);if(3075==i.j)var o=i(59833);if(3075==i.j)var l=i(90189);if(3075==i.j)var c=i(79625);if(3075==i.j)var h=i(63310);if(3075==i.j)var d=i(68418);var u=i(3944);if(3075==i.j)var g=i(95428);if(3075==i.j)var p=i(90595);var f=i(7833);const m={getCursorRect:()=>(0,r.zG)(s.ij(document.querySelector(f.y1)),s.UI((e=>e.getBoundingClientRect())),s.WG),getCanvasRect:(e,t)=>t?(0,u.k6)(e):(0,r.zG)(s.ij(document.querySelector(f.os)),s.wp((()=>s.ij(document.querySelector(f.gH)))),s.UI((e=>e.getBoundingClientRect())),s.WG),getFirstLineIndentEl:e=>e.querySelector(f.lO),getFontSizeInputEl:()=>document.querySelector(f.Vk),getRulerBackgroundsRects:e=>(0,r.zG)(n.Yt(s.Kw)({backgroundRect:(0,r.zG)(s.ij(e.querySelector(f.gL)),s.UI((e=>e.getBoundingClientRect()))),innerBackgroundRect:(0,r.zG)(s.ij(e.querySelector(f.rx)),s.UI((e=>e.getBoundingClientRect())))}),s.WG),withVisibleRulers:e=>{const t=(0,r.zG)(n.Yt(s.Kw)({horizontalRuler:s.ij(document.querySelector(f.j5)),verticalRuler:s.ij(document.querySelector(f.Kt))}),s.UI((({horizontalRuler:e,verticalRuler:t})=>({horizontalRuler:{node:e,opacity:e.style.opacity,display:e.style.display},verticalRuler:{node:t,opacity:t.style.opacity,display:t.style.display}}))),a.bw((({horizontalRuler:e,verticalRuler:t})=>{"none"===e.display&&(e.node.style.opacity="0",e.node.style.removeProperty("display")),"none"===t.display&&(t.node.style.opacity="0",t.node.style.removeProperty("display"))})));try{return e((0,r.zG)(t,s.UI((({verticalRuler:e})=>e.node)),s.WG),(0,r.zG)(t,s.UI((({horizontalRuler:e})=>e.node)),s.WG))}finally{(0,r.zG)(t,a.bw((({horizontalRuler:e,verticalRuler:t})=>{e.node.style.display=e.display,e.node.style.opacity=e.opacity,t.node.style.display=t.display,t.node.style.opacity=t.opacity})))}}};class v{constructor(e,t,i=m){this._layoutRoot=e,this._telemetry=t,this._gDocsDOM=i,this._refactorGetCanvasRectEnabled=(0,l.OB)().experimentClient.isGateEnabled(p.K.GdocsRefactorDomQuery),this._returnAllRects=(0,l.OB)().experimentClient.isGateEnabled(p.K.GdocsReturnAllRects)}create(e,t){try{if(t.isEmpty()&&0===e.start&&0===e.end)return{rects:(0,r.zG)(s.ij(t.getPageContainingOffset(0)),s.tS((e=>(0,r.zG)(s.ij(this._gDocsDOM.getCursorRect()),s.hX((e=>e.left>0&&e.top>0&&e.height>0)),s.tS((e=>n.Yt(s.Kw)({rect:s.G(e),canvasRect:s.ij(this._gDocsDOM.getCanvasRect(this._layoutRoot,this._refactorGetCanvasRectEnabled))}))),s.UI((({rect:t,canvasRect:i})=>[h.Wm.create(h.UL.shift(h.UL.shift(h.Pf.create(t),d.E9.minus({left:0,top:0},i)),e.getPageRect()))])),s.wp((()=>s.ij(this._gDocsDOM.withVisibleRulers(((t,i)=>(0,r.zG)(n.Yt(s.Kw)({horizontalRuler:s.ij(i),verticalRuler:s.ij(t),lineHeight:(0,r.zG)(s.ij(this._gDocsDOM.getFontSizeInputEl()),s.UI((e=>parseInt(e.value,10))),s.hX((e=>!isNaN(e))),s.UI((e=>1.533*e)))}),s.tS((({horizontalRuler:e,verticalRuler:t,lineHeight:i})=>n.Yt(s.Kw)({firstLineIndent:(0,r.zG)(s.ij(this._gDocsDOM.getFirstLineIndentEl(e)),s.UI((e=>e.offsetLeft+e.offsetWidth/2))),topMargin:(0,r.zG)(s.ij(this._gDocsDOM.getRulerBackgroundsRects(t)),s.UI((({backgroundRect:e,innerBackgroundRect:t})=>t.top-e.top+i)))}))),s.UI((({firstLineIndent:t,topMargin:i})=>[h.Wm.create(h.UL.shift({left:t,top:i,height:0,width:0},e.getPageRect()))])),s.WG))))))))),s.fS((()=>[])))};const i=[];let a,o=e.start,l=!1;const c=t.getPlainText().length;do{const n=t.getFragmentAtOffset(o);if(n&&a!==o){a=o;const t=n.getFragmentInnerRect(o>n.startOffset?o-n.startOffset:0,e.end<n.endOffset?e.end-n.startOffset:void 0),r=n.getPage(),s=r.getPageRect(),l=h.Wm.create(h.UL.shift(b(t,r.getPageInnerSize(),s),s));i.push(l),o=n.endOffset}else this._returnAllRects?(o++,l=o>=c):l=!0}while(o<e.end&&!l);return{rects:i}}catch(e){throw this._telemetry.error("geometryProvider","exception in create method",e),e}}getClientRects(e){try{const t=this._layoutRoot.getClientRects().item(0);if(t){const i={top:this._layoutRoot.scrollTop,left:this._layoutRoot.scrollLeft};return(0,r.zG)(e.rects,c.es,c.yX,o.UI((e=>h.UL.setPosition(d.Ir.fromOffsetPoint(d.p8.create(e),d.Ir.create(t),i),e))))}return null}catch(e){return this._telemetry.error("geometryProvider","exception in getClientRects method",e),null}}getIsInvalid(e){return!1}getIsConsistent(e,t,i){return!0}dispose(e){}}function b(e,t,i){const n=i.width/t.width,r=i.height/t.height;return{left:e.left*n,top:e.top*r,width:e.width*n,height:e.height*r}}function _(e,t,i){const n=t.width/i.width,r=t.height/i.height;return(0,g.cl)({left:e.left*n,top:e.top*r,width:e.width*n,height:e.height*r})}},41806:(e,t,i)=>{i.d(t,{z:()=>f});var n=i(74822),r=i(50750),s=i(63532),a=i(20161),o=i(84178),l=i(90572),c=i(44045),h=i(29479),d=i(36344),u=i(954),g=i(59179),p=i(81933);function f(e,t,i,f=3e3){const m=new n.x,v=new n.x;const b=m.pipe(a.w((t=>null==t?d.E:e.contentChanges.async.pipe(u.O(0),c.R(v.pipe(g.U((e=>e===t)))),c.R(i),h.h(t),c.R(p.timer(f).pipe(s.b((e=>{})))))))).subscribe((i=>{const n=e.getCurrentTextMap(),r=n.getNearestPageFragmentAtOrBeforeOffset(i);if(r){if(r.startOffset<=i&&r.endOffset>=i)return void v.next(i);if(r.endOffset<i){const e=r.getPageRect(),i=t.visibleRect.getApproximate(),n=t.rect.getApproximate().client.top+e.top+e.height-i.client.top-i.size.height;if(n>0)return void requestAnimationFrame((()=>{t.scroller.scrollBy({left:0,top:n})}))}}const s=n.getNearestPageFragmentAfterOffset(i);if(s&&s.startOffset>i){const e=s.getPageRect(),i=t.visibleRect.getApproximate(),n=t.rect.getApproximate().client.top+e.top-i.client.top;if(n<0)return void requestAnimationFrame((()=>{t.scroller.scrollBy({left:0,top:n})}))}}));return{scrollToRect:function(e,i){m.next(null);const n=t.visibleRect.getApproximate();i<=e.top&&e.bottom<=i+n.size.height||t.scroller.scrollBy({top:e.top-i-100})},scrollToRange:function(e){return r.D([0]).pipe(s.b((()=>m.next(e))),a.w((e=>v)),o.q(1),l.h((t=>t===e)),c.R(m.pipe(l.h((t=>t!==e)))),h.h(void 0))},dispose:function(){b.unsubscribe(),m.complete(),v.complete()}}}},18122:(e,t,i)=>{i.d(t,{$2:()=>be,$z:()=>W,A5:()=>b,Ag:()=>re,Bi:()=>S,CC:()=>me,CE:()=>V,CR:()=>Q,CT:()=>F,CU:()=>K,DI:()=>T,Dq:()=>D,Dw:()=>U,EA:()=>he,EI:()=>oe,EU:()=>E,F0:()=>R,Fb:()=>y,Fl:()=>ne,Fr:()=>g,Fs:()=>A,H8:()=>w,Hh:()=>ae,I8:()=>c,IN:()=>te,J1:()=>o,J9:()=>Ie,JQ:()=>ge,K_:()=>fe,Kx:()=>le,L8:()=>M,LF:()=>z,MF:()=>r,Nu:()=>ie,Ox:()=>H,PQ:()=>ue,QS:()=>Ae,QT:()=>J,Qk:()=>ve,Qz:()=>l,RS:()=>pe,Sk:()=>ee,U4:()=>n,U8:()=>ce,UH:()=>x,Wj:()=>I,Zj:()=>Z,_4:()=>p,_s:()=>h,ar:()=>k,b5:()=>ye,c3:()=>X,cf:()=>Se,ch:()=>j,do:()=>Y,e4:()=>C,fI:()=>s,fV:()=>m,fl:()=>P,ft:()=>se,gi:()=>d,hC:()=>u,hr:()=>de,jF:()=>$,ki:()=>_,mB:()=>L,mF:()=>G,n4:()=>a,p$:()=>v,pT:()=>O,pc:()=>we,ph:()=>N,qA:()=>B,rA:()=>f,ti:()=>q,xh:()=>_e});const n=/^\S+\.adobe\.com$/,r=/^airtable\.com$/,s=/^\S+\.atlassian\.net$/,a=/^\S+\.console\.aws\.amazon\.com$/,o=/\S+\.blackboard\.com$/,l=/(^|\.)blackboard\.\S+\.(com|edu|ac.uk)$/,c=/(^|\.)blogger\.com$/,h=/^publish\.buffer\.com$/,d=/canva\.com$/,u=/protect\.staging\.sp0n\.io|protect\.citizen\.com$/,g=/clickup\.com$/,p=/discord\.com$/,f=/ebay\.com$|ebay(\.com?)?\.[a-z]{2}$/,m=/^business\.facebook\.com$/,v=/^facebook\.com$/,b=/^bertie\.forbes\.com$/,_=/^mail\.google\.com$/,S=/^calendar\.google\.com$/,y=/^chat\.google\.com$/,w=/^keep\.google\.com$/,A=/^google\.com$/,I=/^groups\.google\.com$/,x=/^sites\.google\.com$/,C=/^translate\.google(?:\.com?)?(?:\.[a-z]{2})?$/,k=/^instagram\.com$/,R=/.*\.instructure\.com/,E=/^enterprise\.knak\.io$/,P=/^\S+\.lattice\.com$|^\S+\.latticehq\.com$/,T=/^linkedin\.com$/,O=/^(\S+\.)?officeapps\.live\.com$/,U=/^\S+\.liveperson\.com$|^\S+\.liveperson\.net$/,B=/^messenger\.com$/,M=/^teams\.(microsoft|live)\.com$/,F=/^.*\.monday\.com$/,H=/web\.netsfere\.com$/,D=/^.*newsnow\.io$/,j=/^notion\.so$/,z=/^(\S+\.)?coda\.io$/,G=/^\S+\.opencities\.com$/,L=/^.*\.vodafone-elb\.oriserve\.in$/,N=/^outlook\.(live|office)\.com$/,$=/^.*overleaf\.com$/,q=/^poshmark\.com$/,W=/^.*\.quip\.com$/,V=/^quora\.com$/,Y=/^chat\.reddit\.com$/,K=/^reddit\.com$/,X=/^\S+\.lightning\.force\.com$|^\S+\.salesforce\.com$/,Q=/^.*\.service-now\.com$/,J=/^\S+\.slack\.com$/,Z=/^app\.sproutsocial\.com$/,ee=/^\S+\.squarespace\.com$/,te=/^strava\.com$/,ie=/^mail\.superhuman\.com$/,ne=/^trello\.com$/,re=/^(mobile\.)?(twitter|x)\.com$/,se=/^\S+\.udacity\.com$/,ae=/^upwork\.com$/,oe=/^wattpad\.com$/,le=/^web\.whatsapp\.com$/,ce=/^\S+\.wix\.com$/,he=/^wordcounter\.net$/,de=/\/wp-admin$|\/wp-admin\//,ue=/^(\S+\.)?wordpress\.com$/,ge=/wsib\.on\.ca$/,pe=/^yelp\.com$/,fe=/^mail\.yahoo\.com$/,me=/^youtube\.com$/,ve=/^(\S+\.)?zendesk\.com$/,be=/^\S+\.zoho\.in$/,_e=/^chatgpt\.com$/,Se=/^(\S+\.)?hygraph\.com$/,ye=/^(\S+\.)?hubspot[\w-]*\.com$/,we=/^(\S+\.)?useindio\.com$/,Ae=/^(\S+\.)?freshdesk\.com$/,Ie=/^(\S+\.)?my\.connect\.aws$/},38456:(e,t,i)=>{i.d(t,{U:()=>h});var n=i(82048);function r(e,t){return(65535&e)*t+(((e>>>16)*t&65535)<<16)}function s(e,t){return e<<t|e>>>32-t}const a=3432918353,o=461845907;class l{getHash(e,t=0){const i=(new TextEncoder).encode(e),n=i.length%4,l=i.length-n;let c,h=t,d=0;for(c=0;c<l;c+=4)h=r(s(h^r(s(r(i[c]|i[c+1]<<8|i[c+2]<<16|i[c+3]<<24,a),15),o),13),5)+3864292196;switch(d=0,n){case 3:d^=i[c+2]<<16;case 2:d^=i[c+1]<<8;case 1:d^=i[c],h^=r(s(r(d,a),15),o)}return u=r((u=h^i.length)^u>>>16,2246822507),((u=r(u^u>>>13,3266489909))^u>>>16)>>>0;var u}}var c;!function(e){e.preferred=l}(c||(c={}));const h=(e,t)=>{const i=(0,n.bk)(e,-1,(e=>e.nodeName)),r=`${t},${e.nodeName},${i.join()}`;return(new c.preferred).getHash(r).toString()}},18839:(e,t,i)=>{i.d(t,{Dg:()=>l,IQ:()=>d,e8:()=>c,fW:()=>h});var n=i(92379),r=i(63532),s=i(81933),a=i(79825),o=i(92759);const l=n.createContext({state:s.of(o.h.create()),onMount:()=>{}});function c(){return n.useContext(l).onMount}function h(){const e=n.useContext(l).state,[t,i]=n.useState(o.h.create());return(0,a.A)(e.pipe((0,r.b)((e=>i(e))))),t}function d(){return n.useContext(l).state.pipe(s.pluck("dragging"))}},92759:(e,t,i)=>{var n;i.d(t,{h:()=>n}),function(e){e.create=function(){return{translate:{x:0,y:0},lastTranslate:{x:0,y:0},dragging:!1,dragStart:!1,dragEnd:!1}}}(n||(n={}))},2914:(e,t,i)=>{i.d(t,{_:()=>T});var n=i(92379),r=i(63532),s=i(50699),a=i(79825),o=i(78953),l=i(18839),c=i(92759),h=i(90023),d=i(62552),u=i(84308),g=i(59179),p=i(90572),f=i(85004),m=i(32330),v=i(84714),b=i(55341),_=i(32734),S=i(24666),y=i(20161),w=i(44071),A=i(44045),I=i(84908),x=i(10883),C=i(17610),k=i(3199),R=i(18647),E=i(78767);function P(e=v.of((e=>e)),t){const i=n.useRef(new b.t(1)),s=n.useRef(i.current.pipe(function(e=v.of(h.yR),t=(()=>!0)){return(0,h.ls)(p.h(E.fQ),S.x(),y.w((i=>w.R(i,"mousedown").pipe(p.h((e=>!e.button)),p.h((e=>t(e))),r.b((e=>e.preventDefault())),g.U((e=>({element:i,startPos:{x:e.clientX,y:e.clientY}}))),y.w((t=>w.R((0,R.Jj)(t.element),"mousemove").pipe(A.R(w.R((0,R.Jj)(t.element),"mouseup",{capture:!0})),I.p(10),g.U((({clientX:e,clientY:i})=>({kind:"dragInProgress",element:t.element,startPos:t.startPos,delta:{x:e-t.startPos.x,y:i-t.startPos.y}}))),x.M(e),g.U((([e,t])=>({...e,delta:t(e.delta)}))),C.l({kind:"dragDone"}))))))),k.R(((e,t)=>"dragDone"===t.kind?{translate:e.translate,lastTranslate:e.translate,dragging:!1,dragStart:!1,dragEnd:e.dragging}:{dragging:!0,dragStart:!e.dragging,dragEnd:!1,lastTranslate:e.lastTranslate,translate:{x:t.delta.x+e.lastTranslate.x,y:t.delta.y+e.lastTranslate.y}}),c.h.create()))}(e,t),_.B())),a=n.useCallback((e=>i.current.next(e)),[i.current]);return[s.current,a]}const T=n.forwardRef((function({children:e,hasDragHandle:t,bounds:i,dragEventFilter:v,onChangeDragState:b},_){const S=n.useRef(null),y=(0,s.K)(i),[w,A]=function(e,t,i){const s=n.useRef(null),o=n.useRef(new d.X(null)),l=n.useRef(u.a([e,o.current]).pipe(g.U((([e,t])=>t&&e?(0,m.N)(t,e):h.yR)))),[c,v]=P(l.current,i);(0,a.A)(c.pipe(p.h((e=>e.dragStart)),r.b((()=>b())))),n.useEffect((()=>{var e;return t.current&&(null===(e=s.current)||void 0===e||e.disconnect(),s.current=f.N.getResizeObserver(b),s.current.observe(t.current)),()=>{var e;return null===(e=s.current)||void 0===e?void 0:e.disconnect()}}),[t.current]);const b=()=>{t.current&&o.current.next(t.current.getBoundingClientRect())};return[c,v]}(y,S,v),[I,x]=n.useState(c.h.create()),C=n.useRef({state:w,onMount:A});(0,a.A)(w.pipe((0,r.b)((e=>{x(e),null==b||b(e)}))));const k={ref:(0,o.l)([_,S,...(0,o.O)(e)?[e.ref]:[]],t?void 0:A)};return n.createElement(l.Dg.Provider,{value:C.current},n.cloneElement("function"==typeof e?e(I):e,k))}))},32330:(e,t,i)=>{function n(e,t){const i=e.left<t.left?t.left:e.left+e.width>t.left+t.width?t.left+t.width-e.width:e.left,n=e.top<t.top?t.top:e.top+e.height>t.top+t.height?t.top+t.height-e.height:e.top;return{...e,left:i,top:n}}function r(e,t){return i=>{const r=n({left:e.left+i.x,top:e.top+i.y,width:e.width,height:e.height},t);return{x:r.left-e.left,y:r.top-e.top}}}i.d(t,{N:()=>r,m:()=>n})},64910:(e,t,i)=>{i.d(t,{J:()=>s});var n=i(44071),r=i(56052);class s extends r.U{constructor({textField:e,kind:t,settings:i,handler:n}){super(t,i,n),this._textField=e,this._initKeydownListener()}_initKeydownListener(){this._subs.push((0,n.R)(this._textField,"keydown").subscribe((e=>{this._isShortcutMatch(e)&&this._handleShortcut(e)})))}dispose(){this._subs.forEach((e=>e.unsubscribe())),this._subs=[]}}},8536:(e,t,i)=>{i.d(t,{KC:()=>h,Y4:()=>d,sX:()=>u});var n=i(92379),r=i(62552),s=i(24666),a=i(81933),o=i(78953),l=i(85004),c=i(36650);const h={top:-1e4,left:-1e4,flippedHorizontal:!1,flippedVertical:!1,width:0,height:0},d=n.createContext(a.of(h)),u=n.forwardRef((({children:e,anchorRect:t,anchorOrigin:i={vertical:"bottom",horizontal:"left"},elementOrigin:a={vertical:"top",horizontal:"left"},offset:u={horizontal:0,vertical:0},postRepositioningOffset:g,repositioning:p={horizontal:"translate",vertical:"flip"},anchorMargin:f={top:0,left:0,bottom:0,right:0},viewportMargin:m=16,viewportRect:v=(0,c.C7)(),stickToTarget:b=!0,onChangePosition:_},S)=>{const y=n.useRef(null),w=n.useRef(null),A=n.useRef(new r.X(h)),[I,x]=n.useState(A.current.value),C=[v.top,v.left,v.width,v.height,t.top,t.left,t.width,t.height,i.horizontal,i.vertical,a.horizontal,a.vertical,u.horizontal,u.vertical,null==g?void 0:g.horizontal,null==g?void 0:g.vertical,f.top,f.right,f.bottom,f.left,m,b];n.useEffect((()=>{const e=A.current.pipe((0,s.x)(((e,t)=>function(e,t){return Math.floor(e.top)===Math.floor(t.top)&&Math.floor(e.left)===Math.floor(t.left)&&Math.floor(e.width)===Math.floor(t.width)&&Math.floor(e.height)===Math.floor(t.height)}(e,t)))).subscribe((e=>{x(e),null==_||_(e)}));return()=>e.unsubscribe()}),[]);const k=()=>{var e,n;const r=null===(e=y.current)||void 0===e?void 0:e.clientWidth,s=null===(n=y.current)||void 0===n?void 0:n.clientHeight,o=(0,c.C7)();if(r&&s){const e=(0,c.kl)(r,s,o,t,i,a,f,{top:m,bottom:m,left:m,right:m},u,g,p,b);A.current.next({...e,width:r,height:s})}};n.useEffect((()=>{var e;return y&&y.current&&(null===(e=w.current)||void 0===e||e.disconnect(),w.current=l.N.getResizeObserver(k),w.current.observe(y.current)),()=>{var e;return null===(e=w.current)||void 0===e?void 0:e.disconnect()}}),[y.current,...C]),n.useLayoutEffect((()=>{k()}),C);const R={ref:(0,o.l)([S,y,...(0,o.O)(e)?[e.ref]:[]])};return n.createElement(d.Provider,{value:A.current},n.cloneElement("function"==typeof e?e(I):e,R))}));u.displayName="Positioner"},27327:(e,t,i)=>{i.d(t,{o:()=>a});var n=i(92379),r=i(85837),s=i(15376);const a=n.forwardRef((function({children:e,className:t,...i},a){return n.createElement("div",{...i,...(0,r.Sh)(s.fontWrapper,t),ref:a},e)}))},4636:(e,t,i)=>{i.d(t,{d:()=>a,p:()=>o});var n=i(92379),r=i(62552);const s=new class{constructor(){this._currentRef=0,this._tooltipsSubject=new r.X(null),this.tooltips=this._tooltipsSubject.asObservable()}show(e){this.hide(this._currentRef);const t=e.showDelay||0;return this._timeoutHandler=setTimeout((()=>{this._tooltipsSubject.next(e)}),t),++this._currentRef}hide(e){e===this._currentRef&&(this.clearTimeout(),this._tooltipsSubject.next(null))}clearTimeout(){null!==this._timeoutHandler&&(clearTimeout(this._timeoutHandler),this._timeoutHandler=null)}},a=n.createContext(s),o=({children:e})=>n.createElement(a.Provider,{value:s},e)},69652:(e,t,i)=>{i.d(t,{u:()=>y});var n=i(92379),r=i(84308),s=i(954),a=i(29416),o=i(63532),l=i(55341),c=i(44071),h=i(90572),d=i(24666),u=i(20161),g=i(21070),p=i(14969),f=i(29479),m=i(78767);var v=i(50699),b=i(79825),_=i(78953),S=i(4636);const y=n.forwardRef((function({children:e,message:t,position:i="top",showDelay:y=100,style:w,offset:A,disabled:I=!1,withGrammarlyIcon:x=!1,withCenteredGrammarlyIcon:C=!1,forcedMessage:k,onHideTooltip:R},E){const[P,T]=function(){const e=n.useRef(new l.t(1)),t=n.useRef(e.current.pipe((0,h.h)(m.fQ),(0,d.x)(),(0,u.w)((e=>(0,c.R)(e,"mouseover").pipe((0,g.z)((()=>(0,c.R)(e,"mouseleave").pipe((0,p.P)(),(0,f.h)(!1),(0,s.O)(!0))))))))),i=n.useCallback((t=>e.current.next(t)),[e.current]);return[t.current,i]}(),O=n.useRef(null),U=n.useContext(S.d),B=n.useRef(null),M=(0,v.K)(k),F=(0,v.K)(I),H=(0,v.K)(t),D=n.useCallback((()=>{B.current&&(U.hide(B.current),B.current=null,null==R||R())}),[]);n.useEffect((()=>{var e,t,i;return null===(i=null===(t=null===(e=O.current)||void 0===e?void 0:e.ownerDocument)||void 0===t?void 0:t.defaultView)||void 0===i||i.addEventListener("scroll",D),()=>{var e,t,i;return null===(i=null===(t=null===(e=O.current)||void 0===e?void 0:e.ownerDocument)||void 0===t?void 0:t.defaultView)||void 0===i?void 0:i.removeEventListener("scroll",D)}}),[O]);const j=(0,r.a)([P.pipe((0,s.O)(!1)),M,F,H]);(0,b.A)(j.pipe((0,a.b)(y),(0,o.b)((([e,t,n,r])=>{(e||t)&&!n&&null===B.current&&O.current&&r&&(B.current=U.show({message:null!=t?t:r,position:i,style:w,offset:A,anchor:O.current.getBoundingClientRect(),withGrammarlyIcon:x,withCenteredGrammarlyIcon:C}))})))),(0,b.A)(j.pipe((0,o.b)((([e,t,i,n])=>{(e||t)&&!i&&null===B.current&&O.current&&n||D()})))),(0,b.A)(F.pipe((0,o.b)((e=>e&&D())))),n.useEffect((()=>()=>D()),[]);const z={ref:(0,_.l)([E,O,...(0,_.O)(e)?[e.ref]:[]],T)};return n.cloneElement(e,z)}))},31152:(e,t,i)=>{i.d(t,{y$:()=>u});var n=i(92379);if(6168!=i.j)var r=i(28338);if(6168!=i.j)var s=i(85837);if(6168!=i.j)var a=i(74211);if(6168!=i.j)var o=i(3038);var l=i(15765);const c={blue:l.highlightColorBlue,green:l.highlightColorGreen,lightGreen:l.highlightColorLightGreen,gray:l.highlightColorGray,purple:l.highlightColorPurple,red:l.highlightColorRed,gold:l.highlightColorGold,plagiarism:l.highlightColorPlagiarism,weHbar:l.highligthColorWeHbar};function h(e,t){switch(e){case o.jk.background:return l.highlightBackgroundOnly;case o.jk.enclosing:return l.highlightEnclosing;case o.jk.underline:return l.highlightUnderlineOnly;case o.jk.underlineStart:return"solid"===t?l.highlightUnderlineOnly:l.highlightUnderlineStartOnly;case o.jk.dottedUnderlineAndBackground:return l.highlightDottedUnderlineAndBackground;case o.jk.underlineAndBackground:return;case o.jk.underlineAndPersistentBackground:return l.highlightUnderlineAndPersistentBackground;case o.jk.superUnderline:return l.highlightSuperUnderline;case o.jk.underlineOnHoverOnly:return l.highlightUnderlineOnHoverOnly;case o.jk.underlineStartOnHoverOnly:return l.highlightUnderlineStartOnHoverOnly;case o.jk.underlineAndBackgroundOnHoverOnly:return l.highlightUnderlineAndBackgroundOnHoverOnly;default:(0,r.L0)(e)}}function d(e,{displayFormat:t,superUnderlineStyle:i,rects:n}){if(t!==o.jk.superUnderline||!i||!n[e])return;const s=0===e,a=e===n.length-1;switch(i){case"beginning":return a?l.highlightSuperUnderlineBeginning:l.highlightSuperUnderlineSolid;case"middle":return s&&a?l.highlightSuperUnderlineMiddle:s?l.highlightSuperUnderlineEnding:a?l.highlightSuperUnderlineBeginning:l.highlightSuperUnderlineSolid;case"ending":return s?l.highlightSuperUnderlineEnding:l.highlightSuperUnderlineSolid;default:(0,r.L0)(i)}}const u=e=>(n.useEffect((()=>{var t;null===(t=e.onMount)||void 0===t||t.call(e,e.alertId)}),[]),n.createElement(n.Fragment,null,e.rects.map(((t,i)=>{var r,u,g;const p=e.rects.length>1?`${e.id}-${i}`:e.id,f=(0,a.M)({...e,rect:t,rectIndex:i,highlightDisplayFormat:e.displayFormat});return n.createElement("div",{key:p,"data-key":p,"data-grammarly-part":"highlight","data-highlight-format":e.displayFormat,"data-highlight-color-name":o.hE.getColorName(e.color),style:{top:f.top,left:f.left,width:f.width,height:Math.max(0,f.height+Number(e.heightOffset)),...o.hE.isPreset(e.color)?(0,o.Y4)(null===(r=e.underlineStartParts)||void 0===r?void 0:r[i],e.color.color):void 0},...(0,s.Sh)(l.highlight,o.hE.isPreset(e.color)?c[e.color.color]:void 0,e.hovered?l.highlightHovered:void 0,e.disappear?l.highlightDisappear:void 0,e.needsAttention?l.highlightNeedsAttention:void 0,h(e.displayFormat,null===(g=null===(u=e.underlineStartParts)||void 0===u?void 0:u[i])||void 0===g?void 0:g.kind),d(i,e),e.liveliness===o.iY.static?l.highlightStatic:e.liveliness===o.iY.inert?l.highlightInert:void 0,e.theme?"dark"===e.theme?l.dark:l.light:null)},n.createElement("div",{className:l.highlightBackground,style:o.hE.isCustom(e.color)?{backgroundColor:e.color.color.background}:void 0}),n.createElement("div",{...(0,s.Sh)(l.highlightUnderline,e.isWEHighlight?l.highlightHbar:null,"regular"===e.underlineAnimationSpeed?l.highlightUnderlineAnimatedRegular:null,"slow"===e.underlineAnimationSpeed?l.highlightUnderlineAnimatedSlow:null),style:o.hE.isCustom(e.color)?{backgroundColor:e.color.color.underline}:void 0}))}))))},3038:(e,t,i)=>{i.d(t,{Y4:()=>p,al:()=>n,hE:()=>r,iY:()=>a,jk:()=>s,y$:()=>g});var n,r,s,a,o=i(92379);if(6168!=i.j)var l=i(63349);if(6168!=i.j)var c=i(53768);if(6168!=i.j)var h=i(28338);if(6168!=i.j)var d=i(4141);if(6168!=i.j)var u=i(31152);!function(e){e.blue="blue",e.green="green",e.lightGreen="lightGreen",e.gray="gray",e.purple="purple",e.red="red",e.gold="gold",e.plagiarism="plagiarism",e.weHbar="weHbar"}(n||(n={})),function(e){let t,i;function n(e){return"preset"===e.kind}!function(e){e.create=function(e){return{kind:"preset",color:e}}}(t=e.Preset||(e.Preset={})),function(e){e.create=function(e,t){return{kind:"custom",color:{background:e,underline:t}}}}(i=e.Custom||(e.Custom={})),e.isCustom=function(e){return"custom"===e.kind},e.isPreset=n,e.getColorName=function(e){return n(e)?e.color:"custom"}}(r||(r={})),function(e){e.underline="underline",e.underlineStart="underlineStart",e.background="background",e.underlineAndBackground="underlineAndBackground",e.underlineAndPersistentBackground="underlineAndPersistentBackground",e.dottedUnderlineAndBackground="dottedUnderlineAndBackground",e.enclosing="enclosing",e.superUnderline="superUnderline",e.underlineOnHoverOnly="underlineOnHoverOnly",e.underlineStartOnHoverOnly="underlineStartOnHoverOnly",e.underlineAndBackgroundOnHoverOnly="underlineAndBackgroundOnHoverOnly"}(s||(s={})),function(e){e.isInteractable=function(t){return![e.enclosing,e.underlineOnHoverOnly,e.underlineStartOnHoverOnly,e.underlineAndBackgroundOnHoverOnly].includes(t)}}(s||(s={})),function(e){e.animated="animated",e.static="static",e.inert="inert"}(a||(a={}));const g=({heightOffset:e=0,hovered:t=!1,needsAttention:i=!1,underlineAnimationSpeed:n="regular",liveliness:r=a.animated,theme:l,...c})=>{var h;const[g,p]=o.useState(!1);(0,d.x)((()=>p(!0)),null!==(h=c.disappearOnHoverDelay)&&void 0!==h?h:0,[c.disappearOnHoverDelay,t,i,g],(()=>null!==c.disappearOnHoverDelay&&c.disappearOnHoverDelay>=0&&(t||i)&&!g)),o.useEffect((()=>{p(!1)}),[c.disappearOnHoverDelay]),o.useEffect((()=>{t||i||p(!1)}),[t,i]);const f=c.displayFormat===s.underlineStart?function(e,t=100){let i=0;const n=e.reduce(((e,t)=>e+t.width),0)-t;return e.map((e=>{if(i+e.width<n)return i+=e.width,{kind:"solid"};if(i<n){const r=(n-i)/e.width,s=(e.width-(n-i))/t;return i+=e.width,{kind:"gradient",colorStops:[{alpha:1,stop:0},{alpha:1,stop:r},{alpha:1-s,stop:1}]}}{const r=i-n,s=r/t,a=(r+e.width)/t;return i+=e.width,{kind:"gradient",colorStops:[{alpha:1-s,stop:0},{alpha:1-a,stop:1}]}}}))}(c.rects):null;return o.createElement(u.y$,{heightOffset:e,hovered:t,needsAttention:i,underlineAnimationSpeed:n,liveliness:r,theme:l,disappear:g,underlineStartParts:f,...c})};function p(e,t){return void 0===e||"solid"===e.kind?{}:function(e,t){const{underline:i,underlineHovered:r}=function(e){switch(e){case n.blue:return{underline:"#99C2FF",underlineHovered:"#4A6EE0"};case n.red:return{underline:"#FF99AB",underlineHovered:"#EA1537"};case n.green:return{underline:"#AAF2E1",underlineHovered:"#15C39A"};case n.lightGreen:return{underline:"#41D9B5",underlineHovered:"#15C39A"};case n.purple:return{underline:"#D3A1F7",underlineHovered:"#8F4CBF"};case n.gold:return{underline:"#FFDF80",underlineHovered:c.Gold40};case n.gray:return{underline:"#E7E9F5",underlineHovered:"#6D758D"};case n.plagiarism:return{underline:"#09A4B280",underlineHovered:"#09A4B2"};case n.weHbar:return{underline:"#D7E8A9",underlineHovered:"#ADD04F"};default:(0,h.vE)(e)}}(t);return{"--underline-start-gradient":f(e,i),"--underline-start-gradient-hovered":f(e,r)}}(e,t)}function f(e,t){return`linear-gradient(to right, ${e.colorStops.map((({stop:e,alpha:i})=>`${l.ux.color(t).fade(i).toRGBA().toString()} ${100*e}%`)).join(", ")})`}},4141:(e,t,i)=>{i.d(t,{x:()=>r});var n=i(92379);function r(e,t,i,r=(()=>!0)){n.useEffect((()=>{let i=null;return r()&&(null!==i&&self.clearTimeout(i),i=self.setTimeout(e,t)),()=>{null!==i&&self.clearTimeout(i),i=null}}),i)}},50699:(e,t,i)=>{i.d(t,{K:()=>s});var n=i(92379),r=i(62552);function s(e){const t=n.useRef(new r.X(e));return n.useEffect((()=>{t.current.next(e)}),[e]),t.current}},79825:(e,t,i)=>{i.d(t,{A:()=>r});var n=i(92379);function r(e){n.useEffect((()=>{const t=e.subscribe();return()=>t.unsubscribe()}),[])}},36650:(e,t,i)=>{i.d(t,{C7:()=>p,jJ:()=>g,kl:()=>o});var n=i(90595),r=i(78767),s=i(29483),a=i(32330);function o(e,t,i,n,r,s,a,o,h,d,u,g){const p={top:i.top+o.top,left:i.left+o.left,width:i.width-o.left-o.right,height:i.height-o.top-o.bottom},b=function(e,t,i,n,r,s,a,o,l){const c=v(e,t,i,n,l,s,a);return[{...c,flippedHorizontal:!1,flippedVertical:!1}].concat((Array.isArray(r)?r:[r]).map((r=>({...v(e,m(t,r),m(i,r),f(n,c.overlap,r,s,a,o),l,s,a),flippedHorizontal:"flip"===r.horizontal,flippedVertical:"flip"===r.vertical}))))}({top:n.top-a.top,left:n.left-a.left,width:n.width+a.left+a.right,height:n.height+a.top+a.bottom},r,s,h,u,e,t,g,p),_=b.reduce(((e,t)=>e.overlap.vertical<=t.overlap.vertical?e:t)),S=b.reduce(((e,t)=>e.overlap.horizontal<=t.overlap.horizontal?e:t)),y=c({top:_.position.top,left:S.position.left,flippedHorizontal:S.flippedHorizontal,flippedVertical:_.flippedVertical},d,i,e,t);return l(y,e,t,p)}const l=(e,t,i,n)=>{const{top:r,left:s}=(0,a.m)({top:e.top,left:e.left,width:t,height:i},n);return{...e,top:r,left:s}},c=(e,t,i,n,r)=>{if(void 0===t)return e;const s=f(t,h(d({top:e.top+t.vertical,left:e.left+t.horizontal,width:n,height:r},i)),{horizontal:"translate",vertical:"translate"},n,r,!1);return{...e,top:e.top+s.vertical,left:e.left+s.horizontal}};function h(e){const t=Math.abs(Math.min(e.left,0)),i=Math.abs(Math.min(e.right,0)),n=Math.abs(Math.min(e.top,0)),r=Math.abs(Math.min(e.bottom,0));return{horizontal:t+i,vertical:n+r,top:n,bottom:r,left:t,right:i}}function d(e,t){return{top:e.top-t.top,bottom:t.top+t.height-(e.top+e.height),left:e.left-t.left,right:t.left+t.width-(e.left+e.width)}}const u=(0,r.Vo)((()=>(0,s.OB)().experimentClient.isGateEnabled(n.K.UseBodyToGetViewportDimentions)));function g(e=document){return!e.doctype&&u.get()?{top:e.body.scrollTop,left:e.body.scrollLeft,height:e.body.clientHeight,width:e.body.clientWidth}:{top:e.documentElement.scrollTop,left:e.documentElement.scrollLeft,height:e.documentElement.clientHeight,width:e.documentElement.clientWidth}}function p(e=document){return{top:0,left:0,height:!e.doctype&&u.get()?e.body.clientHeight:e.documentElement.clientHeight,width:e.documentElement.clientWidth}}function f(e,t,i,n,r,s){const a=t.left&&t.right?0:0!==t.left?Math.min(t.left,s?n:1/0):-Math.min(t.right,s?n:1/0),o=t.top&&t.bottom?0:0!==t.top?Math.min(t.top,s?r:1/0):-Math.min(t.bottom,s?r:1/0);return{horizontal:"translate"===i.horizontal?e.horizontal+a:-e.horizontal,vertical:"translate"===i.vertical?e.vertical+o:-e.vertical}}function m(e,t){return{vertical:"translate"===t.vertical?e.vertical:"top"===e.vertical?"bottom":"top",horizontal:"translate"===t.horizontal?e.horizontal:"left"===e.horizontal?"right":"left"}}function v(e,t,i,n,r,s,a){const{top:o,left:l}=function(e,t,i,n,r){return{top:e.top+r.vertical+("bottom"===i.vertical?e.height:"center"===i.vertical?e.height/2:0)-("bottom"===n.vertical?t.height:"center"===n.vertical?t.height/2:0),left:e.left+r.horizontal+("right"===i.horizontal?e.width:"center"===i.horizontal?e.width/2:0)-("right"===n.horizontal?t.width:"center"===n.horizontal?t.width/2:0)}}(e,{width:s,height:a},t,i,n);return{position:{top:o,left:l},overlap:h(d({top:o,left:l,width:s,height:a},r))}}},78953:(e,t,i)=>{function n(e,t){return i=>{e.forEach((e=>{"function"==typeof e?e(i):e&&(e.current=i),null==t||t(i)}))}}function r(e){return"ref"in e&&(null===e.ref||"function"==typeof e.ref||"object"==typeof e.ref&&"current"in e.ref)}i.d(t,{O:()=>r,l:()=>n})},45523:(e,t,i)=>{i.d(t,{x:()=>n});var n,r=i(49601),s=i(8867),a=i(32734),o=i(37108),l=i(8065),c=i(59179);!function(e){function t(e,t){return i(e,t).pipe((0,a.B)(),(0,o.Q)(r.E))}function i(e,t){return new s.y((i=>{const n=new MutationObserver((e=>i.next(e)));return n.observe(e,t),()=>n.disconnect()}))}e.create=t,e.createUnsafe=i,e.createFlattenHot=function(e,t){return i(e,t).pipe((0,l.b)((e=>e)),(0,a.B)())},e.observeAttribute=function(e,i){return t(e,{attributes:!0,attributeFilter:[i],subtree:!1,childList:!1}).pipe((0,c.U)((t=>e.getAttribute(i))))},e.observeStyle=function(e){return t(e,{attributes:!0,attributeFilter:["style"],subtree:!1,childList:!1}).pipe((0,c.U)((t=>e.style)))},e.observeChildList=function(e){return t(e,{attributes:!1,subtree:!1,childList:!0}).pipe((0,c.U)((t=>e.childNodes)))}}(n||(n={}))},85004:(e,t,i)=>{i.d(t,{N:()=>n});var n,r=i(49601),s=i(8867),a=i(32734),o=i(37108),l=i(17705),c=i(954),h=i(49629),d=i(45523);!function(e){function t(e){return function(e){return new s.y((t=>{const n=i((()=>t.next(void 0)));return e.forEach((e=>n.observe(e))),()=>n.disconnect()}))}(e).pipe((0,a.B)(),(0,o.Q)(r.E))}function i(e){return new n(e)}e.observeSizeChanges=function(e){return t(e)},e.getResizeObserver=i;class n{constructor(e){this._af=null,this._callbackWasInvoked=!1;const t=()=>{this._callbackWasInvoked?(null!==this._af&&cancelAnimationFrame(this._af),this._af=requestAnimationFrame((()=>{e()}))):(e(),this._callbackWasInvoked=!0)};try{this._resizeObserver=new ResizeObserver(t)}catch(e){this._resizeObserver=new u(t)}}observe(e){this._clearAnimationFrame(),this._resizeObserver.observe(e)}unobserve(e){this._resizeObserver.unobserve(e),this._clearAnimationFrame()}disconnect(){this._resizeObserver.disconnect(),this._clearAnimationFrame()}_clearAnimationFrame(){this._af&&(cancelAnimationFrame(this._af),this._af=null),this._callbackWasInvoked=!1}}class u{constructor(e){this._callback=e,this._sub=null}observe(e){this._sub=d.x.create(e,{attributes:!0,childList:!0,subtree:!0}).pipe((0,l.T)(h.S.hz4),(0,c.O)(null)).subscribe((()=>{this._callback()}))}unobserve(){this._sub&&(this._sub.unsubscribe(),this._sub=null)}disconnect(){this.unobserve()}}}(n||(n={}))},14128:(e,t,i)=>{i.d(t,{Wb:()=>o,mp:()=>l,rX:()=>c});var n=i(39953),r=i(52071),s=i(12518),a=i(26155);function o(e){return{x:e.left,y:e.top,top:e.top,left:e.left,width:e.width,height:e.height,bottom:e.top+e.height,right:e.left+e.width,toJSON:()=>e}}function l(e){return(0,n.zG)(e(),s.g_((e=>e),(e=>e)))}function c(e,t){const i=r.bv.is(e)?e.meta:{};return a.NC.expandIfNeeded({start:e.start,end:e.end,...i},t)}},35248:(e,t,i)=>{i.d(t,{B:()=>r});var n=i(70843);const r=e=>"test"===(null==e?void 0:e.getTreatment(n.p.OAuth2Phase2Interactive))},95428:(e,t,i)=>{function n(e){return e}i.d(t,{cl:()=>n})},84195:(e,t,i)=>{i.d(t,{n:()=>n});class n{constructor(e){this._messageApi=e}on(e){this._messageApi.onRuntimeMessage.addListener(e)}off(e){this._messageApi.onRuntimeMessage.removeListener(e)}sendMessage(e){return this._messageApi.sendRuntimeMessage(e)}}},87410:(e,t,i)=>{if(i.d(t,{S:()=>s,v:()=>r}),6168!=i.j)var n=i(12518);async function r(e,t=self){var i,n,r,s;if("string"==typeof e){if(null===(n=null===(i=t.navigator)||void 0===i?void 0:i.clipboard)||void 0===n?void 0:n.writeText)return t.navigator.clipboard.writeText(e);throw new Error("Clipboard API not supported (writeText)")}if(null===(s=null===(r=t.navigator)||void 0===r?void 0:r.clipboard)||void 0===s?void 0:s.write)return t.navigator.clipboard.write(Array.from(e));throw new Error("Clipboard API not supported (write)")}function s(e,t=self){return r(e,t).then((()=>n.F2(void 0))).catch((e=>n.t$(e instanceof Error?e:new Error(String(e)))))}},47557:(e,t,i)=>{if(i.d(t,{BM:()=>f,IG:()=>v,Re:()=>m,Tv:()=>p,VD:()=>b,YN:()=>y,_N:()=>_,a2:()=>S,qw:()=>g}),6168!=i.j)var n=i(64271);if(6168!=i.j)var r=i(44071);if(6168!=i.j)var s=i(29479);if(3075==i.j)var a=i(954);if(3075==i.j)var o=i(59179);if(3075==i.j)var l=i(90572);if(6168!=i.j)var c=i(18647);if(3075==i.j)var h=i(45523);if(3075==i.j)var d=i(78767);if(6168!=i.j)var u=i(79707);function g(e){return(0,n.T)((0,r.R)(e,"focus").pipe((0,s.h)(!0)),(0,r.R)(e,"blur").pipe((0,s.h)(!1)))}function p(e){return e.nodeType===Node.ELEMENT_NODE}function f(e){return e.nodeType===Node.TEXT_NODE}function m(e){return e.nodeType===Node.ELEMENT_NODE&&e instanceof HTMLElement}function v(e,t){return h.x.create(e,{childList:!0,subtree:!0,attributes:!1}).pipe((0,a.O)(null),(0,o.U)((e=>{const i=Object.entries(t).reduce(((e,[t,i])=>({...e,[t]:i()})),{});return Object.values(i).filter(d.fQ).length===Object.keys(i).length?i:null})),(0,l.h)((e=>!!e)))}var b;function _(e,t,i){return n((0,c.Me)(t));function n(t){const i=t.elementFromPoint(e.left,e.top);if(!i)return!1;const n=r(i);if(null!==n)return n;const s=t.elementsFromPoint(e.left,e.top);for(const e of s){if(e===i)continue;const t=r(e);if(null!==t)return t}return!1}function r(e){var r;return!(t!==e&&!t.contains(e))||((null==i?void 0:i(e))?null:!!(null===(r=e.shadowRoot)||void 0===r?void 0:r.elementsFromPoint)&&n(e.shadowRoot))}}function S(e){if(e.endsWith("px")){const t=e.slice(0,-2),i=Number(t);return(0,u.hj)(i)?i:null}return null}function y(e){var t;const i=(null!==(t=e.ownerDocument.defaultView)&&void 0!==t?t:self).getComputedStyle(e).zIndex,n="auto"!==i&&parseInt(i||"0",10)||null;return null!==n?n:e.parentNode&&e.parentNode.nodeType===Node.ELEMENT_NODE?y(e.parentNode):null}!function(e){e[e.Escape=27]="Escape",e[e.Return=13]="Return",e[e.Tab=9]="Tab",e[e.RightArrow=39]="RightArrow",e[e.UpArrow=38]="UpArrow",e[e.DownArrow=40]="DownArrow"}(b||(b={}))},21887:e=>{e.exports={staticAssistant:"nHJqk"}},67528:e=>{e.exports={highlightRect:"XWxTA",hidden:"o979x",attention:"bHjcD",blink:"oy7wj"}},25640:e=>{e.exports={ideateButton:"_ErYR",ideateButtonIcon:"i8HXG",spin:"CSZH1"}},85670:e=>{e.exports={entryButton:"cDocn",entryButtonItem:"dJCJe",rewriteIcon:"wGNWN",openIcon:"vIUqu",translateIcon:"xpU4I",spin:"A8MjA"}},19437:e=>{e.exports={replyButton:"ZfD1U",icon:"BdxRh",spin:"MBS28"}},57402:e=>{e.exports={quasiCaret:"WhbAl",icon:"Yd_W5"}},42087:e=>{e.exports={priority:"Eg8pv",emoji:"Ls_xS",cardEmoji:"ZVWqH",emojiButtonWrapper:"cenoh",emojiContainer:"Bg2tI",emojiButtonShow:"C3ro0",emojiButtonHide:"nul4w"}},15376:e=>{e.exports={fontWrapper:"amkYk"}},15765:e=>{e.exports={highlight:"gUhBO",light:"fX3Dk",dark:"w3PtR",highlightBackground:"wPV13",highlightUnderline:"W6AVK",highlightHbar:"e8Ruv",highlightInert:"NI5pb",highlightUnderlineAnimatedRegular:"fFbRx",highlightUnderlineShow:"JZtEl",highlightUnderlineAnimatedSlow:"M8fh8",highlightEnclosing:"oR786",highlightUnderlineOnly:"to5ul",highlightUnderlineStartOnly:"EWWPj",highlightHovered:"M3SCz",highlightNeedsAttention:"bPYnD",highlightBackgroundOnly:"RSI82",highlightStatic:"DCLaM",highlightFadeIn:"rz9vy",highlightUnderlineAndPersistentBackground:"MnC8p",highlightDarken:"cI0qZ",highlightNeedsAttentionDark:"B1_r3",highlightDisappear:"y0Pwo",highlightDarkenFadeOut:"YtD3q",highlightUnderlineFadeOut:"fQx8l",highlightSuperUnderline:"NHZtV",highlightUnderlineOnHoverOnly:"GwepH",highlightUnderlineStartOnHoverOnly:"ggpYF",highlightUnderlineAndBackgroundOnHoverOnly:"ea8dV",highlightFadeOut:"cprzT",highlightNeedsAttentionRegular:"Lj7mJ",highlightColorRed:"eephs",highlightDottedUnderlineAndBackground:"AfZZS",highlightSuperUnderlineSolid:"CGD8D",highlightSuperUnderlineBeginning:"AI0sU",highlightSuperUnderlineMiddle:"gC3Gx",highlightSuperUnderlineEnding:"Ffirh",highlightColorBlue:"jlbiw",highlightColorGreen:"bZGGu",highlightColorLightGreen:"U9Jcr",highlightColorPurple:"dFzOQ",highlightColorGold:"g2PMM",highlightColorGray:"ythSG",highlightColorPlagiarism:"rt4yp",highligthColorWeHbar:"TiKPW",highlightDarkFadeOut:"vTpD2",highlightDarkFadeIn:"V27ON",highlightDarkenMore:"gC5dP",highlightDarkenMoreUndo:"tRCR8"}}}]);