var stream;!navigator.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(navigator.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!navigator.enumerateDevices&&navigator.enumerateDevices&&(navigator.enumerateDevices=navigator.enumerateDevices.bind(navigator)),navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=function(e){navigator.mediaDevices.enumerateDevices().then(e)});const enableLogger="false";let log=(...e)=>{JSON.parse(enableLogger)&&console.log("getaccess Logs : ",...e)},getCameraMicPermission=()=>{let e={video:!1,audio:!1},a={video:!1,audio:!1},i=!0;if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return log("enumerateDevices() not supported."),void(i=!1);navigator.mediaDevices.enumerateDevices().then((function(i){i.forEach((function(i){log(i.kind+": "+i.label+" id = "+i.deviceId),"audio"!==i.kind&&"audioinput"!==i.kind||(e.audio=!0,i.label&&(a.audio=!0)),"video"!==i.kind&&"videoinput"!==i.kind||(e.video=!0,i.label&&(a.video=!0))}));let o={audio:!0,video:!0};e.audio&&a.audio&&(o.audio=!1,log("Audio Device Detected")),e.video&&a.video&&(o.video=!1,log("Video Device Detected")),o.audio||o.video||(document.getElementById("vcc_access_blocked").style.display="none",document.getElementById("vcc_access_granted").style.display="block",document.getElementById("vcc_request_access").style.display="none"),(o.video||o.audio)&&(log("askForDevicePermission",o),document.getElementById("vcc_access_blocked").style.display="none",document.getElementById("vcc_access_granted").style.display="none",document.getElementById("vcc_request_access").style.display="block",void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e){var a=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return a?new Promise((function(i,o){a.call(navigator,e,i,o)})):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}),navigator.mediaDevices.getUserMedia(o).then((function(e){log("Permission granted for =====> ",o),document.getElementById("vcc_access_blocked").style.display="none",document.getElementById("vcc_access_granted").style.display="block",document.getElementById("vcc_request_access").style.display="none",e.getTracks().forEach((function(e){e.stop()}))})).catch(e=>{log("GetUserMedia Error"),log(e.name+": "+e.message),"NotAllowedError"===e.name&&"Permission denied"===e.message&&(document.getElementById("vcc_access_blocked").style.display="block",document.getElementById("vcc_access_granted").style.display="none",document.getElementById("vcc_request_access").style.display="none")})),e.audio||log("Audio Device Not Found"),e.video||log("Video Device Not Found")})).catch((function(e){log("Enumerate Error"),log(e.name+": "+e.message)}))};function checkDeviceSupport(e){let a=[],i="https:"===location.protocol,o=!1;("undefined"!=typeof MediaStreamTrack&&"getSources"in MediaStreamTrack||navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)&&(o=!0);let s={isHTTPs:i,hasMicrophone:!1,hasSpeakers:!1,hasWebcam:!1,isMicrophoneAlreadyCaptured:false,isWebcamAlreadyCaptured:false,hasPermission:!1,availableTracks:{audio:[],video:[]},canEnumerate:!0,devices:{audio:!1,video:!1}};if(o){if(!navigator.enumerateDevices||!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return log("navigator.enumerateDevices not found"),s.canEnumerate=!1,void(e&&e(s));a=[],navigator.enumerateDevices((function(o){o.forEach((function(e){let o,t={};for(var n in e)t[n]=e[n];if("audio"===t.kind&&(t.kind="audioinput"),"video"===t.kind&&(t.kind="videoinput"),a.forEach((function(e){e.id===t.id&&e.kind===t.kind&&(o=!0)})),!o){if(t.deviceId||(t.deviceId=t.id),t.id||(t.id=t.deviceId),log("device",t),t.label){if(s.hasPermission=!0,"videoinput"===t.kind&&(s.isWebcamAlreadyCaptured=!0),"audioinput"===t.kind&&(s.isMicrophoneAlreadyCaptured=!0),"audioinput"===t.kind||"audio"===t.kind){let e={id:t.deviceId,type:"audio",name:t.label};s.availableTracks.audio.push(e)}if("videoinput"===t.kind||"video"===t.kind){let e={id:t.deviceId,type:"video",name:t.label};s.availableTracks.video.push(e)}"audioinput"!==t.kind&&"audio"!==t.kind||(s.devices.audio=!0),"videoinput"!==t.kind&&"video"!==t.kind||(s.devices.video=!0)}else t.label="Please invoke getUserMedia once.",s.hasPermission=!1,i||(t.label="HTTPs is required to get label of this "+t.kind+" device.",s.isHTTPs=!1),"audioinput"!==t.kind&&"audio"!==t.kind||(s.devices.audio=!0),"videoinput"!==t.kind&&"video"!==t.kind||(s.devices.video=!0);"audioinput"===t.kind&&(s.hasMicrophone=!0),"audiooutput"===t.kind&&(s.hasSpeakers=!0),"videoinput"===t.kind&&(s.hasWebcam=!0),a.push(t)}})),e&&e(s)}))}else log("canEnumerate is false")}function captureAudioAndVideo(e,a){log("constraints",e),stopStream(stream,(function(){navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then((function(e){stream=e,videoContainer(e),log("Capture Audio and Video Called in iframe"),sendMessage("cs_show_cam_recording")})).catch(e=>{log("Capture Audio and Video Error in iframe",e.message),sendMessage("cs_show_profile_pic",{})})}))}log("FF_CAM LOADED"),sendMessage("ff-cam-iframe-loaded",{}),window.location.href&&window.location.href.indexOf("?p=1")>-1?getCameraMicPermission():window.location.href&&-1==window.location.href.indexOf("?p=1")&&(document.getElementById("vcc_request_access").style.display="block"),window.addEventListener("message",receiveMessage,!1);let stopStream=(e,a)=>{e?(e.getTracks().forEach(e=>e.stop()),log("stop stream sucess ===",e=null),a&&a()):(log("stop stream fail ===",e=null),a&&a())},videoContainer=e=>{let a=document.querySelector("#vcc-ff-cam");a||(a=document.createElement("video"),a.style.display="block",a.id="vcc-ff-cam",a.style.height="100%",a.style.width="100%",a.style.objectFit="cover",document.body.appendChild(a)),"srcObject"in a?a.srcObject=e:window.webkitURL?window.webkitURL.createObjectURL(e):window.URL&&window.URL.createObjectURL&&window.URL.createObjectURL(e),a.onloadedmetadata=function(e){try{a.play()}catch(e){log("Video playback error")}},a.onerror=function(){log("Playing Error ===>"+a.error.code+"; details: "+a.error.message)}};function receiveMessage(e){if(e&&e.data&&e.data.hasOwnProperty("msg")&&log("Iframe rcv msg",e.data),e&&e.data){let a=e.data;if(a.hasOwnProperty("msg")&&a.msg)switch(a.msg){case"_fetch_media_devices":navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((function(e){log("Audio And Video both Allowed"),checkDeviceSupport(e=>{log("response.availableTracks",e.availableTracks),log("hasWebCam: ",e.hasWebcam,"<br>"),log("hasMicrophone: ",e.hasMicrophone,"<br>"),log("hasPermission: ",e.hasPermission,"<br>"),log("isHttps: ",e.isHTTPs,"<br>"),log("canEnumerate: ",e.canEnumerate,"<br>"),log("response.availableTracks",e.availableTracks),setDefaultAudioAndVideo(e.availableTracks),sendMessage("vcc_available_media",{availableTracks:e.availableTracks})})})).catch((function(e){log("navigator.mediaDevices.getUserMedia Error Audio Video not Allowed",e.message),log("Check for Video"),navigator.mediaDevices.getUserMedia({video:!0}).then((function(e){checkDeviceSupport(e=>{log("Video Permission allowed"),log("hasWebCam: ",e.hasWebcam,"<br>"),log("hasMicrophone: ",e.hasMicrophone,"<br>"),log("hasPermission: ",e.hasPermission,"<br>"),log("isHttps: ",e.isHTTPs,"<br>"),log("canEnumerate: ",e.canEnumerate,"<br>"),log("response.availableTracks",e.availableTracks),log("response.availableTracks",e.availableTracks),setDefaultAudioAndVideo(e.availableTracks),sendMessage("vcc_available_media",{availableTracks:e.availableTracks})})})).catch((function(e){log("Video Permission not allowed",e.message),log("Check for Audio"),navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){log("Audio Permission allowed"),log("hasWebCam: ",response.hasWebcam,"<br>"),log("hasMicrophone: ",response.hasMicrophone,"<br>"),log("hasPermission: ",response.hasPermission,"<br>"),log("isHttps: ",response.isHTTPs,"<br>"),log("canEnumerate: ",response.canEnumerate,"<br>"),log("response.availableTracks",response.availableTracks),checkDeviceSupport(e=>{log("response.availableTracks",e.availableTracks),setDefaultAudioAndVideo(e.availableTracks),sendMessage("vcc_available_media",{availableTracks:e.availableTracks})})})).catch((function(e){checkDeviceSupport(e=>{log("hasWebCam: ",e.hasWebcam,"<br>"),log("hasMicrophone: ",e.hasMicrophone,"<br>"),log("hasPermission: ",e.hasPermission,"<br>"),log("isHttps: ",e.isHTTPs,"<br>"),log("canEnumerate: ",e.canEnumerate,"<br>"),log("response.availableTracks",e.availableTracks),log("response.availableTracks",e.availableTracks),setDefaultAudioAndVideo(e.availableTracks),sendMessage("vcc_available_media",{availableTracks:e.availableTracks})})}))}))}));break;case"vcc_capture_media":let e=localStorage.getItem("SELECTED_VIDEO_DEVICE"),i={video:{deviceId:e}};e?captureAudioAndVideo(i,a.options):(stopStream(stream),sendMessage("cs_show_profile_pic",{}));break;case"vcc_stop_stream":stopStream(stream)}}}function setDefaultAudioAndVideo(e){if(e&&e.hasOwnProperty("video")&&e.video.length>0){let a=e.video[0];localStorage.setItem("SELECTED_VIDEO_DEVICE",a.id)}else localStorage.setItem("SELECTED_VIDEO_DEVICE",null);if(e&&e.hasOwnProperty("audio")&&e.audio.length>0){let a=e.audio[0];localStorage.setItem("SELECTED_AUDIO_DEVICE",a.id)}else localStorage.setItem("SELECTED_AUDIO_DEVICE",null)}function sendMessage(e,a){let i={msg:e,...a};window.parent.postMessage(JSON.stringify(i),"*")}function getMediaDeviceAccess(e){navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((function(e){let a={audio:[],video:[]};e.getAudioTracks().forEach((function(e){if(e){let i={id:e.id,enabled:e.enabled,type:e.kind,name:e.label,muted:e.muted};a.audio.push(i)}})),e.getVideoTracks().forEach((function(e){if(e){let i={id:e.id,enabled:e.enabled,type:e.kind,name:e.label,muted:e.muted};a.video.push(i)}})),e.getTracks().forEach((function(e){e.stop()})),log("vcc_available_media fired",a),sendMessage("vcc_available_media",{availableTracks:a})})).catch(e=>{log("Media Device Accessing Issue",e.message)})}